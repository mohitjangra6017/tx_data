!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="Kr/+")}({"0z7Z":function(e,t,n){"use strict";var a=n("aUyK");n.n(a).a},"5h9J":function(e,t){e.exports=tui.require("tui/components/buttons/ButtonIcon")},"8km3":function(e,t){e.exports=tui.require("mod_perform/components/element/PerformAdminCustomElementEdit")},ANJn:function(e,t,n){var a={"./AggregationAdminEdit":"pke+","./AggregationAdminEdit.vue":"pke+","./AggregationAdminSummary":"Y6oj","./AggregationAdminSummary.vue":"Y6oj","./AggregationAdminView":"WtOU","./AggregationAdminView.vue":"WtOU","./AggregationParticipantForm":"pDM1","./AggregationParticipantForm.vue":"pDM1"};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id="ANJn"},GIxb:function(e,t,n){},HqhK:function(e,t){e.exports=tui.require("mod_perform/components/element/PerformAdminCustomElementSummary")},JXQf:function(e,t){e.exports=tui.require("tui/components/loading/Loader")},"KHd+":function(e,t,n){"use strict";function a(e,t,n,a,i,r,l,o){var s,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),a&&(u.functional=!0),r&&(u._scopeId="data-v-"+r),l?(s=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},u._ssrRegister=s):i&&(s=o?function(){i.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:i),s)if(u.functional){u._injectStyles=s;var d=u.render;u.render=function(e,t){return s.call(t),d(e,t)}}else{var c=u.beforeCreate;u.beforeCreate=c?[].concat(c,s):[s]}return{exports:e,options:u}}n.d(t,"a",(function(){return a}))},"Kr/+":function(e,t,n){!function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("performelement_aggregation")?console.warn('[tui bundle] The bundle "performelement_aggregation" is already loaded, skipping initialisation.'):(tui._bundle.register("performelement_aggregation"),tui._bundle.addModulesFromContext("performelement_aggregation/components",n("ANJn")))}()},PNFE:function(e,t){e.exports=tui.require("tui/components/icons/Add")},PScu:function(e,t,n){"use strict";var a=n("GIxb");n.n(a).a},U4w2:function(e,t){e.exports=tui.require("mod_perform/components/element/ElementParticipantResponse")},UrNu:function(e,t){e.exports=tui.require("mod_perform/components/element/participant_form/ResponseDisplay")},WBvU:function(e,t){e.exports=tui.require("tui/components/uniform")},WtOU:function(e,t,n){"use strict";n.r(t);var a={inheritAttrs:!1,props:{data:Object,extraPluginConfigData:Object},computed:{hasExcludedValues(){return this.excludedValues.length>0},excludedValuesCsv(){return this.excludedValues.join(", ")},excludedValues(){return this.data.excludedValues?this.data.excludedValues.filter(e=>null!==e&&""!==e.trim()):[]},aggregationTypesPreview(){const e=this.$str("calculated_value_preview_placeholder","performelement_aggregation"),t=this.extraPluginConfigData.calculations;return this.data.calculations.map(n=>{const a=t.find(e=>e.name===n).label;return this.$str("aggregated_response_display","performelement_aggregation",{label:a,value:e})})}}},i=(n("0z7Z"),n("KHd+")),r=function(e){e.options.__langStrings={performelement_aggregation:["aggregated_response_display","header_blurb","header_blurb_with_exclusions","calculated_value_preview_placeholder"]}},l=Object(i.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationAdminView"},[e.hasExcludedValues?n("div",[e._v("\n    "+e._s(e.$str("header_blurb_with_exclusions","performelement_aggregation",e.excludedValuesCsv))+"\n  ")]):n("div",{staticClass:"tui-aggregationAdminView__blurb"},[e._v("\n    "+e._s(e.$str("header_blurb","performelement_aggregation"))+"\n  ")]),e._v(" "),n("div",e._l(e.aggregationTypesPreview,(function(t,a){return n("div",{key:a},[e._v("\n      "+e._s(t)+"\n    ")])})),0)])}),[],!1,null,null,null);"function"==typeof r&&r(l),l.options.__hasBlocks={script:!0,template:!0};t.default=l.exports},Y6oj:function(e,t,n){"use strict";n.r(t);var a=n("HqhK"),i={components:{PerformAdminCustomElementSummary:n.n(a).a},props:{data:Object,identifier:String,isRequired:Boolean,settings:Object,title:String,type:Object,extraPluginConfigData:Object},computed:{extraFields(){const e=[{title:this.$str("questions_for_response_aggregation","performelement_aggregation"),options:this.sectionElementsForAggregation.map(e=>({value:`${e.element.title} (${e.element.element_plugin.name})`}))},{title:this.$str("calculations_to_display","performelement_aggregation"),options:this.calculationsToDisplay.map(e=>({value:e}))}];return this.hasExcludedValues&&e.push({title:this.$str("excluded_values","performelement_aggregation"),helpmsg:this.$str("excluded_values_help_text","performelement_aggregation"),options:this.excludedValues.map(e=>({value:e}))}),e},sectionElementsForAggregation(){return this.data.sourceSectionElementIds.map(e=>this.aggregatableSectionElements.find(t=>Number(t.id)===Number(e)))},aggregatableSectionElements(){return this.data.aggregatableSections.reduce((e,t)=>[...e,...t.aggregatable_section_elements],[])},calculationsToDisplay(){const e=this.extraPluginConfigData.calculations;return this.data.calculations.map(t=>e.find(e=>e.name===t).label)},hasExcludedValues(){return this.excludedValues.length>0},excludedValues(){return this.data.excludedValues?this.data.excludedValues.filter(e=>null!==e&&""!==e.trim()):[]}}},r=n("KHd+"),l=function(e){e.options.__langStrings={performelement_aggregation:["calculations_to_display","excluded_values","excluded_values_help_text","questions_for_response_aggregation"]}},o=Object(r.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-redisplayAdminSummary"},[n("PerformAdminCustomElementSummary",{attrs:{"extra-fields":e.extraFields,identifier:e.identifier,"is-required":e.isRequired,settings:e.settings,title:e.title},on:{display:function(t){return e.$emit("display")}}})],1)}),[],!1,null,null,null);"function"==typeof l&&l(o),o.options.__hasBlocks={script:!0,template:!0};t.default=o.exports},aUyK:function(e,t,n){},hQxJ:function(e,t){e.exports=tui.require("mod_perform/components/element/ElementParticipantFormContent")},hjaT:function(e,t){e.exports=tui.require("tui/components/form/Checkbox")},iFIC:function(e,t){e.exports=tui.require("tui/components/form/Repeater")},pDM1:function(e,t,n){"use strict";n.r(t);var a=n("U4w2"),i=n.n(a),r=n("UrNu"),l=n.n(r),o=n("hQxJ"),s={components:{ElementParticipantFormContent:n.n(o).a,ElementParticipantResponse:i.a,ResponseDisplay:l.a},props:{path:[String,Array],error:String,isDraft:Boolean,element:{type:Object,required:!0},participantInstanceId:{type:Number,required:!1},sectionElement:{type:Object,required:!0}},computed:{hasExcludedValues(){return this.excludedValues.length>0},excludedValuesCsv(){return this.excludedValues.join(", ")},excludedValues(){return this.element.data.excludedValues?this.element.data.excludedValues.filter(e=>null!==e&&""!==String(e).trim()):[]}}},u=(n("PScu"),n("KHd+")),d=function(e){e.options.__langStrings={performelement_aggregation:["header_blurb","header_blurb_with_exclusions"]}},c=Object(u.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationParticipantForm"},[e.hasExcludedValues?n("div",[e._v("\n    "+e._s(e.$str("header_blurb_with_exclusions","performelement_aggregation",e.excludedValuesCsv))+"\n  ")]):n("div",[e._v("\n    "+e._s(e.$str("header_blurb","performelement_aggregation"))+"\n  ")]),e._v(" "),n("ElementParticipantFormContent",e._b({attrs:{"participant-can-answer":e.sectionElement.can_respond,element:e.element,"section-element":e.sectionElement,"from-print":!1,"is-draft":e.isDraft},scopedSlots:e._u([{key:"content",fn:function(t){t.labelId;return[n("ElementParticipantResponse",{scopedSlots:e._u([{key:"content",fn:function(){return[n("ResponseDisplay",{attrs:{element:e.element,data:e.sectionElement.response_data_formatted_lines}})]},proxy:!0}],null,!0)})]}}])},"ElementParticipantFormContent",e.$attrs,!1))],1)}),[],!1,null,null,null);"function"==typeof d&&d(c),c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},"pke+":function(e,t,n){"use strict";n.r(t);var a=n("WBvU"),i=n("hjaT"),r=n.n(i),l=n("JXQf"),o=n.n(l),s=n("iFIC"),u=n.n(s),d=n("PNFE"),c=n.n(d),m=n("5h9J"),g=n.n(m),p=n("8km3"),_=n.n(p),f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"performelement_aggregation_aggregatable_question_elements"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"aggregatable_question_elements_input"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"performelement_aggregation_aggregatable_question_elements"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sections"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"title"},name:{kind:"Name",value:"display_title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"aggregatable_section_elements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"element"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"element_plugin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}]},v={components:{Checkbox:r.a,FormCheckboxGroup:a.FormCheckboxGroup,FormRow:a.FormRow,FormSelect:a.FormSelect,FormNumber:a.FormNumber,Repeater:u.a,FieldArray:a.FieldArray,AddIcon:c.a,ButtonIcon:g.a,Loader:o.a,PerformAdminCustomElementEdit:_.a},inheritAttrs:!1,props:{identifier:String,rawData:Object,rawTitle:String,settings:Object,data:Object,currentActivityId:Number,extraPluginConfigData:Object},data(){const e={sourceSectionElementIds:this.createValuesForRepeater(this.rawData.sourceSectionElementIds,!1),calculations:this.rawData.calculations,excludedValues:this.createValuesForRepeater(this.rawData.excludedValues,!0),identifier:this.identifier,rawTitle:this.rawTitle};return{loading:!1,initialValues:e,questionCounter:e.sourceSectionElementIds.length,excludedValuesCounter:e.excludedValues.length}},computed:{activityAggregatableElementOptions(){const e=this.rawData.aggregatableSections;let t;if(!e||0===e.length)return[{id:null,label:this.$str("no_available_questions","performelement_aggregation")}];t=e.length>1?e.map(e=>({label:e.title,options:e.aggregatable_section_elements.map(e=>({id:e.id,label:e.element.title}))})):e[0].aggregatable_section_elements.map(e=>({id:e.id,label:e.element.title}));let n={id:null,label:this.$str("select_question_element","performelement_aggregation")};return t.unshift(n),t},calculationOptions(){return this.extraPluginConfigData.calculations}},created(){this.rawData.aggregatableSections||this.fetchAggregatableSectionElements()},methods:{async fetchAggregatableSectionElements(){this.loading=!0;const e=await this.$apollo.query({query:f,variables:{input:{activity_id:this.currentActivityId}},fetchPolicy:"network-only"});this.$set(this.rawData,"aggregatableSections",e.data.performelement_aggregation_aggregatable_question_elements.sections),this.loading=!1},getElementForUpdate:e=>(e.data.sourceSectionElementIds=e.data.sourceSectionElementIds.map(e=>e.value),e.data.excludedValues=e.data.excludedValues.map(e=>e.value),e),createValuesForRepeater(e,t){e||(e=[]);const n=e.map((e,t)=>({name:t,value:e}));return 0===n.length&&n.push(this.createEmptyRepeaterValue(n.length)),1!==n.length||t||n.push(this.createEmptyRepeaterValue(n.length)),n},createEmptyRepeaterValue:e=>({name:e,value:null}),sourceSectionElementsValidation(e){const t=this.$str("duplicate_questions_validation_error","performelement_aggregation"),n=t=>{if(t.value)return e.some(e=>e.name!==t.name&&Number(e.value)===Number(t.value))};return e.map(e=>({value:n(e)?t:null}))}}},h=n("KHd+"),b=function(e){e.options.__langStrings={performelement_aggregation:["add_excluded_value","add_question","aggregate_question_n","calculations_to_display","duplicate_questions_validation_error","excluded_value_n","excluded_values","excluded_values","excluded_values_help_text","no_available_questions","questions_for_response_aggregation","questions_to_aggregate","select_question_element"]}},x=Object(h.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-aggregationAdminEdit"},[n("PerformAdminCustomElementEdit",{attrs:{"initial-values":e.initialValues,settings:e.settings,"validation-mode":"auto"},on:{cancel:function(t){return e.$emit("display")},update:function(t){e.$emit("update",e.getElementForUpdate(t))}}},[n("FormRow",{attrs:{label:e.$str("questions_to_aggregate","performelement_aggregation"),required:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.labelId;return[n("Loader",{attrs:{loading:e.loading}},[n("FieldArray",{attrs:{path:"sourceSectionElementIds",validate:e.sourceSectionElementsValidation},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.items,r=t.push,l=t.remove;return[n("Repeater",{attrs:{rows:i,"min-rows":2,"delete-icon":!0,"aria-labelledby":a},on:{add:function(e){return r()},remove:function(e,t){return l(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.index;return[n("FormSelect",{attrs:{"aria-label":e.$str("aggregate_question_n","performelement_aggregation",a+1),options:e.activityAggregatableElementOptions,name:[a,"value"],validations:function(e){return[e.required()]}}})]}},{key:"add",fn:function(){return[n("ButtonIcon",{attrs:{"aria-label":e.$str("add_question","performelement_aggregation"),styleclass:{small:!0},text:e.$str("add_question","performelement_aggregation")},on:{click:function(t){r(e.createEmptyRepeaterValue(e.questionCounter++))}}},[n("AddIcon")],1)]},proxy:!0}],null,!0)})]}}],null,!0)})],1)]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("calculations_to_display","performelement_aggregation"),required:""},scopedSlots:e._u([{key:"default",fn:function(t){t.labelId;return[n("FormCheckboxGroup",{attrs:{validations:function(e){return[e.required()]},name:"calculations"}},e._l(e.calculationOptions,(function(t){return n("Checkbox",{key:t.name,attrs:{value:t.name}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1)]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("excluded_values","performelement_aggregation"),helpmsg:e.$str("excluded_values_help_text","performelement_aggregation")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.labelId;return[n("FieldArray",{attrs:{path:"excludedValues"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.items,r=t.push,l=t.remove;return[n("Repeater",{attrs:{rows:i,"min-rows":1,"delete-icon":!0,"aria-labelledby":a},on:{add:function(e){return r()},remove:function(e,t){return l(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.index;return[n("FormNumber",{attrs:{"aria-label":e.$str("excluded_value_n","performelement_aggregation",a+1),name:[a,"value"],"char-length":"4"}})]}},{key:"add",fn:function(){return[n("ButtonIcon",{attrs:{"aria-label":e.$str("add_excluded_value","performelement_aggregation"),styleclass:{small:!0}},on:{click:function(t){r(e.createEmptyRepeaterValue(e.excludedValuesCounter++))}}},[n("AddIcon")],1)]},proxy:!0}],null,!0)})]}}],null,!0)})]}}])})],1)],1)}),[],!1,null,null,null);"function"==typeof b&&b(x),x.options.__hasBlocks={script:!0,template:!0};t.default=x.exports}});