!function(e){function t(t){for(var i,a,s=t[0],u=t[1],c=t[2],d=0,f=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&f.push(r[a][0]),r[a]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var u=n[s];0!==r[u]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={2:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;o.push(["zdIk",0]),n()}({"+MEP":function(e,t){e.exports=tui.require("tui/components/profile/MiniProfileCard")},"+pLW":function(e,t){e.exports=tui.require("editor_weka/components/suggestion/User")},"+xcZ":function(e,t){e.exports=tui.require("editor_weka/components/attachments/FileAttachment")},"/Kfb":function(e,t,n){"use strict";n.r(t),n.d(t,"findParentNode",(function(){return o})),n.d(t,"findParentNodeClosestToPos",(function(){return a})),n.d(t,"findParentDomRef",(function(){return s})),n.d(t,"hasParentNode",(function(){return u})),n.d(t,"findParentNodeOfType",(function(){return c})),n.d(t,"findParentNodeOfTypeClosestToPos",(function(){return l})),n.d(t,"hasParentNodeOfType",(function(){return d})),n.d(t,"findParentDomRefOfType",(function(){return f})),n.d(t,"findSelectedNodeOfType",(function(){return p})),n.d(t,"findPositionOfNodeBefore",(function(){return m})),n.d(t,"findDomRefAtPos",(function(){return h}));var i=n("n31W"),r=n("FtnZ"),o=function(e){return function(t){var n=t.$from;return a(n,e)}},a=function(e,t){for(var n=e.depth;n>0;n--){var i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}},s=function(e,t){return function(n){var i=o(e)(n);if(i)return h(i.pos,t)}},u=function(e){return function(t){return!!o(e)(t)}},c=function(e){return function(t){return o((function(t){return Object(r.equalNodeType)(e,t)}))(t)}},l=function(e,t){return a(e,(function(e){return Object(r.equalNodeType)(t,e)}))},d=function(e){return function(t){return u((function(t){return Object(r.equalNodeType)(e,t)}))(t)}},f=function(e,t){return function(n){return s((function(t){return Object(r.equalNodeType)(e,t)}),t)(n)}},p=function(e){return function(t){if(Object(r.isNodeSelection)(t)){var n=t.node,i=t.$from;if(Object(r.equalNodeType)(e,n))return{node:n,pos:i.pos,depth:i.depth}}}},m=function(e){var t=e.$from.nodeBefore,n=i.Selection.findFrom(e.$from,-1);if(n&&t){var r=c(t.type)(n);return r?r.pos:n.$from.pos}},h=function(e,t){var n=t(e),i=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:i&&i.nodeType!==Node.TEXT_NODE?i:n.node}},"00Pk":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AudioBlock")},"0QOp":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/LinkBlock")},"12HA":function(e,t){e.exports=tui.require("tui/config")},"1RMz":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-fileAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var r=n("RNtj"),o=n.n(r),a=n("r4xq"),s=n.n(a),u=n("zK61"),c=n.n(u),l={components:{AttachmentNode:o.a,NodeBar:s.a},mixins:[c.a],computed:{actions:function(){var e=this,t=[{label:this.$str("remove","moodle"),action:function(){e.$emit("delete")}}];return this.hasDownloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){e.$emit("download")}}),t}}},d=n("KHd+"),f=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["actions_menu_for"]}},p=Object(d.a)(l,i,[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/FileAttachment.vue";t.default=p.exports},"1bAF":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-nodeBar"},[n("ActionDropdown",{attrs:{position:"bottom-right",actions:e.actions},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("ButtonIcon",{attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":r?"true":"false","aria-label":e.ariaLabel?e.ariaLabel:e.$str("more_items","editor_weka")},on:{click:i}},[n("More")],1)]}}])})],1)};i._withStripped=!0;var r=n("ce8f"),o=n.n(r),a=n("5h9J"),s=n.n(a),u=n("hCGN"),c=n.n(u),l={components:{ActionDropdown:o.a,ButtonIcon:s.a,More:c.a},props:{actions:{type:Array,required:!0},ariaLabel:String}},d=n("KHd+"),f=function(e){e.options.__langStrings={editor_weka:["more_items"]}},p=Object(d.a)(l,i,[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/toolbar/NodeBar.vue";t.default=p.exports},"1j8w":function(e,t,n){var i={"./ComponentView":"lELM","./ComponentView.js":"lELM","./Editor":"T7/7","./Editor.js":"T7/7","./WekaValue":"DgbO","./WekaValue.js":"DgbO","./api":"JMt+","./api.js":"JMt+","./extensions/Base":"oBkI","./extensions/Base.js":"oBkI","./extensions/attachment":"oBVP","./extensions/attachment.js":"oBVP","./extensions/emoji":"HtKA","./extensions/emoji.js":"HtKA","./extensions/hashtag":"MbZ7","./extensions/hashtag.js":"MbZ7","./extensions/link":"eoJc","./extensions/link.js":"eoJc","./extensions/list":"O2zc","./extensions/list.js":"O2zc","./extensions/media":"2pXJ","./extensions/media.js":"2pXJ","./extensions/mention":"Z8if","./extensions/mention.js":"Z8if","./extensions/ruler":"s0QR","./extensions/ruler.js":"s0QR","./extensions/text":"SFqO","./extensions/text.js":"SFqO","./extensions/util":"iag4","./extensions/util.js":"iag4","./helpers/editor":"VUoS","./helpers/editor.js":"VUoS","./helpers/file":"MJ7y","./helpers/file.js":"MJ7y","./helpers/media":"gEm7","./helpers/media.js":"gEm7","./helpers/mention":"t6uu","./helpers/mention.js":"t6uu","./helpers/suggestion":"z3By","./helpers/suggestion.js":"z3By","./integration":"e9dp","./integration.js":"e9dp","./keymap":"5yv7","./keymap.js":"5yv7","./lib/prosemirror_schema_list/schema_list":"qSeW","./lib/prosemirror_schema_list/schema_list.js":"qSeW","./lib/prosemirror_utils/helpers":"FtnZ","./lib/prosemirror_utils/helpers.js":"FtnZ","./lib/prosemirror_utils/selection":"/Kfb","./lib/prosemirror_utils/selection.js":"/Kfb","./lib/prosemirror_utils/transforms":"Jfd+","./lib/prosemirror_utils/transforms.js":"Jfd+","./mixins/attachment_mixin":"BPQQ","./mixins/attachment_mixin.js":"BPQQ","./plugins/attachment":"f56J","./plugins/attachment.js":"f56J","./plugins/emoji":"9COe","./plugins/emoji.js":"9COe","./plugins/hashtag":"FGzX","./plugins/hashtag.js":"FGzX","./plugins/mention":"BDOe","./plugins/mention.js":"BDOe","./plugins/text_placeholder":"x4h3","./plugins/text_placeholder.js":"x4h3","./schema":"wbdD","./schema.js":"wbdD","./toolbar":"fvDX","./toolbar.js":"fvDX","./transaction":"zLSG","./transaction.js":"zLSG","./util":"X7tx","./util.js":"X7tx","./utils/list":"WI/B","./utils/list.js":"WI/B","./utils/upload":"ddKQ","./utils/upload.js":"ddKQ"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="1j8w"},"1k+S":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-suggestion__hashtag",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!1,open:e.showSuggestions},on:{dismiss:e.dismiss},scopedSlots:e._u([{key:"trigger",fn:function(){return[n("span",{staticClass:"sr-only"},[e._v("\n        "+e._s(e.$str("matching_hashtags","weka_editor"))+":\n      ")])]},proxy:!0}])},[e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","moodle"))+"\n      ")])]:e._l(e.hashtags,(function(t,i){return n("DropdownItem",{key:i,on:{click:function(n){return e.pickTag(t)}}},[e._v("\n        "+e._s(t.tag)+"\n      ")])}))],2)],1)};i._withStripped=!0;var r=n("gLvT"),o=n.n(r),a=n("KGcv"),s=n.n(a),u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_find_hashtags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"hashtags"},name:{kind:"Name",value:"core_hashtags_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tag"},arguments:[],directives:[]}]}}]}}]},c={components:{Dropdown:o.a,DropdownItem:s.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},x:{required:!0,type:[Number,String]},y:{required:!0,type:[Number,String]},pattern:{required:!0,type:String}},data:function(){return{hashtags:[]}},apollo:{hashtags:{query:u,variables:function(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},computed:{showSuggestions:function(){return this.$apollo.loading||this.hashtags.length>0},positionStyle:function(){return{left:"".concat(this.x,"px"),top:"".concat(this.y,"px")}}},watch:{showSuggestions:function(e){e||this.$emit("dismiss")}},mounted:function(){var e=this.$refs.customTrigger;e&&e.click()},methods:{pickTag:function(e){var t=e.id,n=e.tag;this.$emit("item-selected",{id:t,text:n})},dismiss:function(){this.open=!1,this.$emit("dismiss")}}},l=n("KHd+"),d=function(e){e.options.__langStrings={editor_weka:["matching_hashtags"],moodle:["loadinghelp"]}},f=Object(l.a)(c,i,[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0},f.options.__file="client/src/editor_weka/components/suggestion/Hashtag.vue";t.default=f.exports},"2pXJ":function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("7W2i"),f=n.n(d),p=n("a1gu"),m=n.n(p),h=n("Nsbk"),v=n.n(h),k=n("oBkI"),_=n("fvDX"),g=n("V68o"),y=n("ddKQ"),b=n("Cx/y"),w=n.n(b),x=n("ta2K"),N=n.n(x),S=n("AtFJ"),O=n.n(S),I=n("JMt+"),j=n("gEm7"),A=n("iag4"),T=n("vyVp");function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var $=function(e){f()(i,e);var t,n=D(i);function i(e){var t;return u()(this,i),(t=n.call(this,e)).acceptTypes=e.accept_types||[],t}return l()(i,[{key:"nodes",value:function(){return{image:{schema:{atom:!0,group:"block",inline:!1,selectable:!0,attrs:{filename:{default:void 0},url:{default:void 0},alttext:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-imageBlock",getAttrs:A.getJsonAttrs},{tag:"div.tui-imageBlock",getAttrs:A.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-editorWeka-imageBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,alttext:e.attrs.alttext,url:e.attrs.url})}]}},component:w.a,componentContext:{replaceWithAttachment:this._replaceImageWithAttachment.bind(this),updateImage:this._updateImage.bind(this),hasAttachmentNode:this._hasAttachmentsNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},video:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-videoBlock",getAttrs:A.getJsonAttrs},{tag:"div.tui-videoBlock",getAttrs:A.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-editorWeka-videoBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]}},component:N.a,componentContext:{replaceWithAttachment:this._replaceVideoWithAttachment.bind(this),hasAttachmentNode:this._hasAttachmentNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},audio:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-audioBlock",getAttrs:A.getJsonAttrs},{tag:"div.tui-audioBlock",getAttrs:A.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-editorWeka-audioBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]}},component:O.a,componentContext:{hasAttachmentNode:this._hasAttachmentNode.bind(this),replaceWithAttachment:this._replaceAudioWithAttachment.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}}}}},{key:"toolbarItems",value:function(){var e=this;return[new _.ToolbarItem({group:"upload",label:Object(g.langString)("embedded_media","editor_weka"),icon:"editor_weka|image",execute:function(t){Object(y.pickFiles)(t).then(function(){var t=a()(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&e._startUploading(n);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})]}},{key:"_startUploading",value:(t=a()(r.a.mark((function e(t){var n,i,o,a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.editor.fileStorage.uploadFiles(t,this.acceptTypes);case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return i=this.editor.state.schema,e.next=9,Promise.all(n.map((function(e){var t=e.file,n=e.id,r=e.url;return Object(I.getMediaType)({filename:t,itemId:n}).then((function(e){var n=e.mediaType,o=e.mimeType;return j.IMAGE===n?i.node("image",{filename:t,alttext:"",url:r}):j.VIDEO===n?i.node("video",{filename:t,url:r,mime_type:o}):i.node("audio",{url:r,filename:t,mime_type:o})}))})));case 9:o=e.sent,this.editor.execute((function(e,t){var n=e.tr,r=n.selection;if(s._hasAttachmentsNode()){var a=i.nodes.attachments;if(r.$from.parent&&a.name===r.$from.parent.type.name)return n.insert(n.selection.$from.after(),o),void t(n)}if(r.empty){var u=r.$from,c=u.parent;"paragraph"===c.type.name&&0===c.content.size?(n.replaceWith(u.before(),u.after(),o),s.editor.view.focus()):n.insert(u.pos,o)}else n.replaceWith(r.from,r.to,o);t(n)})),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),a=Object(g.langString)("error_upload_failed","editor_weka"),Object(g.loadLangStrings)([a]).then((function(){return Object(T.notify)({type:"error",message:a.toString()})}));case 18:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})},{key:"_replaceImageWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.alttext,o=t.size;this.editor.execute((function(t,a){var s=t.tr,u=e(),c=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:o,option:{alttext:r}});a(s.replaceWith(u.from,u.to,t.schema.node("attachments",null,[c])))}))}},{key:"_replaceVideoWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.size;this.editor.execute((function(t,o){var a=t.tr,s=e(),u=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:r,option:{}});o(a.replaceWith(s.from,s.to,t.schema.node("attachments",null,[u])))}))}},{key:"_updateImage",value:function(e,t){var n=this,i=t.filename,r=t.alttext,o=t.mimeType;this.editor.execute((function(t,a){var s=t.tr,u=e(),c=t.schema.node("image",{filename:i,url:n._getFileUrl(i),alttext:r,mime_type:o});a(s.replaceWith(u.from,u.to,c)),n.editor.view.focus()}))}},{key:"_replaceAudioWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.size;this.editor.execute((function(t,o){var a=t.tr,s=e(),u=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:r,option:{}});o(a.replaceWith(s.from,s.to,t.schema.node("attachments",null,[u])))}))}},{key:"_hasAttachmentNode",value:function(){return this.editor.hasNode("attachment")}},{key:"_hasAttachmentsNode",value:function(){return this.editor.hasNode("attachments")}},{key:"_getFileUrl",value:function(e){var t=this.editor.fileStorage.getFile(e);return t?t.url:null}},{key:"_getItemId",value:function(){var e=this.editor.fileStorage.getRepositoryData();return e?e.itemId:null}}]),i}(k.default);t.default=function(e){return new $(e)}},"2wx7":function(e,t){e.exports=tui.require("editor_weka/components/Weka")},"36rR":function(e,t){e.exports=tui.require("tui/dom/focus")},"3Nur":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{staticClass:"tui-editorWeka-editImageAltTextModal"},[n("ModalContent",{staticClass:"tui-editorWeka-editImageAltTextModal__content",attrs:{title:e.modalTitle}},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[n("div",{staticClass:"tui-editorWeka-editImageAltTextModal__input"},[n("InputText",{attrs:{autofocus:!0},model:{value:e.innerValue,callback:function(t){e.innerValue=t},expression:"innerValue"}}),e._v(" "),n("p",{staticClass:"tui-editorWeka-editImageAltTextModal__input__helpText"},[e._v("\n          "+e._s(e.$str("image_alt_help","editor_weka"))+"\n        ")])],1),e._v(" "),n("ButtonGroup",{staticClass:"tui-editorWeka-editImageAltTextModal__buttonGroup"},[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka")},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:function(t){return t.preventDefault(),e.$emit("request-close")}}})],1)],1)],1)],1)};i._withStripped=!0;var r=n("nEm4"),o=n.n(r),a=n("tkAW"),s=n.n(a),u=n("u5iS"),c=n.n(u),l=n("oMuj"),d=n.n(l),f=n("BN8m"),p=n.n(f),m=n("vF5l"),h=n.n(m),v=n("nXMa"),k=n.n(v),_={components:{Modal:s.a,ModalContent:c.a,Form:o.a,InputText:d.a,ButtonGroup:p.a,Button:h.a,ButtonCancel:k.a},props:{value:{type:String,required:!0}},data:function(){return{innerValue:this.value}},computed:{modalTitle:function(){return 0===this.value.length?this.$str("add_image_alt_text","editor_weka"):this.$str("edit_image_alt_text","editor_weka")}},methods:{confirm:function(){this.$emit("change",this.innerValue)}}},g=n("KHd+"),y=function(e){e.options.__langStrings={editor_weka:["add_image_alt_text","edit_image_alt_text","done","image_alt_help"]}},b=Object(g.a)(_,i,[],!1,null,null,null);"function"==typeof y&&y(b),b.options.__hasBlocks={script:!0,template:!0},b.options.__file="client/src/editor_weka/components/editing/EditImageAltTextModal.vue";t.default=b.exports},"3bgQ":function(e,t){e.exports=tui.require("tui/components/embeds/ResponsiveEmbedIframe")},"3sQR":function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownButton")},"3t4c":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dropdown",{attrs:{position:e.position,open:e.open},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)},[e._v(" "),e._t("dropdown-items",e._l(e.actions,(function(t,i){return n("DropdownButton",{key:i,on:{click:function(e){return e.preventDefault(),t.action()}}},[e._v("\n      "+e._s(t.label)+"\n    ")])})))],2)};i._withStripped=!0;var r=n("gLvT"),o=n.n(r),a=n("3sQR"),s=n.n(a),u={components:{Dropdown:o.a,DropdownButton:s.a},props:{position:String,open:Boolean,actions:Array}},c=n("KHd+"),l=Object(c.a)(u,i,[],!1,null,null,null);l.options.__hasBlocks={script:!0,template:!0},l.options.__file="client/src/editor_weka/components/editing/ActionDropdown.vue";t.default=l.exports},"5XLN":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-user",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!0,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}}},[n("span",{staticClass:"sr-only"},[e._v("\n      "+e._s(e.$str("matching_users","weka_editor"))+":\n    ")]),e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","moodle"))+"\n      ")])]:e._l(e.users,(function(t,i){var r=t.user,o=t.jobassignments;return n("DropdownItem",{key:i,attrs:{paddingless:!0},on:{click:function(t){return e.pickUser(r)}}},[n("MiniProfileCard",{attrs:{"no-border":!0,interactive:!1,"avatar-src":r.profileimageurl,"avatar-alt":r.profileimagealt||"",name:r.fullname,mention:"mention","job-assignment":e.getJobAssignment(o),email:r.email}})],1)}))],2)],1)};i._withStripped=!0;var r=n("gLvT"),o=n.n(r),a=n("KGcv"),s=n.n(a),u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_find_users_by_pattern"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"users"},name:{kind:"Name",value:"editor_weka_users_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileimageurl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileimagealt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"jobassignments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}}]}}]}}]},c=n("+MEP"),l=n.n(c),d={components:{Dropdown:o.a,DropdownItem:s.a,MiniProfileCard:l.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},x:{required:!0,type:[Number,String]},y:{required:!0,type:[Number,String]},pattern:{required:!0,type:String}},apollo:{users:{query:u,variables:function(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},data:function(){return{users:[]}},computed:{positionStyle:function(){return{left:"".concat(this.x,"px"),top:"".concat(this.y,"px")}}},methods:{getJobAssignment:function(e){return e&&0<e.length?e[0].fullname:""},pickUser:function(e){var t=e.id,n=e.fullname;this.$emit("item-selected",{id:t,text:n})}}},f=n("KHd+"),p=function(e){e.options.__langStrings={editor_weka:["matching_users"],moodle:["loadinghelp"]}},m=Object(f.a)(d,i,[],!1,null,null,null);"function"==typeof p&&p(m),m.options.__hasBlocks={script:!0,template:!0},m.options.__file="client/src/editor_weka/components/suggestion/User.vue";t.default=m.exports},"5h9J":function(e,t){e.exports=tui.require("tui/components/buttons/ButtonIcon")},"5yv7":function(e,t,n){"use strict";n.r(t),n.d(t,"buildKeymap",(function(){return s}));var i=n("FtgP"),r=n("OQYi"),o=n("AApu"),a="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function s(e,t){var n={};function s(e,t){n[e]=t}s("Mod-z",r.undo),s("Shift-Mod-z",r.redo),s("Backspace",o.undoInputRule),a||s("Mod-y",r.redo),s("Alt-ArrowUp",i.joinUp),s("Alt-ArrowDown",i.joinDown),s("Mod-BracketLeft",i.lift),s("Escape",i.selectParentNode);var u={schema:e,isMac:a};return t.forEach((function(e){e(s,u)})),n}},"6RS6":function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachments")},"78qK":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-emojis"},e._l(e.emojis,(function(t,i){return n("ButtonIcon",{key:i,attrs:{styleclass:{stealth:!0},"aria-label":e.fromShortCode(t.shortcode)},nativeOn:{click:function(n){return e.select(t)}}},[n("Emoji",{staticClass:"tui-editorWeka-emojis__emoji",attrs:{"short-code":t.shortcode}})],1)})),1)};i._withStripped=!0;var r=n("5h9J"),o=n.n(r),a=n("QCX9"),s=n.n(a),u={components:{ButtonIcon:o.a,Emoji:s.a},props:{emojis:{type:Array,required:!0,validator:function(e){return e.every((function(e){return"shortcode"in e}))}}},methods:{select:function(e){this.$emit("emoji-selected",e)},fromShortCode:function(e){return String.fromCodePoint("0x"+e)}}},c=n("KHd+"),l=Object(c.a)(u,i,[],!1,null,null,null);l.options.__hasBlocks={script:!0,template:!0},l.options.__file="client/src/editor_weka/components/editing/Emojis.vue";t.default=l.exports},"8gR2":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-fixture-wekaBasic"},[t("Weka",{attrs:{component:"editor_weka",area:"behat"}})],1)};i._withStripped=!0;var r=n("2wx7"),o={components:{Weka:n.n(r).a}},a=n("KHd+"),s=Object(a.a)(o,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/pages/fixtures/WekaBasic.vue";t.default=s.exports},"9COe":function(e,t,n){"use strict";n.r(t);var i=n("n31W"),r=n("wd6j");t.default=function(e,t,n){var o=new i.PluginKey("emojis"),a=!1;return new i.Plugin({key:o,appendTransaction:function(e,t,n){var i=o.getState(n),r=i.text,a=i.active,s=i.range,u=i.emoji;if(!r||!a)return null;var c=n.schema.node("emoji",{id:u.id,shortcode:u.shortcode});return n.tr.replaceWith(s.from,s.to,c)},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,n){var i=e.selection,o=Object.assign({},n);if(o.active=!1,!a)return o;if(i.from===i.to){var s=function(e,t){if(!(e&&e instanceof r.ResolvedPos))return null;var n,i,o=e.doc.textBetween(e.start(),e.end(),"\0","\0");if(""===o)return null;if(!t)return null;for(var a=0;a<t.length;++a){var s=t[a];if(""!==s.pattern)for(i=new RegExp(s.pattern,"g");n=i.exec(o);){var u=n.input.slice(Math.max(0,n.index-1),n.index);if(/^[\s\0]?$/.test(u)){var c=n.index+e.start(),l=c+n[0].length;if(c<e.pos&&l>=e.pos)return{range:{from:c,to:l},text:n[0],emoji:s}}}}return null}(i.$from,t);s&&(o.active=!0,o.range=s.range,o.text=s.text,o.emoji=s.emoji)}return o.active||(o.range={},o.text=null),o}},props:{handleKeyDown:function(e,t){a=n.find((function(e){return e===t.key}))}}})}},"9E4C":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-imageAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,component:"user",area:"draft","item-id":this.draftId}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var r=n("RNtj"),o=n.n(r),a=n("r4xq"),s=n.n(a),u=n("zK61"),c=n.n(u),l={components:{AttachmentNode:o.a,NodeBar:s.a},mixins:[c.a],props:{enableConvert:{type:Boolean,default:!0}},data:function(){return{showModal:!1}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","moodle"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){e.$emit("download")}}),t}}},d=n("KHd+"),f=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],moodle:["remove","download"]}},p=Object(d.a)(l,i,[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/ImageAttachment.vue";t.default=p.exports},"9G+f":function(e,t){e.exports=tui.require("tui/components/popover/Popover")},"9Ovj":function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButton")},"9Wm2":function(e,t){e.exports=tui.require("editor_weka/components/marks/Link")},"9cw/":function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkMedia")},"9s3S":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{attrs:{size:"normal","aria-labelledby":e.$id("title")}},[n("ModalContent",{attrs:{title:e.isNew?e.$str("insert_link","editor_weka"):e.$str("edit_link","editor_weka"),"title-id":e.$id("title"),"close-button":!0},scopedSlots:e._u([{key:"buttons",fn:function(){return[n("ButtonGroup",[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka"),disabled:!e.formValid||e.loading},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:e.close}})],1)]},proxy:!0}])},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[e.error?n("p",[e._v(e._s(e.error))]):e._e(),e._v(" "),n("FormRow",{attrs:{label:e.$str("linkurl","editor")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{ref:"url",attrs:{id:i,autofocus:!0},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("display_text","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,value:"link"==e.display?e.text:"",disabled:"link"!=e.display},on:{input:e.updateText}})]}}])}),e._v(" "),n("input",{style:{display:"none"},attrs:{type:"submit"}})],1)],1)],1)};i._withStripped=!0;var r=n("i7/w"),o=n.n(r),a=n("nEm4"),s=n.n(a),u=n("i/kK"),c=n.n(u),l=n("oMuj"),d=n.n(l),f=n("tkAW"),p=n.n(f),m=n("u5iS"),h=n.n(m),v=n("vF5l"),k=n.n(v),_=n("nXMa"),g=n.n(_),y=n("BN8m"),b=n.n(y),w={components:{Form:s.a,FormRow:c.a,InputText:d.a,Modal:p.a,ModalContent:h.a,Button:k.a,ButtonCancel:g.a,ButtonGroup:b.a},props:{isNew:Boolean,attrs:Object,save:Function,isMedia:Function},data:function(){return{url:this.attrs.url,text:this.attrs.text,loading:!1,display:this.attrs.type||"link",wasText:!!this.attrs.text,error:null}},computed:{urlIsMedia:function(){return this.isMedia&&this.isMedia(this.url)},formValue:function(){return{type:this.display,url:this.url,text:this.text}},formValid:function(){return!!this.url}},watch:{urlIsMedia:function(e){this.wasText||(this.display=e?"link_media":"link")},formValue:function(){this.error=null}},mounted:function(){var e=this;o.a.nextTick((function(){e.$refs.url&&e.$refs.url.$el&&e.$refs.url.$el.focus()}))},methods:{close:function(){this.$emit("request-close")},confirm:function(){var e=this;if(!this.loading){this.loading=!0;var t=this.formValue;Promise.resolve(this.save(t)).then(this.close).catch((function(e){console.error(e)})).then((function(){return e.loading=!1}))}},updateText:function(e){this.text=e}}},x=n("KHd+"),N=function(e){e.options.__langStrings={editor:["linkurl"],editor_weka:["done","displayas","display_text","edit_link","insert_link","error_no_url_info","type_embedded_media","type:linkcard","type:plainlink"],moodle:["ok","cancel"]}},S=Object(x.a)(w,i,[],!1,null,null,null);"function"==typeof N&&N(S),S.options.__hasBlocks={script:!0,template:!0},S.options.__file="client/src/editor_weka/components/editing/EditLinkModal.vue";t.default=S.exports},AApu:function(e,t){e.exports=tui.require("tui/prosemirror/inputrules")},"AL+t":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/VideoBlock")},AtFJ:function(e,t){e.exports=tui.require("editor_weka/components/nodes/AudioBlock")},BDOe:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),r=n("z3By"),o=n("+pLW"),a=n.n(o);t.default=function(e){var t=new i.PluginKey("mentions"),n=new r.default(e),o=new RegExp("@[^@\\s]+","g");return new i.Plugin({key:t,view:function(){var e=this;return{update:function(t){var i=e.key.getState(t.state),r=i.text,o=i.active,s=i.range;n.destroyInstance(),r&&o&&n.showList({view:t,component:{name:"mention",component:a.a,attrs:function(e,t){return{id:e,display:t}}},state:{text:r.slice(1),active:o,range:s}})}}},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,t){return n.apply(e,t,o)}},props:{handleKeyDown:function(e,t){if("Escape"===t.key)return!!this.getState(e.state).active&&(n.destroyInstance(),e.focus(),!0)}}})}},BN8m:function(e,t){e.exports=tui.require("tui/components/buttons/ButtonGroup")},BPQQ:function(e,t,n){"use strict";n.r(t),t.default={props:{filename:{type:String,required:!0},fileSize:{type:[String,Number],required:!0},draftId:{type:[String,Number],required:!0},hasDownloadUrl:Boolean}}},C9aM:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-imageBlock"},[e.$apollo.loading?[n("p",{staticClass:"tui-editorWeka-imageBlock__text"},[e._v("\n      "+e._s(e.$str("loadinghelp","moodle"))+"\n    ")])]:n("div",{staticClass:"tui-editorWeka-imageBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.$_hideModal}},[n("EditImageAltTextModal",{attrs:{value:e.altText},on:{change:e.$_updateAltText}})],1),e._v(" "),n("ImageBlock",{attrs:{url:e.file.url,filename:e.filename,"alt-text":e.altText}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)],2)};i._withStripped=!0;var r=n("iPZg"),o=n.n(r),a=n("tnXT"),s=n.n(a),u=n("hg2Q"),c=n("r4xq"),l=n.n(c),d=n("yHzl"),f=n.n(d),p=n("Mnur"),m=n.n(p),h={components:{EditImageAltTextModal:f.a,ModalPresenter:m.a,ImageBlock:o.a,NodeBar:l.a},extends:s.a,apollo:{file:{query:u.a,variables:function(){return{filename:this.filename,item_id:this.itemId}}}},data:function(){return{file:{},showModal:!1}},computed:{hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.altTextLabel,action:function(){e.$_showModal()}},{label:this.$str("remove","moodle"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){window.document.location.href=e.downloadUrl}}),t},altTextLabel:function(){return this.altText?this.$str("edit_image_alt_text","editor_weka"):this.$str("add_image_alt_text","editor_weka")},altText:function(){return this.attrs.alttext?this.attrs.alttext:""},filename:function(){return this.attrs.filename?this.attrs.filename:null},itemId:function(){if(!this.context.getItemId)throw new Error("No function 'getItemId' for extension media");return this.context.getItemId()},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,alttext:this.altText,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}},$_showModal:function(){this.showModal=!0},$_hideModal:function(){this.showModal=!1},$_updateAltText:function(e){if(this.$_hideModal(),this.context.updateImage){var t={filename:this.filename,alttext:e,mimeType:this.file.mime_type};this.context.updateImage(this.getRange,t)}},$_removeNode:function(){if(this.context.removeNode)return this.context.removeNode(this.getRange)}}},v=n("KHd+"),k=function(e){e.options.__langStrings={moodle:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","add_image_alt_text","edit_image_alt_text","actions_menu_for"]}},_=Object(v.a)(h,i,[],!1,null,null,null);"function"==typeof k&&k(_),_.options.__hasBlocks={script:!0,template:!0},_.options.__file="client/src/editor_weka/components/nodes/ImageBlock.vue";t.default=_.exports},"Cx/y":function(e,t){e.exports=tui.require("editor_weka/components/nodes/ImageBlock")},D3bS:function(e,t){e.exports=tui.require("editor_weka/components/attachments/ImageAttachment")},DgbO:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=(n("n31W"),n("VUoS")),u=function(){function e(){r()(this,e),this._editor=null,this._state=null,this._doc=null,this._map=null,Object.preventExtensions(this)}return a()(e,[{key:"inflated",value:function(e){return this._editor==e||this._map&&!!this._map[e.uid]}},{key:"inflate",value:function(e,t){this._editor?(this._map||(this._map={}),this._map[e.uid]=t):(this._editor=e,this._state=t)}},{key:"getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this._editor===e?this._state:this._map&&this._map[e.uid]?this._map[e.uid]:null:this._state}},{key:"getDoc",value:function(){return this._doc||(this._doc=this._state.toJSON().doc),this._doc}},{key:"toJSON",value:function(){return this.getDoc()}},{key:"isEmpty",get:function(){if(this._state){var e=this._state.doc;return 0===e.childCount||1===e.childCount&&e.firstChild.isTextblock&&0===e.firstChild.content.size}if(this._doc){if(0===c(this._doc))return!0;if(1===c(this._doc)){var t=this._doc.content[0];return"paragraph"==t.type&&0===c(t)}return!1}return!0}},{key:"fileStorageItemId",get:function(){return this._editor&&this._editor.getFileStorageItemId()}}],[{key:"fromState",value:function(t,n){var i=new e;return i._editor=n,i._state=t,i}},{key:"fromDoc",value:function(t){var n=new e;return n._doc=t,n}},{key:"empty",value:function(){return e.fromDoc(Object(s.getDefaultDocument)())}}]),e}();function c(e){return e&&e.content?e.content.length:0}},EBtw:function(e,t){e.exports=tui.require("editor_weka/components/suggestion/Hashtag")},Ea1X:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-audioAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var r=n("RNtj"),o=n.n(r),a=n("r4xq"),s=n.n(a),u=n("zK61"),c=n.n(u),l={components:{AttachmentNode:o.a,NodeBar:s.a},mixins:[c.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","moodle"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){e.$emit("download")}}),t}}},d=n("KHd+"),f=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},p=Object(d.a)(l,i,[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/AudioAttachment.vue";t.default=p.exports},FGzX:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),r=n("EBtw"),o=n.n(r),a=n("z3By");t.default=function(e){var t=new i.PluginKey("hashtags"),n=new a.default(e),r=n.resetComponent(),s=new RegExp("#[A-Za-z0-9]+$","g"),u=function(e){var t=n.getNode(e.state,"hashtag",{text:r.text.slice(1)});n.convertToNode(r,t),r=n.resetComponent()};return new i.Plugin({key:t,view:function(){var e=this;return{update:function(t){var i=e.key.getState(t.state),a=i.text,s=i.active,u=i.range;n.destroyInstance(),a&&s&&n.showList({view:t,component:{name:"hashtag",component:o.a,attrs:function(e,t){return{text:t}}},state:{text:a.slice(1),active:s,range:u},callback:function(){r=n.resetComponent()}})}}},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,t){return n.apply(e,t,s,r)}},props:{handleKeyDown:function(e,t){r.text.length<=0||(t.key.includes("Arrow")?r=n.resetComponent():(r.apply=void 0!==[" ","Tab","Enter","PageUp","PageDown","Home","End","Escape"].find((function(e){return e===t.key})),r.apply&&u(e)))},handleClick:function(e){return!(r.text.length<=0)&&(!(r.from<=e.state.selection.from&&r.to>=e.state.selection.to)&&(u(e),!0))}}})}},Fmi9:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement;return(e._self._c||t)("ButtonIcon",{staticClass:"tui-editorWeka-toolbarButton",attrs:{styleclass:{toolbar:!0,selected:e.selected},"aria-label":e.text,"aria-pressed":e.ariaPressed,title:e.text,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}},[e._t("icon")],2)};i._withStripped=!0;var r=n("5h9J"),o={components:{ButtonIcon:n.n(r).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},disabled:Boolean},computed:{ariaPressed:function(){return null!=this.selected&&(this.selected?"true":"false")}}},a=n("KHd+"),s=Object(a.a)(o,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/toolbar/ToolbarButton.vue";t.default=s.exports},FtgP:function(e,t){e.exports=tui.require("tui/prosemirror/commands")},FtnZ:function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeSelection",(function(){return s})),n.d(t,"equalNodeType",(function(){return u})),n.d(t,"cloneTr",(function(){return c})),n.d(t,"replaceNodeAtPos",(function(){return l})),n.d(t,"canReplace",(function(){return d})),n.d(t,"removeNodeAtPos",(function(){return f})),n.d(t,"tableNodeTypes",(function(){return p})),n.d(t,"canInsert",(function(){return m})),n.d(t,"isEmptyParagraph",(function(){return h})),n.d(t,"findTableClosestToPos",(function(){return v})),n.d(t,"createCell",(function(){return k})),n.d(t,"transpose",(function(){return _})),n.d(t,"checkInvalidMovements",(function(){return g}));var i=n("n31W"),r=n("wd6j"),o=n("Jfd+"),a=n("/Kfb"),s=function(e){return e instanceof i.NodeSelection},u=function(e,t){return Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e},c=function(e){return Object.assign(Object.create(e),e).setTime(Date.now())},l=function(e,t){return function(n){var i=n.doc.nodeAt(e),r=n.doc.resolve(e);if(d(r,t)){var a=(n=n.replaceWith(e,e+i.nodeSize,t)).selection.$from.pos-1;return n=Object(o.setTextSelection)(Math.max(a,0),-1)(n),n=Object(o.setTextSelection)(n.selection.$from.start())(n),c(n)}return n}},d=function(e,t){var n=e.node(e.depth);return n&&n.type.validContent(t instanceof r.Fragment?t:r.Fragment.from(t))},f=function(e){return function(t){var n=t.doc.nodeAt(e);return c(t.delete(e,e+n.nodeSize))}},p=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;var t={};return Object.keys(e.nodes).forEach((function(n){var i=e.nodes[n];i.spec.tableRole&&(t[i.spec.tableRole]=i)})),e.cached.tableNodeTypes=t,t},m=function(e,t){var n=e.index();return t instanceof r.Fragment?e.parent.canReplace(n,n,t):t instanceof r.Node&&e.parent.canReplaceWith(n,n,t.type)},h=function(e){return!e||"paragraph"===e.type.name&&2===e.nodeSize},v=function(e){return Object(a.findParentNodeClosestToPos)(e,(function(e){return e.type.spec.tableRole&&/table/i.test(e.type.spec.tableRole)}))},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?e.createChecked(null,t):e.createAndFill()},_=function(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))},g=function(e,t,n,i){var r=e>t?-1:1,o="Target position is invalid, you can't move the ".concat(i," ").concat(e," to ").concat(t,", the target can't be split. You could use tryToFit option.");if(1===r){if(-1!==n.slice(0,n.length-1).indexOf(t))throw new Error(o)}else if(-1!==n.slice(1).indexOf(t))throw new Error(o);return!0}},GMmN:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-linkMedia",class:{"tui-editorWeka-linkMedia--intrinsic-width":!e.attrs.loading&&!e.iframeUrl},attrs:{"data-url":e.attrs.url}},[n("div",{staticClass:"tui-editorWeka-linkMedia__inner"},[e.attrs.loading?n("div",[e._v("\n      Loading...\n    ")]):e.iframeUrl?n("div",{staticClass:"tui-editorWeka-linkMedia__embed"},[n("ResponsiveEmbedIframe",{attrs:{src:e.iframeUrl,resolution:e.attrs.resolution,title:e.attrs.title||e.attrs.url}})],1):"audio"==e.pluginKey?n("div",[n("audio",{attrs:{controls:"",src:e.attrs.url}})]):"image"==e.pluginKey?n("div",[n("ResponsiveImage",{attrs:{src:e.attrs.url}})],1):n("div",[n("a",{attrs:{href:e.attrs.url}},[e._v(e._s(e.attrs.url))])]),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.summaryText)}})],1)])};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("r4xq"),s=n.n(a),u=n("3bgQ"),c=n.n(u),l=n("IBd2"),d=n.n(l),f={components:{NodeBar:s.a,ResponsiveEmbedIframe:c.a,ResponsiveImage:d.a},extends:o.a,computed:{pluginMatch:function(){return this.context.urlPlugin({type:"media",url:this.attrs.url})||{}},pluginKey:function(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.key},pluginName:function(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.name},details:function(){return this.pluginMatch.details||{}},actions:function(){var e=this;return[{label:this.$str("go_to_link","editor_weka"),action:function(){return e.open()}},{label:this.$str("edit","moodle"),action:function(){return e.edit()}},{label:this.$str("display_as_text","editor_weka"),action:function(){return e.toLink()}},{label:this.$str("remove","moodle"),action:function(){return e.$emit("remove")}}]},iframeUrl:function(){var e=this.details;switch(this.pluginKey){case"youtube":return"https://www.youtube.com/embed/"+e.id+"?rel=0";case"vimeo":return"https://player.vimeo.com/video/"+e.id+"?portrait=0"}return null},summaryText:function(){return this.pluginName+" - "+(this.attrs.title||this.attrs.url)}},methods:{open:function(){window.open(this.attrs.url)},edit:function(){this.context.editCard(this.getRange)},toLink:function(){var e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})}}},p=n("KHd+"),m=function(e){e.options.__langStrings={editor_weka:["display_as_text","go_to_link","actions_menu_for"],moodle:["edit","remove"]}},h=Object(p.a)(f,i,[],!1,null,null,null);"function"==typeof m&&m(h),h.options.__hasBlocks={script:!0,template:!0},h.options.__file="client/src/editor_weka/components/nodes/LinkMedia.vue";t.default=h.exports},GqWi:function(e,t){e.exports=tui.require("editor_weka/components/attachments/VideoAttachment")},"H/tB":function(e,t){e.exports=tui.require("tui/tui")},HdaA:function(e,t,n){"use strict";n.r(t);var i={props:{nodeInfo:Object,contextInfo:Object,updateAttrs:Function,replaceWith:Function,getPos:Function,getRange:Function},computed:{node:function(){return this.nodeInfo.node},attrs:function(){return this.nodeInfo.node.attrs},context:function(){return this.contextInfo.context}}},r=n("KHd+"),o=Object(r.a)(i,void 0,void 0,!1,null,null,null);o.options.__hasBlocks={script:!0,template:!1},o.options.__file="client/src/editor_weka/components/nodes/BaseNode.vue";t.default=o.exports},HtKA:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("oBkI"),m=n("fvDX"),h=n("V68o"),v=n("rLLB"),k=n.n(v),_=n("fRht"),g=n.n(_),y=n("i7/w"),b=n.n(y),w=n("9COe"),x=n("iag4");function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var S=function(e){u()(n,e);var t=N(n);function n(e){var i;r()(this,n),i=t.call(this,e),void 0===e&&(e={}),i.emojis=e.emojis||[];var o=i.emojis.map((function(e){return e.pattern}));return i.charArray=o.toString().split(""),i.charArray=i.charArray.filter((function(e,t){return i.charArray.indexOf(e)===t})),i}return a()(n,[{key:"nodes",value:function(){return{emoji:{schema:{group:"inline",inline:!0,attrs:{shortcode:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-emoji",getAttrs:x.getJsonAttrs}],toDOM:function(e){return["span",{class:"tui-editorWeka-emoji","data-attrs":JSON.stringify({shortcode:e.attrs.shortcode})},String.fromCodePoint("0x"+e.attrs.shortcode)]}},component:g.a}}}},{key:"plugins",value:function(){return[Object(w.default)(this.editor,this.emojis,this.charArray)]}},{key:"toolbarItems",value:function(){return[new m.ToolbarItem({group:"embeds",popover:{title:"",component:this.getEmojiPopover()},label:Object(h.langString)("insertemoji","editor"),icon:"editor_weka|emoji",enabled:function(e){return e.view.state.selection.$head.pos>0},reset:function(e){e.view.focus()}})]}},{key:"getEmojiPopover",value:function(){var e=this;return b.a.extend({data:function(){return{insertEmoji:e.insertEmoji.bind(e),emojiData:e.emojis}},methods:{emojiSelected:function(e){this.$emit("close"),this.insertEmoji(e)}},render:function(e){return e(k.a,{props:{emojis:this.emojiData},on:{"emoji-selected":this.emojiSelected}})}})}},{key:"insertEmoji",value:function(e){var t=this,n=e.shortcode;this.editor.execute((function(e,i){var r=e.schema.node("emoji",{shortcode:n}),o=e.selection,a=o.from,s=o.to;i(e.tr.replaceWith(a,s,r)),t.editor.view.focus()}))}}]),n}(p.default);t.default=function(e){return new S(e)}},IBd2:function(e,t){e.exports=tui.require("tui/components/images/ResponsiveImage")},ISlu:function(e,t,n){var i={"./Weka":"cmE2","./Weka.vue":"cmE2","./attachments/AudioAttachment":"Ea1X","./attachments/AudioAttachment.vue":"Ea1X","./attachments/FileAttachment":"1RMz","./attachments/FileAttachment.vue":"1RMz","./attachments/ImageAttachment":"9E4C","./attachments/ImageAttachment.vue":"9E4C","./attachments/VideoAttachment":"T72/","./attachments/VideoAttachment.vue":"T72/","./editing/ActionDropdown":"3t4c","./editing/ActionDropdown.vue":"3t4c","./editing/EditImageAltTextModal":"3Nur","./editing/EditImageAltTextModal.vue":"3Nur","./editing/EditLinkModal":"9s3S","./editing/EditLinkModal.vue":"9s3S","./editing/Emojis":"78qK","./editing/Emojis.vue":"78qK","./editing/PositionedActionDropdown":"sjpv","./editing/PositionedActionDropdown.vue":"sjpv","./marks/Link":"YByl","./marks/Link.vue":"YByl","./nodes/Attachment":"p2bi","./nodes/Attachment.vue":"p2bi","./nodes/Attachments":"dlhR","./nodes/Attachments.vue":"dlhR","./nodes/AudioBlock":"JUJ1","./nodes/AudioBlock.vue":"JUJ1","./nodes/BaseNode":"HdaA","./nodes/BaseNode.vue":"HdaA","./nodes/Emoji":"fReT","./nodes/Emoji.vue":"fReT","./nodes/Hashtag":"euDZ","./nodes/Hashtag.vue":"euDZ","./nodes/ImageBlock":"C9aM","./nodes/ImageBlock.vue":"C9aM","./nodes/LinkBlock":"xYuG","./nodes/LinkBlock.vue":"xYuG","./nodes/LinkMedia":"GMmN","./nodes/LinkMedia.vue":"GMmN","./nodes/Mention":"bEBJ","./nodes/Mention.vue":"bEBJ","./nodes/VideoBlock":"ln5p","./nodes/VideoBlock.vue":"ln5p","./suggestion/Hashtag":"1k+S","./suggestion/Hashtag.vue":"1k+S","./suggestion/User":"5XLN","./suggestion/User.vue":"5XLN","./toolbar/NodeBar":"1bAF","./toolbar/NodeBar.vue":"1bAF","./toolbar/Toolbar":"hKQV","./toolbar/Toolbar.vue":"hKQV","./toolbar/ToolbarButton":"Fmi9","./toolbar/ToolbarButton.vue":"Fmi9","./upload/FilePicker":"x/Nx","./upload/FilePicker.vue":"x/Nx"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="ISlu"},"JMt+":function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("UpZR"),u=n.n(s),c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_repository_data"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"repository_data"},name:{kind:"Name",value:"editor_weka_repository_data"},arguments:[{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}},{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"item_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_get_linkmetadata"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_url"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"link"},name:{kind:"Name",value:"core_get_linkmetadata"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videoheight"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videowidth"},arguments:[],directives:[]}]}}]}}]},d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_media_type_of_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]}]}}]}}]};function f(e){return p.apply(this,arguments)}function p(){return(p=a()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.query({query:l,variables:{url:t}});case 2:return n=e.sent,e.abrupt("return",n.data.link);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=a()(r.a.mark((function e(t){var n,i,o,a,s,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.component,i=t.area,o=t.contextId,a=t.instanceId,e.next=3,u.a.mutate({mutation:c,variables:{component:n,area:i,context_id:o,instance_id:a}});case 3:return s=e.sent,l=s.data.result,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return k.apply(this,arguments)}function k(){return(k=a()(r.a.mark((function e(t){var n,i,o,a,s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.itemId,i=t.filename,e.next=3,u.a.query({query:d,variables:{item_id:n,filename:i}});case 3:return o=e.sent,a=o.data.file,s=a.media_type,c=a.mime_type,e.abrupt("return",{mediaType:s,mimeType:c});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"getLinkMetadata",(function(){return f})),n.d(t,"prepareDraftFileArea",(function(){return m})),n.d(t,"getMediaType",(function(){return v}))},JUJ1:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-audioBlock"},[e.$apollo.loading?e._e():[n("div",{staticClass:"tui-editorWeka-audioBlock__inner"},[n("CoreAudioBlock",{attrs:{filename:e.filename,"item-id":e.itemId,url:e.file.url,"mime-type":e.file.mime_type}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)};i._withStripped=!0;var r=n("00Pk"),o=n.n(r),a=n("tnXT"),s=n.n(a),u=n("hg2Q"),c=n("r4xq"),l=n.n(c),d={components:{CoreAudioBlock:o.a,NodeBar:l.a},extends:s.a,apollo:{file:{query:u.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.$str("remove","moodle"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){window.document.location.href=e.downloadUrl}}),t},itemId:function(){if(!this.context.getItemId)throw new Error('No function "getItemId" found for extension media');return this.context.getItemId()},filename:function(){return this.attrs.filename?this.attrs.filename:null},hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_removeNode:function(){if(this.context.removeNode)return this.context.removeNode(this.getRange)},$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}}}},f=n("KHd+"),p=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["display_as_attachment","actions_menu_for"]}},m=Object(f.a)(d,i,[],!1,null,null,null);"function"==typeof p&&p(m),m.options.__hasBlocks={script:!0,template:!0},m.options.__file="client/src/editor_weka/components/nodes/AudioBlock.vue";t.default=m.exports},"Jfd+":function(e,t,n){"use strict";n.r(t),n.d(t,"removeParentNodeOfType",(function(){return s})),n.d(t,"replaceParentNodeOfType",(function(){return u})),n.d(t,"removeSelectedNode",(function(){return c})),n.d(t,"replaceSelectedNode",(function(){return l})),n.d(t,"setTextSelection",(function(){return d})),n.d(t,"safeInsert",(function(){return m})),n.d(t,"setParentNodeMarkup",(function(){return h})),n.d(t,"selectParentNodeOfType",(function(){return v})),n.d(t,"removeNodeBefore",(function(){return k}));var i=n("n31W"),r=n("wd6j"),o=n("/Kfb"),a=n("FtnZ"),s=function(e){return function(t){var n=Object(o.findParentNodeOfType)(e)(t.selection);return n?Object(a.removeNodeAtPos)(n.pos)(t):t}},u=function(e,t){return function(n){Array.isArray(e)||(e=[e]);for(var i=0,r=e.length;i<r;i++){var s=Object(o.findParentNodeOfType)(e[i])(n.selection);if(s){var u=Object(a.replaceNodeAtPos)(s.pos,t)(n);if(u!==n)return u}}return n}},c=function(e){if(Object(a.isNodeSelection)(e.selection)){var t=e.selection.$from.pos,n=e.selection.$to.pos;return Object(a.cloneTr)(e.delete(t,n))}return e},l=function(e){return function(t){if(Object(a.isNodeSelection)(t.selection)){var n=t.selection,o=n.$from,s=n.$to;if(e instanceof r.Fragment&&o.parent.canReplace(o.index(),o.indexAfter(),e)||o.parent.canReplaceWith(o.index(),o.indexAfter(),e.type))return Object(a.cloneTr)(t.replaceWith(o.pos,s.pos,e).setSelection(new i.NodeSelection(t.doc.resolve(o.pos))))}return t}},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){var r=i.Selection.findFrom(n.doc.resolve(e),t,!0);return r?n.setSelection(r):n}},f=function(e){return e.type&&e.type.spec.selectable},p=function(e,t,n){return function(e){return f(e)&&e.type.isLeaf}(e)?n.setSelection(new i.NodeSelection(n.doc.resolve(t))):d(t)(n)},m=function(e,t,n){return function(i){var r="number"==typeof t,o=i.selection.$from,s=r?i.doc.resolve(t):Object(a.isNodeSelection)(i.selection)?i.doc.resolve(o.pos+1):o,c=s.parent;if(Object(a.isNodeSelection)(i.selection)&&n&&i!==(i=l(e)(i)))return i;if(Object(a.isEmptyParagraph)(c)&&i!==(i=u(c.type,e)(i))){var d=f(e)?s.before(s.depth):s.pos;return p(e,d,i)}if(Object(a.canInsert)(s,e)){i.insert(s.pos,e);var m=r?s.pos:f(e)?i.selection.$anchor.pos-1:i.selection.$anchor.pos;return Object(a.cloneTr)(p(e,m,i))}for(var h=s.depth;h>0;h--){var v=s.after(h),k=i.doc.resolve(v);if(Object(a.canInsert)(k,e))return i.insert(v,e),Object(a.cloneTr)(p(e,v,i))}return i}},h=function(e,t,n,i){return function(r){var s=Object(o.findParentNodeOfType)(e)(r.selection);return s?Object(a.cloneTr)(r.setNodeMarkup(s.pos,t,Object.assign({},s.node.attrs,n),i)):r}},v=function(e){return function(t){if(!Object(a.isNodeSelection)(t.selection)){var n=Object(o.findParentNodeOfType)(e)(t.selection);if(n)return Object(a.cloneTr)(t.setSelection(i.NodeSelection.create(t.doc,n.pos)))}return t}},k=function(e){var t=Object(o.findPositionOfNodeBefore)(e.selection);return"number"==typeof t?Object(a.removeNodeAtPos)(t)(e):e}},KGcv:function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownItem")},KRvX:function(e,t){e.exports=tui.require("tui/components/buttons/Submit")},MJ7y:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("JMt+"),f=n("ddKQ"),p=n("V68o"),m=Object.prototype.hasOwnProperty,h=function(){function e(t){var n=t.component,i=t.area,r=t.instanceId,o=t.contextId;u()(this,e),this.repositoryData=null,this.files={},this.contextId=o,this.component=n,this.area=i,this.instanceId=r}var t,n,i;return l()(e,[{key:"getContextId",value:function(){return this.contextId}},{key:"getComponent",value:function(){return this.component}},{key:"getArea",value:function(){return this.area}},{key:"setRepositoryData",value:function(e){var t=e.item_id,n=e.repository_id,i=e.url;this.repositoryData||(this.repositoryData={itemId:t,repositoryId:n,url:i})}},{key:"_fetchRepositoryData",value:(i=a()(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(t.repositoryData)e("done");else{var n={component:t.component,area:t.area,contextId:t.contextId,instanceId:t.instanceId};Object(d.prepareDraftFileArea)(n).then((function(n){var i=n.item_id,r=n.repository_id,o=n.url;t.setRepositoryData({item_id:i,repository_id:r,url:o}),e("done")}))}})));case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"getRepositoryData",value:function(){return this.repositoryData}},{key:"addFile",value:function(e){var t=e.file,n=e.size,i=e.url;m.call(this.files,t)||(this.files[t]={file:t,size:n,url:i})}},{key:"getFile",value:function(e){return m.call(this.files,e)?this.files[e]:null}},{key:"uploadFile",value:(n=a()(r.a.mark((function e(t,n){var i,o,a,s,u,c,l,d,h,v,k,_,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchRepositoryData();case 2:return i=this.repositoryData,o=i.itemId,a=i.repositoryId,s=i.url,e.next=5,Object(f.upload)({file:t,contextId:this.contextId,acceptTypes:n,repositoryId:a,itemId:o,url:s});case 5:if(u=e.sent,!m.call(u,"id")||!m.call(u,"file")){e.next=13;break}return(c=Object.assign({},u)).size=t.size,this.addFile(c),e.abrupt("return",c);case 13:if(!m.call(u,"event")||"fileexists"!==u.event){e.next=20;break}if(l=u.existingfile.filename,d=u.newfile,h=d.filename,v=d.url,!m.call(this.files,l)){e.next=20;break}return k=this.files[l].size,_={id:this.repositoryData.itemId,url:v,file:h,size:k},this.addFile(_),e.abrupt("return",_);case 20:return g=Object(p.langString)("invalid_response","editor_weka"),e.next=23,Object(p.loadLangStrings)([g]);case 23:throw new Error(g.toString());case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"uploadFiles",value:(t=a()(r.a.mark((function e(t,n){var i=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.prototype.slice.call(n),t=Object(f.parseFiles)(t),e.abrupt("return",new Promise((function(e,r){0!==t.length?Promise.all(t.map((function(e){return i.uploadFile(e,n)}))).then((function(t){e(t)})).catch((function(e){r(e)})):e([])})));case 3:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}()},MbZ7:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("oBkI"),m=n("FGzX"),h=n("nFyd"),v=n.n(h);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var _=function(e){u()(n,e);var t=k(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{hashtag:{schema:{group:"inline",inline:!0,attrs:{text:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-node__hashtag",getAttrs:function(e){try{return{text:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:function(e){return["span",{class:"tui-editorWeka-node__hashtag"},"#"+e.attrs.text]}},component:v.a}}}},{key:"plugins",value:function(){return[Object(m.default)(this.editor)]}}]),n}(p.default);t.default=function(e){return new _(e)}},Mnur:function(e,t){e.exports=tui.require("tui/components/modal/ModalPresenter")},Nfo2:function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkBlock")},O2zc:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("oBkI"),m=n("V68o"),h=n("fvDX"),v=n("WI/B"),k=n("qSeW"),_=n("AApu");function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var y=["ol",0],b=["ul",0],w=["li",0],x=function(e){u()(n,e);var t=g(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{bullet_list:{schema:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:function(){return b}}},ordered_list:{schema:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1}}}],toDOM:function(e){return 1==e.attrs.order?y:["ol",{start:e.attrs.order},0]}}},list_item:{schema:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:function(){return w},defining:!0,draggable:!1}}}}},{key:"toolbarItems",value:function(){var e=this.getSchema().nodes,t=e.bullet_list,n=e.ordered_list,i=e.list_item,r=[t,n];return[Object(h.cmdItem)(Object(v.toggleList)(t,i,r),{group:"node",label:Object(m.langString)("bulletlist","editor"),icon:"editor_weka|bulletlist",active:function(e){return Object(v.isListActive)(e.state,t)}}),Object(h.cmdItem)(Object(v.toggleList)(n,i,r),{group:"node",label:Object(m.langString)("numberedlist","editor"),icon:"editor_weka|numberedlist",active:function(e){return Object(v.isListActive)(e.state,n)}})]}},{key:"keymap",value:function(e){var t=this.getSchema().nodes,n=t.bullet_list,i=t.ordered_list,r=t.list_item,o=[n,i];e("Shift-Ctrl-8",Object(v.toggleList)(n,r,o)),e("Shift-Ctrl-9",Object(v.toggleList)(i,r,o)),e("Enter",Object(k.splitListItem)(r)),e("Shift-Tab",Object(k.liftListItem)(r)),e("Tab",Object(k.sinkListItem)(r))}},{key:"inputRules",value:function(){var e,t=this.getSchema().nodes,n=t.bullet_list,i=t.ordered_list;return[(e=n,Object(_.wrappingInputRule)(/^\s*([-+*])\s$/,e)),N(i)]}}]),n}(p.default);function N(e){return Object(_.wrappingInputRule)(/^(\d+)\.\s$/,e,(function(e){return{order:+e[1]}}),(function(e,t){return t.childCount+t.attrs.order==+e[1]}))}t.default=function(e){return new x(e)}},OQYi:function(e,t){e.exports=tui.require("tui/prosemirror/history")},OWva:function(e,t){e.exports=tui.require("editor_weka/components/editing/PositionedActionDropdown")},OxlY:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditLinkModal")},QCX9:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Emoji")},RNtj:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNode")},SFqO:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("oBkI"),m=n("V68o"),h=n("fvDX"),v=n("FtgP"),k=n("AApu");function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var g=["blockquote",0],y=["em",0],b=["strong",0],w=["h4","h5"],x=function(e){u()(n,e);var t=_(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{blockquote:{schema:{group:"block",content:"block+",parseDOM:[{tag:"blockquote"}],toDOM:function(){return g}}},heading:{schema:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},view:function(e){var t=Math.max(e.attrs.level,1)-1,n=w[t]||w[w.length-1],i=document.createElement(n);return{dom:i,contentDOM:i}}},hard_break:{schema:{group:"inline",parseDOM:[{tag:"br"}],toDOM:function(){return["br"]},inline:!0,selectable:!1}}}}},{key:"marks",value:function(){return{em:{schema:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return y}}},strong:{schema:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!=e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return b}}}}}},{key:"toolbarItems",value:function(){var e=this.getSchema().nodes.paragraph,t=this.getSchema().nodes.heading,n=this.getSchema().marks.strong,i=this.getSchema().marks.em;return[Object(h.blockTypeItem)(e,{},{group:"blocks",label:Object(m.langString)("paragraph","editor")}),Object(h.blockTypeItem)(t,{attrs:{level:1}},{group:"blocks",label:Object(m.langString)("heading","editor")}),Object(h.blockTypeItem)(t,{attrs:{level:2}},{group:"blocks",label:Object(m.langString)("subheading","editor")}),Object(h.markItem)(n,{group:"marks",label:Object(m.langString)("bold","editor"),icon:"editor_weka|bold"}),Object(h.markItem)(i,{group:"marks",label:Object(m.langString)("italic","editor"),icon:"editor_weka|italic"})]}},{key:"keymap",value:function(e,t){var n=t.isMac,i=this.getSchema().nodes,r=i.paragraph,o=i.blockquote,a=i.heading,s=i.hard_break,u=this.getSchema().marks,c=u.strong,l=u.em;e("Shift-Ctrl-0",Object(v.setBlockType)(r)),e("Ctrl->",Object(v.wrapIn)(o));for(var d=1;d<=6;d++)e("Shift-Ctrl-"+d,Object(v.setBlockType)(a,{level:d}));var f=function(e,t){return t(e.tr.replaceSelectionWith(s.create()).scrollIntoView()),!0};e("Mod-Enter",f),e("Shift-Enter",f),n&&e("Ctrl-Enter",f),e("Mod-b",Object(v.toggleMark)(c)),e("Mod-B",Object(v.toggleMark)(c)),e("Mod-i",Object(v.toggleMark)(l)),e("Mod-I",Object(v.toggleMark)(l))}},{key:"inputRules",value:function(){var e,t=this.getSchema().nodes,n=t.blockquote,i=t.heading;return[k.ellipsis,(e=n,Object(k.wrappingInputRule)(/^\s*>\s$/,e)),N(i,6)]}}]),n}(p.default);function N(e,t){return Object(k.textblockTypeInputRule)(new RegExp("^(#{1,"+t+"})\\s$"),e,(function(e){return{level:e[1].length}}))}t.default=function(e){return new x(e)}},"T7/7":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("n31W"),u=n("rR9N"),c=n("a2/6"),l=n("OQYi"),d=n("FtgP"),f=n("o7S+"),p=n("c+sf"),m=n("AApu"),h=n("5yv7"),v=n("wbdD"),k=n("lELM"),_=(n("zLSG"),n("x4h3")),g=n("DgbO"),y=n("TXEh"),b=n("vyVp"),w=n("V68o"),x=function(){function e(t){var n=this;r()(this,e),this.uid=Object(y.uniqueId)(),this._options=t,this._parent=t.parent,this.viewExtrasEl=t.viewExtrasEl,this.viewExtrasLiveEl=t.viewExtrasLiveEl,this._extensions=t.extensions||[],this.fileStorage=t.fileStorage,this._extensions.forEach((function(e){return e.setEditor(n)}));var i={};this._nodeViews={};var o={};this._markViews={},this._allVueComponents=[],this._extensions.forEach((function(e){n._extractExtensionSchema(e,"node","nodes",i,n._nodeViews),n._extractExtensionSchema(e,"mark","marks",o,n._nodeViews)})),this.schema=Object(v.createSchema)({nodes:i,marks:o}),this._plugins=[Object(_.default)(t.placeholder)],this._extensions.forEach((function(e){var t=e.plugins();t&&t.forEach((function(e){return n._plugins.push(e)}))})),this._toolbarItemInstances=this._extensions.reduce((function(e,t){return t.toolbarItems?e.concat(t.toolbarItems()):e}),[]),this._toolbarItems=this._toolbarItemInstances.map((function(e){return e.getDef()})),this._mapKeys=this._extensions.map((function(e){return e.keymap&&e.keymap.bind(e)})).filter(Boolean),this._inputRules=this._extensions.reduce((function(e,t){return t.inputRules?e.concat(t.inputRules()):e}),[]),this.dispatch=this.dispatch.bind(this),this.execute=this.execute.bind(this),this.getFileStorageItemId=this.getFileStorageItemId.bind(this),this.setValue(t.value)}return a()(e,[{key:"_extractExtensionSchema",value:function(e,t,n,i,r){var o=e[n]&&e[n]();if(o)for(var a in o){var s=o[a];i[a]&&console.warn("[editor_weka] ".concat(t,' "').concat(a,'" was redefined')),i[a]=s.schema,s.component&&(this._allVueComponents.push(s.component),r[a]=this._componentNodeView.bind(this,s.component,s.componentContext)),s.view&&(r[a]=s.view)}}},{key:"setValue",value:function(e){if(!e.inflated(this)){var t=s.EditorState.fromJSON(this._editorConfig(),{doc:e.getDoc(),selection:{anchor:0,head:0,type:"text"}});e.inflate(this,t)}this._value=e,this.state=e.getState(this),this.view&&this.view.updateState(this.state)}},{key:"_editorConfig",value:function(){return{schema:this.schema,plugins:this._createPlugins()}}},{key:"createView",value:function(e){return this.view=new u.EditorView(e,{state:this.state,dispatchTransaction:this.dispatch,nodeViews:this._nodeViews,attributes:{class:"tui-weka-editor"}}),this.view}},{key:"allVueComponents",value:function(){return this._allVueComponents}},{key:"allStrings",value:function(){return this._toolbarItems.filter((function(e){return e.label})).map((function(e){return e.label}))}},{key:"getParent",value:function(){return this._parent}},{key:"_componentNodeView",value:function(e,t,n,i,r){return new k.default(e,{editor:this,node:n,view:i,getPos:r,parent:this._parent,context:t})}},{key:"dispatch",value:function(e){var t=this.state.apply(e);this.view.updateState(t),this.state=t,this._value=g.default.fromState(t,this),this._options.onTransaction&&this._options.onTransaction({value:this._value,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this._options.onUpdate&&this._options.onUpdate(this._value)}},{key:"getFileStorageItemId",value:function(){var e=this.fileStorage.getRepositoryData();return e?e.itemId:null}},{key:"_createPlugins",value:function(){var e=[];return Array.isArray(this._plugins)&&(e=this._plugins),e.concat(Object(m.inputRules)({rules:this._inputRules}),Object(c.keymap)(Object(h.buildKeymap)(this.schema,this._mapKeys)),Object(c.keymap)(d.baseKeymap),Object(f.dropCursor)(),Object(p.gapCursor)(),Object(l.history)())}},{key:"getToolbarItems",value:function(){var e=this;return this._toolbarItemInstances.forEach((function(t){return t.update(e)})),this._toolbarItems}},{key:"execute",value:function(e){try{return e(this.state,this.dispatch,this.view)}catch(e){console.error("[Weka] Failed to execute command."),console.error(e);var t=Object(w.langString)("error_failed_to_execute","editor_weka");return Object(w.loadLangStrings)([t]).then((function(){return Object(b.notify)({type:"error",message:t.toString()})})),!1}}},{key:"canExecute",value:function(e){return e(this.state,null,null)}},{key:"hasNode",value:function(e){return e in this.state.schema.nodes}},{key:"destroy",value:function(){this.view&&this.view.destroy()}}]),e}()},"T72/":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-videoAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var r=n("RNtj"),o=n.n(r),a=n("r4xq"),s=n.n(a),u=n("zK61"),c=n.n(u),l={components:{NodeBar:s.a,AttachmentNode:o.a},mixins:[c.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","moodle"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){e.$emit("download")}}),t}}},d=n("KHd+"),f=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],moodle:["remove","download"]}},p=Object(d.a)(l,i,[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/VideoAttachment.vue";t.default=p.exports},"TGM/":function(e,t){e.exports=tui.require("tui/pending")},TXEh:function(e,t){e.exports=tui.require("tui/util")},UpZR:function(e,t){e.exports=tui.require("tui/apollo_client")},V68o:function(e,t){e.exports=tui.require("tui/i18n")},VUoS:function(e,t,n){"use strict";function i(){return{type:"doc",content:[{type:"paragraph"}]}}n.r(t),n.d(t,"getDefaultDocument",(function(){return i}))},"WI/B":function(e,t,n){"use strict";n.r(t),n.d(t,"toggleList",(function(){return o})),n.d(t,"isListActive",(function(){return a}));var i=n("qSeW"),r=n("/Kfb");n("wd6j"),n("n31W");function o(e,t,n){var o=Object(i.liftListItem)(t),a=Object(i.wrapInList)(e);return function(t,i,s){var u=t.selection,c=u.$from.blockRange(u.$to);if(!c)return!1;var l=function(e,t){return Object(r.findParentNode)((function(e){return t.includes(e.type)}))(e)}(u,n),d=l&&c.depth-l.depth<=1;if(c.depth>=1&&d){if(l.node.type===e)return o(t,i,s);if(e.validContent(l.node.content))return i&&i(t.tr.setNodeMarkup(l.pos,e)),!0}return a(t,i,s)}}function a(e,t){var n=e.selection,i=n.$from.blockRange(n.$to);if(!i)return!1;var o=Object(r.findParentNode)((function(e){return e.type==t}))(n);return i.depth>=1&&o&&i.depth-o.depth<=1}},Wdod:function(e,t){e.exports=tui.require("editor_weka/components/upload/FilePicker")},X7tx:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"expandContentResolvedRange",(function(){return u})),n.d(t,"getMark",(function(){return c})),n.d(t,"ResolvedRange",(function(){return l}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o);function s(e,t){var n=d(e);if(!n.node)return!1;var i=n.node.marks.find((function(e){return e.type===t}));if(!i)return!1;var r=e.index(),o=e.start()+n.offset,a=o+n.node.nodeSize;return{from:f(e.parent,i,r,o,-1),to:f(e.parent,i,r,a,1)}}function u(e){if(e&&e.$from.parent!=e.$from.doc&&e.$from.sameParent(e.$to)&&0===e.$from.parentOffset&&e.$to.parentOffset===e.$to.parent.nodeSize-2){var t=e.$from.doc;return new l(t.resolve(e.$from.pos-1),t.resolve(e.$to.pos+1))}return e}function c(e,t){return d(e).node.marks.find((function(e){return e.type===t}))}var l=function(){function e(t,n){r()(this,e),this.$from=t,this.$to=n}return a()(e,null,[{key:"resolve",value:function(t,n){return new e(t.resolve(n.from),t.resolve(n.to))}}]),e}();function d(e){return e.parent.childAfter(e.parentOffset)}function f(e,t,n,i,r){for(var o=e.childCount-1;!((n+=r)<0||n>o);){var a=e.child(n);if(!t.isInSet(a.marks))break;i+=e.child(n).nodeSize*r}return i}},Y4vP:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Mention")},YByl:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"tui-editorWeka-link"},[n("a",{ref:"content",attrs:{href:e.attrs.href,title:e.attrs.title},on:{click:e.showDropdown}}),e._v(" "),n("ButtonIcon",{staticClass:"tui-editorWeka-link__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":e.dropdownShown.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.textContent)},on:{click:e.showDropdown}},[n("More")],1)],1)};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("5h9J"),s=n.n(a),u=n("hCGN"),c=n.n(u),l=n("TGM/"),d=n.n(l),f={components:{ButtonIcon:s.a,More:c.a},extends:o.a,props:{ariaLabel:String},data:function(){return{textContent:"",dropdownShown:!1}},mounted:function(){this.observer=new MutationObserver(this.$_updateTextContent),this.observer.observe(this.$refs.content,{childList:!0,subtree:!0,characterData:!0}),this.$_updateTextContent()},beforeDestroy:function(){this.observer.disconnect()},methods:{showDropdown:function(){var e=this;this.context.showMarkDropdown(this.getRange).then((function(t){e.dropdownShown=!0,t.$on("dismiss",(function(){return e.dropdownShown=!1}))}))},$_updateTextContent:function(){var e=this,t=d()();setTimeout((function(){t(),e.textContent=e.$refs.content.textContent}),0)}}},p=n("KHd+"),m=function(e){e.options.__langStrings={editor_weka:["actions_menu_for"]}},h=Object(p.a)(f,i,[],!1,null,null,null);"function"==typeof m&&m(h),h.options.__hasBlocks={script:!0,template:!0},h.options.__file="client/src/editor_weka/components/marks/Link.vue";t.default=h.exports},YOQe:function(e,t,n){var i={"./fixtures/WekaBasic":"8gR2","./fixtures/WekaBasic.vue":"8gR2","./fixtures/WekaWithLearn":"t+A+","./fixtures/WekaWithLearn.vue":"t+A+"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="YOQe"},Z8if:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("Y4vP"),m=n.n(p),h=n("oBkI"),v=n("BDOe");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var _=function(e){u()(n,e);var t=k(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{mention:{schema:{group:"inline",inline:!0,attrs:{type:{default:void 0},id:{default:void 0},display:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-mention",getAttrs:function(e){try{return{type:JSON.parse(e.getAttribute("data-type")),id:JSON.parse(e.getAttribute("data-id")),display:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:function(e){return["span",{class:"tui-editorWeka-mention","data-type":JSON.stringify(e.attrs.type),"data-id":JSON.stringify(e.attrs.id)},"@"+e.attrs.display]}},component:m.a}}}},{key:"plugins",value:function(){return[Object(v.default)(this.editor)]}}]),n}(h.default);t.default=function(e){return new _(e)}},"a2/6":function(e,t){e.exports=tui.require("tui/prosemirror/keymap")},bEBJ:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"tui-editorWeka-mention"},[t("Mention",{attrs:{"user-id":this.userId,fullname:this.displayName},nativeOn:{click:function(e){e.preventDefault()}}})],1)};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("rqBY"),s={components:{Mention:n.n(a).a},extends:o.a,computed:{displayName:function(){var e=this.attrs;return e.display?e.display:""},userId:function(){var e=this.attrs;return e.id?e.id:0}}},u=n("KHd+"),c=Object(u.a)(s,i,[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0},c.options.__file="client/src/editor_weka/components/nodes/Mention.vue";t.default=c.exports},bJQT:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNodeCollection")},"c+sf":function(e,t){e.exports=tui.require("tui/prosemirror/gapcursor")},ce8f:function(e,t){e.exports=tui.require("editor_weka/components/editing/ActionDropdown")},cmE2:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-weka no-yui-ids",attrs:{id:e.uid}},[e.showToolbar?n("Toolbar",{attrs:{items:e.toolbarItems}}):e._e(),e._v(" "),n("div",{ref:"editorHost",staticClass:"tui-rendered",attrs:{"data-placeholder":e.placeholder}}),e._v(" "),n("div",{ref:"extras"}),e._v(" "),n("div",{ref:"extrasLive",attrs:{"aria-live":"polite",role:"status"}})],1)};i._withStripped=!0;var r=n("o0o1"),o=n.n(r),a=n("yXPU"),s=n.n(a),u=n("H/tB"),c=n.n(u),l=n("TXEh"),d=n("T7/7"),f=n("z2s3"),p=n.n(f),m=n("V68o"),h={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_weka"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"editor"},name:{kind:"Name",value:"editor_weka_editor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"showtoolbar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"extensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tuicomponent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"instance_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"context_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"component"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"area"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_data"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"item_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"files"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}}]},v=n("MJ7y"),k=n("DgbO"),_=function(e){return function(t,n){JSON.stringify(n)!=JSON.stringify(t)&&console.warn('[Weka] Prop "'.concat(e,'" has changed from ').concat(JSON.stringify(n)," to ")+"".concat(JSON.stringify(t),". This change will not be reflected. ")+"Instead, create the Weka component instance (change key prop to force a new instance to be created)")}},g=function(e){return void 0!==e.showtoolbar&&void 0!==e.extensions},y={components:{Toolbar:p.a},props:{placeholder:{type:String,default:""},instanceId:[Number,String],component:String,area:String,doc:Object,options:{type:Object,validator:g},option:{type:Object,validator:g},value:k.default},data:function(){return{toolbarItems:[],toolbarEnabled:!1}},computed:{showToolbar:function(){return!!this.toolbarEnabled&&this.toolbarItems.length>0}},watch:{doc:function(e){e?this.displayedValue&&this.displayedValue.getDoc()===e||(this.displayedValue=k.default.fromDoc(e),this.editor&&this.editor.setValue(this.displayedValue)):this.value||(this.displayedValue=k.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},value:function(e){this.displayedValue!==e&&(this.displayedValue=e||k.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},component:_("component"),area:_("area"),instanceId:_("instanceId"),option:_("option")},created:function(){this.updateToolbarThrottled=Object(l.throttle)(this.updateToolbar,100),this.value?this.displayedValue=this.value:this.doc?this.displayedValue=k.default.fromDoc(this.doc):this.displayedValue=k.default.empty(),this.finalOptions=null},mounted:function(){this.createEditor()},beforeDestroy:function(){this.editor&&this.editor.destroy()},methods:{setupOptions:function(){var e=this;return s()(o.a.mark((function t(){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.option&&console.warn('[Weka] Prop "option" is deprecated. Please update your code to pass "options" instead.'),!(n=e.options||e.option)){t.next=6;break}return e.finalOptions=Object.assign({},n),e.toolbarEnabled=e.finalOptions.showtoolbar,t.abrupt("return");case 6:return t.next=8,e.$apollo.query({query:h,fetchPolicy:"no-cache",variables:{instance_id:e.instanceId,component:e.component,area:e.area}});case 8:i=t.sent,e.finalOptions=Object.assign({},i.data.editor),e.toolbarEnabled=e.finalOptions.showtoolbar;case 11:case"end":return t.stop()}}),t)})))()},getExtensions:function(){var e=this;return s()(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:if(n=[],!Array.isArray(e.finalOptions.extensions)){t.next=7;break}return t.next=6,Promise.all(e.finalOptions.extensions.map((function(e){var t=e.tuicomponent,n=e.options,i={};return null!=n&&(i=JSON.parse(n)),c.a.import(t).then((function(e){return e.default(i)}))})));case 6:n=t.sent;case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}}),t)})))()},getRepositoryData:function(){var e=this;return s()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:return t.abrupt("return",e.finalOptions.repository_data||null);case 3:case"end":return t.stop()}}),t)})))()},getCurrentFiles:function(){var e=this;return s()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:return t.abrupt("return",e.finalOptions.files||[]);case 3:case"end":return t.stop()}}),t)})))()},createEditor:function(){var e=this;return s()(o.a.mark((function t(){var n,i,r,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.editor){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.getExtensions();case 4:return n=t.sent,t.next=7,e.getRepositoryData();case 7:return i=t.sent,r=new v.default({component:e.component,area:e.area,instanceId:e.instanceId,contextId:e.finalOptions.context_id||null}),null!==i&&r.setRepositoryData(i),t.next=12,e.getCurrentFiles();case 12:return a=t.sent,Array.prototype.forEach.call(a,(function(e){var t=e.filename,n=e.url,i=e.file_size;r.addFile({file:t,url:n,size:i})})),e.editor=new d.default({value:e.displayedValue,placeholder:e.placeholder,parent:e,viewExtrasEl:e.$refs.extras,viewExtrasLiveEl:e.$refs.extrasLive,extensions:n,fileStorage:r,onUpdate:e.$_onUpdate.bind(e),onTransaction:function(){e.updateToolbarThrottled()}}),s=e.editor.allVueComponents(),t.next=18,Promise.all([c.a.loadRequirements({components:s}),Object(m.loadLangStrings)(e.editor.allStrings())]);case 18:e.view=e.editor.createView(e.$refs.editorHost),e.updateToolbar(),e.$emit("editor-mounted"),e.$emit("editor-ready");case 22:case"end":return t.stop()}}),t)})))()},updateToolbar:function(){this.toolbarItems=this.editor.getToolbarItems()},$_onUpdate:function(e){this.displayedValue=e,this.$emit("input",e),this.$listeners.update&&this.$emit("update",{getJSON:function(){return e.getDoc()},isEmpty:function(){return e.empty},getFileStorageItemId:function(){return e.fileStorageItemId}})}}},b=n("KHd+"),w=Object(b.a)(y,i,[],!1,null,null,null);w.options.__hasBlocks={script:!0,template:!0},w.options.__file="client/src/editor_weka/components/Weka.vue";t.default=w.exports},ddKQ:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFiles",(function(){return m})),n.d(t,"upload",(function(){return h})),n.d(t,"pickFiles",(function(){return k}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("12HA"),u=n("TGM/"),c=n.n(u),l=n("Wdod"),d=n.n(l),f=n("i7/w"),p=n.n(f);n("T7/7");function m(e){return Array.isArray(e)?e:Array.prototype.slice.call(e).filter((function(e){return e instanceof File}))}function h(e){return v.apply(this,arguments)}function v(){return(v=a()(r.a.mark((function e(t){var n,i,o,a,u,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.file,i=t.repositoryId,o=t.itemId,a=t.contextId,u=t.acceptTypes,c=t.url,void 0!==u&&(u=Array.prototype.slice.call(u)),e.abrupt("return",new Promise((function(e,t){var r=new FormData,l=new XMLHttpRequest;r.append("repo_upload_file",n),r.append("title",n.name),r.append("sesskey",s.globalConfig.sesskey),r.append("repo_id",String(i)),r.append("itemid",String(o)),r.append("ctx_id",String(a)),0!==u.length&&u.forEach((function(e){r.append("accepted_types[]",e)})),l.addEventListener("readystatechange",(function(){if(4===l.readyState){if(200===l.status){var n=JSON.parse(l.responseText);if(n)return n.error?void t({message:n.error}):void e(n)}t({message:"Response is not a 200 response"})}})),l.open("POST",c,!0),l.send(r)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return _.apply(this,arguments)}function _(){return(_=a()(r.a.mark((function e(t){var n,i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.a.extend(d.a),i=new n({parent:t.getParent(),propsData:{autoTrigger:!0}}),o=c()("weka-file-picker"),setTimeout((function(){o();var e=document.createElement("span");t.viewExtrasEl.appendChild(e),i.$mount(e)}),0),e.abrupt("return",new Promise((function(e){i.$on("picked-files",(function(t){e(t)})),i.$on("dismiss",(function(){i.$destroy(),t.viewExtrasEl.removeChild(i.$el)}))})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},dlhR:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("AttachmentNodeCollection",{staticClass:"tui-editorWeka-attachments"},[t("div",{ref:"content",staticClass:"tui-editorWeka-attachments__content"})])};i._withStripped=!0;var r=n("bJQT"),o={components:{AttachmentNodeCollection:n.n(r).a}},a=n("KHd+"),s=Object(a.a)(o,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/nodes/Attachments.vue";t.default=s.exports},e9dp:function(e,t,n){"use strict";n.r(t),n.d(t,"setupTexteditor",(function(){return f}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("H/tB"),u=n.n(s),c=n("TXEh"),l=n("2wx7"),d=n.n(l);function f(e){var t=e.id,n=e.extensions,i=e.showtoolbar,r=document.getElementById(t);new p(t,r,{extensions:n,showtoolbar:i})}var p=function(){function e(t,n,i){var o=this;r()(this,e),this.id=t,this.textareaEl=n,n.style.display="none",this.wrapper=document.createElement("div");var a=document.createElement("div");this.wrapper.appendChild(a),this.textareaEl.parentNode.insertBefore(this.wrapper,this.textareaEl.nextSibling);var s,l=this.getDoc(),f=Object(c.debounce)((function(){o.textareaEl.value=JSON.stringify(s.getJSON())}),250);u.a.mount(d.a,{props:{doc:l,option:i},on:{update:function(e){s=e,f()}}},a)}return a()(e,[{key:"getDoc",value:function(){var e={type:"doc",content:[{type:"paragraph"}]},t=this.textareaEl.value;if(t)try{e=JSON.parse(t)}catch(e){console.error("[editor_weka] Error parsing JSON"),console.error(e)}return e}}]),e}()},eoJc:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("PJYZ"),f=n.n(d),p=n("7W2i"),m=n.n(p),h=n("a1gu"),v=n.n(h),k=n("Nsbk"),_=n.n(k),g=n("oBkI"),y=n("iag4"),b=n("Nfo2"),w=n.n(b),x=n("9cw/"),N=n.n(x),S=n("9Wm2"),O=n.n(S),I=n("OxlY"),j=n.n(I),A=n("n31W"),T=n("wd6j"),D=n("V68o"),$=n("fvDX"),M=n("JMt+"),B=n("zLSG"),E=n("X7tx"),F=n("TXEh"),C=n("vyVp");function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=_()(e);if(t){var r=_()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return v()(this,n)}}var W=/\bhttps?:\/\/[-a-zA-Z0-9@:%._+~#=]+\b(?:[-a-zA-Z0-9@:%_+.~#?&//=]*)/g,V=["link_block","link_media"],P=function(e){m()(o,e);var t,n,i=R(o);function o(e){var t;return u()(this,o),(t=i.call(this,e)).isMedia=t.isMedia.bind(f()(t)),t._convertPastedUrl=t._convertPastedUrl.bind(f()(t)),t._getSelectionRange=t._getSelectionRange.bind(f()(t)),t}return l()(o,[{key:"nodes",value:function(){return{link_media:{schema:{group:"block",atom:!0,attrs:{url:{},loading:{default:void 0},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0},resolution:{default:void 0}},parseDOM:[{tag:".tui-editorWeka-linkMedia",getAttrs:y.getJsonAttrs}],toDOM:function(e){return["a",{class:"tui-editorWeka-linkMedia","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]}},component:N.a,componentContext:{urlPlugin:this.urlPlugin.bind(this),editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}},link_block:{schema:{group:"block",atom:!0,attrs:{url:{},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0}},parseDOM:[{tag:".tui-editorWeka-linkBlock",getAttrs:y.getJsonAttrs}],toDOM:function(e){return["a",{class:"tui-editorWeka-linkBlock","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]}},component:w.a,componentContext:{editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}}}}},{key:"marks",value:function(){return{link:{schema:{attrs:{href:{},title:{default:void 0}},inclusive:!1,parseDOM:[{tag:"a[href]:not([class*=tui-editorWeka])",getAttrs:Object(y.attrGetter)(["href","title"])}],toDOM:function(e){var t=e.attrs;return["a",{href:t.href,title:t.title},0]}},component:O.a,componentContext:{showMarkDropdown:this.showMarkDropdown.bind(this)}}}}},{key:"plugins",value:function(){var e=this;return[new A.Plugin({props:{transformPasted:function(t){return new T.Slice(function e(t,n){var i=[];return t.forEach((function(t){if(t.isText){var r,o=t.text,a=0;for(W.lastIndex=0;r=W.exec(o);){var s=r.index,u=s+r[0].length;s>0&&i.push(t.cut(a,s));var c=o.slice(s,u),l=n.convert(c);l instanceof T.Node?t.canReplace(s,u,T.Fragment.from(l))?i.push(l):i.push(t.cut(s,u)):l instanceof T.Mark?i.push(t.cut(s,u).mark(l.addToSet(t.marks))):i.push(t.cut(s,u)),a=u}a<o.length&&i.push(t.cut(a))}else i.push(t.copy(e(t.content,n)))})),T.Fragment.fromArray(i)}(t.content,{convert:e._convertPastedUrl}),t.openStart,t.openEnd)}}})]}},{key:"toolbarItems",value:function(){var e=this;return[new $.ToolbarItem({group:"embeds",label:Object(D.langString)("insert_link","editor_weka"),icon:"editor_weka|link",execute:function(t){var n,i=e._getSelectionRange(),o=e.doc.textBetween(i.from,i.to);e.showModal(j.a,{isNew:!0,isMedia:e.isMedia,attrs:{url:"",text:o},save:(n=a()(r.a.mark((function n(i){var o;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._prepareLinkUpdate(i);case 2:o=n.sent,e._updateLink({type:null,getRange:e._getSelectionRange},o),t.view.focus();case 5:case"end":return n.stop()}}),n)}))),function(e){return n.apply(this,arguments)})})}})]}},{key:"replaceWithTextLink",value:function(e,t){var n=t.url;this.editor.execute((function(t,i){var r=t.schema.text(n,[t.schema.mark("link",{href:n})]),o=e();i(t.tr.replaceWith(o.from,o.to,r))}))}},{key:"urlPlugin",value:function(e){return this._findLinkPlugin(e)}},{key:"isMedia",value:function(e){return!!this._findLinkPlugin({type:"media",url:e})}},{key:"editCard",value:function(e){var t,n=this,i=this.doc.nodeAt(e().from),o=i.type.name;V.includes(o)&&this.showModal(j.a,{isMedia:this.isMedia,attrs:{type:o,url:i.attrs.url},save:(t=a()(r.a.mark((function t(i){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._prepareLinkUpdate(i);case 2:a=t.sent,n._updateLink({type:o,getRange:e},a),n.editor.view.focus();case 5:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})})}},{key:"showMarkDropdown",value:function(e){var t=this,n=this._getLinkMark(e);if(n){var i=n&&this.isMedia(n.attrs.href);return this.showActionDropdown(e().from,{actions:[{label:Object(D.langString)("go_to_link","editor_weka"),action:function(){return t._openLinkMarkAt(e)}},{label:Object(D.langString)("edit","moodle"),action:function(){return t._editMarkAt(e)}},{label:i?Object(D.langString)("display_as_embedded_media","editor_weka"):Object(D.langString)("display_as_card","editor_weka"),action:function(){return t._markToCardAt(i?"link_media":"link_block",e)}},{label:Object(D.langString)("remove","moodle"),action:function(){return t._removeMarkAt(e)}}]})}}},{key:"_findLinkPlugin",value:function(e){for(var t=e.type,n=e.url,i=0;i<L.length;i++){var r=L[i];if(!t||r.type===t)for(var o=0;o<r.matches.length;o++){var a=r.matches[o],s=a.match.exec(n);if(s)return{plugin:r,details:a.details?a.details(s):{}}}}return null}},{key:"_updateLink",value:function(e,t){var n=this;e||(e={type:null,getRange:this._getSelectionRange});var i=null;if("link"===e.type||null===e.type){var r=e.getRange();i=this.doc.textBetween(r.from,r.to)}this.editor.execute((function(r,o){var a=Object(E.expandContentResolvedRange)(E.ResolvedRange.resolve(n.doc,e.getRange()));if("link"==t.type){var s=r.schema.marks.link,u=t.text||t.url,c=s.create({href:t.url});o("link"==e.type&&i&&u===i?r.tr.removeMark(a.$from.pos,a.$to.pos,s).addMark(a.$from.pos,a.$to.pos,c):r.tr.replaceWith(a.$from.pos,a.$to.pos,u?r.schema.text(u,[c]):T.Fragment.empty))}else V.includes(t.type)&&o(r.tr.replaceWith(a.$from.pos,a.$to.pos,t.content))}))}},{key:"_prepareLinkUpdate",value:(n=a()(r.a.mark((function e(t){var n,i,o,a,s,u,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.type,i=t.url,o=t.text,!V.includes(n)){e.next=33;break}if(a=this.editor.state.schema,!(s=(!n||"link_media"==n)&&this._findLinkPlugin({type:"media",url:i}))){e.next=19;break}if(!s.plugin.nodeAttrs){e.next=16;break}return e.prev=6,e.next=9,s.plugin.nodeAttrs({url:i});case 9:u=e.sent,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),u={},console.error(e.t0);case 16:return e.abrupt("return",new q({type:n,url:i,content:a.node("link_media",Object.assign({url:i},u))}));case 19:return e.prev=19,e.next=22,Object(M.getLinkMetadata)(i);case 22:l=e.sent,c=U(l),e.next=30;break;case 26:e.prev=26,e.t1=e.catch(19),console.error(e.t1),c={};case 30:return e.abrupt("return",new q({type:n,url:i,content:a.node("link_block",Object.assign({url:i},c))}));case 31:e.next=34;break;case 33:return e.abrupt("return",new q({type:"link",url:i,text:o}));case 34:case"end":return e.stop()}}),e,this,[[6,12],[19,26]])}))),function(e){return n.apply(this,arguments)})},{key:"_convertPastedUrl",value:function(e){var t=this,n=this.getSchema().marks.link,i=this.getSchema().nodes.link_media,r=this._findLinkPlugin({type:"media",url:e});if(r){var o={url:e};r.plugin.nodeAttrs&&(o.loading=!0);var a=i.create(o);return o.loading&&r.plugin.nodeAttrs({url:e}).then((function(n){t._updatePastedMedia(e,n)})).catch((function(n){console.error(n),t._updatePastedMedia(e,{})})),a}return n.create({href:e})}},{key:"_updatePastedMedia",value:function(e,t){var n=this.getSchema().nodes.link_media,i=this.editor.state.tr;this.editor.state.doc.descendants((function(r,o){if(r.type==n&&r.attrs.loading&&r.attrs.url===e){var a=Object.assign({},r.attrs,{loading:!1},t);i=Object(B.setAttrs)(o,a)(i)}})),i.setMeta("addToHistory",!1),this.editor.dispatch(i)}},{key:"_getSelectionRange",value:function(){return Object(F.pick)(this.editor.state.selection,["from","to"])}},{key:"_getLinkMark",value:function(e){return Object(E.getMark)(this.doc.resolve(e().from),this.getSchema().marks.link)}},{key:"_openLinkMarkAt",value:function(e){var t=this._getLinkMark(e);t&&window.open(t.attrs.href)}},{key:"_editMarkAt",value:function(e){var t=this,n=e(),i=this._getLinkMark(e);if(i){var o,s=i.attrs.href,u=this.doc.textBetween(n.from,n.to);s===u&&(u=null),this.showModal(j.a,{isMedia:this.isMedia,attrs:{url:s,text:u},save:(o=a()(r.a.mark((function n(i){var o;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._prepareLinkUpdate(i);case 2:o=n.sent,t._updateLink({type:"link",getRange:e},o),t.editor.view.focus();case 5:case"end":return n.stop()}}),n)}))),function(e){return o.apply(this,arguments)})})}}},{key:"_markToCardAt",value:(t=a()(r.a.mark((function e(t,n){var i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._getLinkMark(n)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._prepareLinkUpdate({type:t,url:i.attrs.href});case 6:o=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),K(e.t0),e.abrupt("return");case 13:this._updateLink({type:"link",getRange:n},o),this.editor.view.focus();case 15:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,n){return t.apply(this,arguments)})},{key:"_removeMarkAt",value:function(e){var t=this;this.editor.execute((function(n,i){var r=Object(E.expandContentResolvedRange)(E.ResolvedRange.resolve(t.doc,e()));i(n.tr.delete(r.$from.pos,r.$to.pos))})),this.editor.view.focus()}}]),o}(g.default),q=function e(t){u()(this,e),Object.assign(this,t)},L=[{key:"youtube",type:"media",name:"YouTube",matches:[{match:/^https?:\/\/(?:www\.)?youtube.com\/watch\?v=([a-zA-Z0-9_-]+)/,details:function(e){return{id:e[1]}}},{match:/^https?:\/\/(?:www\.)?youtu.be\/([a-zA-Z0-9_-]+)/,details:function(e){return{id:e[1]}}}],nodeAttrs:function(e){var t=e.url;return a()(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.getLinkMetadata)(t);case 2:return n=e.sent,e.abrupt("return",z(n));case 4:case"end":return e.stop()}}),e)})))()}},{key:"vimeo",type:"media",name:"Vimeo",matches:[{match:/^https?:\/\/(?:www\.)?vimeo.com\/([0-9]+)/,details:function(e){return{id:e[1]}}}],nodeAttrs:function(e){var t=e.url;return a()(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(M.getLinkMetadata)(t);case 2:return n=e.sent,e.abrupt("return",z(n));case 4:case"end":return e.stop()}}),e)})))()}},{key:"image",type:"media",name:"Image",matches:[{match:/\.(png|jpe?g|gif|webp|avif)$/}]},{key:"audio",type:"media",name:"Audio",matches:[{match:/\.(aac|flac|m4a|mp3|ogg|opus|wav|wma)$/}]}];var J=function(e){var t={};for(var n in e)null!=e[n]&&(t[n]=e[n]);return t};function z(e){if(null===e)return null;var t=J(Object(F.pick)(e,["url","image","title","description"])),n=Number(e.videowidth),i=Number(e.videoheight);return t.resolution=isNaN(n)||isNaN(i)?void 0:{width:n,height:i},t}function U(e){return null===e?null:J(Object(F.pick)(e,["url","image","title","description"]))}function K(){return X.apply(this,arguments)}function X(){return(X=a()(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(D.langString)("error_no_url_info","editor_weka"),e.next=3,Object(D.loadLangStrings)([t]);case 3:Object(C.notify)({type:"error",message:t.toString()});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default=function(e){return new P(e)}},euDZ:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement;return(this._self._c||e)("Hashtag",{attrs:{url:this.url,text:this.$str("hashtag","editor_weka",this.text)},nativeOn:{click:function(e){e.preventDefault()}}})};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("mD75"),s={components:{Hashtag:n.n(a).a},extends:o.a,computed:{text:function(){return this.attrs.text},url:function(){return this.$url("/totara/catalog/index.php",{catalog_fts:this.attrs.text})}}},u=n("KHd+"),c=function(e){e.options.__langStrings={editor_weka:["hashtag"]}},l=Object(u.a)(s,i,[],!1,null,null,null);"function"==typeof c&&c(l),l.options.__hasBlocks={script:!0,template:!0},l.options.__file="client/src/editor_weka/components/nodes/Hashtag.vue";t.default=l.exports},f56J:function(e,t,n){"use strict";n.r(t),n.d(t,"pluginKey",(function(){return o})),n.d(t,"attachment",(function(){return a}));var i=n("n31W"),r=Object.prototype.hasOwnProperty,o=new i.PluginKey("attachment");function a(e){var t=function(e){var t={};return["onDrop","onKeyDown"].forEach((function(n){r.call(e,n)&&"function"==typeof e[n]?t[n]=e[n]:t[n]=function(){return!1}})),t}(e),n=t.onDrop,a=t.onKeyDown;return new i.Plugin({key:o,state:{init:function(){return{}},apply:function(){return{}}},props:{handleDOMEvents:{drop:function(e,t){return n({view:e,event:t})}},handleKeyDown:function(e,t){return a({view:e,event:t})}}})}},fReT:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement;return(this._self._c||e)("Emoji",{staticClass:"tui-editorWeka-emoji",attrs:{"short-code":this.shortCode}})};i._withStripped=!0;var r=n("QCX9"),o=n.n(r),a=n("tnXT"),s=n.n(a),u={components:{Emoji:o.a},extends:s.a,computed:{shortCode:function(){if(this.attrs.shortcode)return this.attrs.shortcode}}},c=n("KHd+"),l=Object(c.a)(u,i,[],!1,null,null,null);l.options.__hasBlocks={script:!0,template:!0},l.options.__file="client/src/editor_weka/components/nodes/Emoji.vue";t.default=l.exports},fRht:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Emoji")},fvDX:function(e,t,n){"use strict";n.r(t),n.d(t,"ToolbarItem",(function(){return u})),n.d(t,"cmdItem",(function(){return c})),n.d(t,"markItem",(function(){return l})),n.d(t,"blockTypeItem",(function(){return d}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("FtgP"),u=function(){function e(t){var n=this;r()(this,e),this._opts=t,this._editor=null,this._def={group:t.group,label:t.label,icon:t.icon,enabled:!0,active:null,children:t.children&&t.children.map((function(e){return e.getDef()})),popover:t.popover,execute:function(){return t.execute(n._editor)},reset:function(){return t.reset(n._editor)}}}return a()(e,[{key:"update",value:function(e){var t=this._def,n=this._opts;return this._editor=e,t.enabled=void 0===n.enabled||n.enabled(e),t.active=null!=n.active?n.active(e):null,n.children&&n.children.forEach((function(t){return t.update(e)})),Object.assign({},t)}},{key:"getDef",value:function(){return this._def}}]),e}();function c(e,t){return new u(Object.assign({enabled:function(t){return t.canExecute(e)},execute:function(t){t.view.focus(),t.execute(e)}},t))}function l(e,t){return t=Object.assign({active:function(t){return n=t.state,i=e,r=n.selection,o=r.from,a=r.$from,s=r.to,r.empty?!!i.isInSet(n.storedMarks||a.marks()):!!n.doc.rangeHasMark(o,s,i);var n,i,r,o,a,s}},t),c(Object(s.toggleMark)(e),t)}function d(e,t,n){return n=Object.assign({active:function(n){var i=n.state.selection,r=i.$from,o=i.to,a=i.node;return a&&a.isTextblock?a.hasMarkup(e,t.attrs):o<=r.end()&&r.parent.hasMarkup(e,t.attrs)}},n),c(Object(s.setBlockType)(e,t.attrs),n)}},gEm7:function(e,t,n){"use strict";n.r(t),n.d(t,"IMAGE",(function(){return i})),n.d(t,"VIDEO",(function(){return r})),n.d(t,"AUDIO",(function(){return o}));var i="IMAGE",r="VIDEO",o="AUDIO"},gLvT:function(e,t){e.exports=tui.require("tui/components/dropdown/Dropdown")},hCGN:function(e,t){e.exports=tui.require("tui/components/icons/common/More")},hKQV:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-toolbar",attrs:{role:"toolbar","aria-label":e.$str("label_toolbar","weka_editor")}},[n("div",{staticClass:"tui-editorWeka-toolbar__group"},[n("Dropdown",{attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("ButtonIcon",{staticClass:"tui-editorWeka-toolbar__currentBlock tui-editorWeka-toolbar__button",attrs:{styleclass:{toolbar:!0,textFirst:!0},text:e.activeBlockName,"aria-expanded":r?"true":"false","aria-label":e.$str("format_as_blocktype_status","editor_weka",e.activeBlockName),disabled:!e.blockSelectorEnabled},on:{click:function(e){return i()}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("FlexIcon",{attrs:{icon:"caret-down",size:"100"}})],1)]}}])},[e._v(" "),e._l(e.blockItems,(function(t,i){return n("DropdownItem",{key:i,attrs:{selected:t.active,disabled:!t.active&&!t.enabled,small:!0},on:{click:function(n){return e.itemClick(t)}}},[e._v("\n        "+e._s(t.label.toString())+"\n      ")])}))],2)],1),e._v(" "),e._l(e.itemGroups,(function(t,i){return n("div",{key:i,staticClass:"tui-editorWeka-toolbar__group"},[e._l(t,(function(t,i){return[t.children?n("Dropdown",{key:i,attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(i){var r=i.toggle;return[n("ToolbarButton",{staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),active:t.active,disabled:!t.enabled},on:{click:r},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}}],null,!0)},[e._v(" "),e._l(t.children,(function(t,i){return n("DropdownItem",{key:i,attrs:{disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[n("FlexIcon",{attrs:{icon:t.icon}}),e._v("\n          "+e._s(t.label.toString())+"\n        ")],1)}))],2):t.popover?n("Popover",{key:i,attrs:{triggers:["click"],title:t.popover.title},on:{"open-changed":function(n){for(var i=arguments.length,r=Array(i);i--;)r[i]=arguments[i];return e.openChanged.apply(void 0,[t].concat(r))}},scopedSlots:e._u([{key:"trigger",fn:function(i){var r=i.isOpen;return[n("ToolbarButton",{staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled,"aria-haspopup":"true","aria-expanded":r?"true":"false"},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}},{key:"default",fn:function(e){var i=e.close;return[n(t.popover.component,{tag:"component",on:{close:i}})]}}],null,!0)}):n("ToolbarButton",{key:i,staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}))],2)}))],2)};i._withStripped=!0;var r=n("TXEh"),o=n("36rR"),a=n("gLvT"),s=n.n(a),u=n("KGcv"),c=n.n(u),l=n("lBzj"),d=n.n(l),f=n("5h9J"),p=n.n(f),m=n("9Ovj"),h=n.n(m),v=n("9G+f"),k=n.n(v),_={components:{Dropdown:s.a,DropdownItem:c.a,FlexIcon:d.a,ButtonIcon:p.a,ToolbarButton:h.a,Popover:k.a},props:{items:{type:Array}},computed:{activeBlockName:function(){var e=this.blockItems.find((function(e){return e.active}));return e?e.label.toString():"Block"},blockSelectorEnabled:function(){return this.blockItems.some((function(e){return e.enabled}))},blockItems:function(){return this.items.filter((function(e){return"blocks"==e.group}))},itemGroups:function(){return Object(r.groupBy)(this.items.filter((function(e){return"blocks"!=e.group})),(function(e){return e.group}))}},methods:{itemClick:function(e){e.enabled&&e.execute&&e.execute()},openChanged:function(e,t){!t&&e.enabled&&e.reset&&e.reset()},handleButtonKeydown:function(e){var t=e.currentTarget;switch(e.key){case"ArrowLeft":case"Left":this.$_moveFocus(t,"prev");break;case"ArrowRight":case"Right":this.$_moveFocus(t,"next");break;case"Home":this.$_moveFocus(t,"first");break;case"End":this.$_moveFocus(t,"last");break;default:return}e.stopPropagation(),e.preventDefault()},handleButtonFocus:function(e){var t=e.currentTarget;this.$_getAllButtons().forEach((function(e){e.tabIndex=e==t?0:-1}))},$_getAllButtons:function(){return Array.prototype.slice.call(this.$el.querySelectorAll(".tui-editorWeka-toolbar__button"))},$_moveFocus:function(e,t){var n=Object(o.getTabbableElements)(this.$el),i=this.$_getAllButtons().filter((function(e){return n.includes(e)})),r=i.length-1,a=0;"prev"==t||"next"==t?-1==(a=i.indexOf(e))?a="next"==t?r:0:(a+="next"==t?1:-1)>r?a=0:a<0&&(a=r):"first"==t?a=0:"last"==t&&(a=r),i[a]&&i[a].focus()}}},g=n("KHd+"),y=function(e){e.options.__langStrings={editor_weka:["format_as_blocktype_status","label_toolbar"]}},b=Object(g.a)(_,i,[],!1,null,null,null);"function"==typeof y&&y(b),b.options.__hasBlocks={script:!0,template:!0},b.options.__file="client/src/editor_weka/components/toolbar/Toolbar.vue";t.default=b.exports},hg2Q:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}},"i/kK":function(e,t){e.exports=tui.require("tui/components/form/FormRow")},"i7/w":function(e,t){e.exports=tui.require("vue")},iPZg:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/ImageBlock")},iag4:function(e,t,n){"use strict";function i(e){try{return JSON.parse(e.getAttribute("data-attrs"))}catch(e){return{}}}function r(e){return function(t){var n={};return e.forEach((function(e){var i=t.getAttribute(e);n[e]=null==i?void 0:i})),n}}n.r(t),n.d(t,"getJsonAttrs",(function(){return i})),n.d(t,"attrGetter",(function(){return r}))},jHsM:function(e,t){e.exports=tui.require("editor_weka/components/attachments/AudioAttachment")},kgTP:function(e,t){e.exports=tui.require("editor_weka/helpers/editor")},lBzj:function(e,t){e.exports=tui.require("tui/components/icons/FlexIcon")},lELM:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var i=n("J4zp"),r=n.n(i),o=n("lwsE"),a=n.n(o),s=n("W8MJ"),u=n.n(s),c=n("i7/w"),l=n.n(c),d=n("X7tx"),f=function(){function e(t,n){var i=n.editor,r=n.node,o=n.view,s=n.getPos,u=n.parent,c=n.context;a()(this,e),this.component=t,this.editor=i,this.node=r,this.view=o,this.parent=u,this.context=c,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isNode?s:null,this.createVue(),this.dom=this.vm.$el,this.contentDOM=this.vm.$refs.content}return u()(e,[{key:"createVue",value:function(){var e=this,t=l.a.extend(this.component),n={nodeInfo:this.getNodeInfo(),contextInfo:this.getContextInfo(),updateAttrs:function(t){return e.updateAttrs(t)},replaceWith:function(t){return e.replaceWith(t)},getPos:this.getPos,getRange:this.getRange.bind(this)};this.vm=new t({parent:this.parent,propsData:n}).$mount(),this.vm.$on("remove",this.remove.bind(this))}},{key:"getNodeInfo",value:function(){var e={node:this.node,editor:this.editor};return Object.preventExtensions(e),e}},{key:"getContextInfo",value:function(){var e={context:this.context};return Object.preventExtensions(e),e}},{key:"update",value:function(e,t){return e.type===this.node.type&&(e===this.node&&this.decorations===t||(this.node=e,this.updateComponentProps({nodeInfo:this.getNodeInfo()})),!0)}},{key:"updateComponentProps",value:function(e){var t=this;if(this.vm._props){var n=l.a.config.silent;l.a.config.silent=!0,Object.entries(e).forEach((function(e){var n=r()(e,2),i=n[0],o=n[1];t.vm._props[i]=o})),l.a.config.silent=n}}},{key:"updateAttrs",value:function(e){if(this.view.editable){var t=this.view.state,n=this.node.type,i=this.getPos(),r=Object.assign({},this.node.attrs,e),o=this.isMark?t.tr.removeMark(i.from,i.to,n).addMark(i.from,i.to,n.create(r)):t.tr.setNodeMarkup(i,null,r);this.view.dispatch(o)}}},{key:"replaceWith",value:function(e){var t=e(this.view.state.schema);if(void 0!==t){var n=this.getRange(),i=this.view.state.tr.replaceWith(n.from,n.to,t);this.view.dispatch(i)}}},{key:"remove",value:function(){var e=this.view.state.tr,t=this.getRange(),n=e.delete(t.from,t.to);this.view.dispatch(n)}},{key:"getSize",value:function(){return this.node.nodeSize}},{key:"getRange",value:function(){if(this.isNode){var e=this.getPos();return{from:e,to:e+this.getSize()}}if(this.isMark){var t=this.view.posAtDOM(this.dom),n=this.view.state.doc.resolve(t);return Object(d.default)(n,this.node.type)}}},{key:"destroy",value:function(){this.vm.$destroy()}}]),e}()},ln5p:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-videoBlock"},[e.$apollo.loading?[n("p",[e._v("\n      "+e._s(e.$str("loadinghelp","moodle"))+"\n    ")])]:[n("div",{staticClass:"tui-editorWeka-videoBlock__inner"},[n("CoreVideoBlock",{attrs:{"mime-type":e.file.mime_type,url:e.file.url,filename:e.filename}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("AL+t"),s=n.n(a),u=n("hg2Q"),c=n("r4xq"),l=n.n(c),d={components:{CoreVideoBlock:s.a,NodeBar:l.a},extends:o.a,apollo:{file:{query:u.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.$str("remove","moodle"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","moodle"),action:function(){window.document.location.href=e.downloadUrl}}),t},itemId:function(){if(!this.context.getItemId)throw new Error("No function 'getItemId' was found from extension");return this.context.getItemId()},filename:function(){return this.attrs.filename?this.attrs.filename:null},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}},$_removeNode:function(){this.context.removeNode&&this.context.removeNode(this.getRange)}}},f=n("KHd+"),p=function(e){e.options.__langStrings={moodle:["loadinghelp","remove"],editor_weka:["display_as_attachment","actions_menu_for"]}},m=Object(f.a)(d,i,[],!1,null,null,null);"function"==typeof p&&p(m),m.options.__hasBlocks={script:!0,template:!0},m.options.__file="client/src/editor_weka/components/nodes/VideoBlock.vue";t.default=m.exports},mD75:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Hashtag")},n31W:function(e,t){e.exports=tui.require("tui/prosemirror/state")},nEm4:function(e,t){e.exports=tui.require("tui/components/form/Form")},nFyd:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Hashtag")},nXMa:function(e,t){e.exports=tui.require("tui/components/buttons/Cancel")},"o7S+":function(e,t){e.exports=tui.require("tui/prosemirror/dropcursor")},oBVP:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("7W2i"),f=n.n(d),p=n("a1gu"),m=n.n(p),h=n("Nsbk"),v=n.n(h),k=n("oBkI"),_=n("ziKp"),g=n.n(_),y=n("6RS6"),b=n.n(y),w=n("fvDX"),x=n("V68o"),N=n("f56J"),S=n("iag4"),O=n("n31W"),I=n("ddKQ"),j=n("vyVp");function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var T=function(e){f()(i,e);var t,n=A(i);function i(e){var t;return u()(this,i),t=n.call(this,e),void 0===e&&(e={}),t.acceptTypes=e.accepttypes||[],t}return l()(i,[{key:"nodes",value:function(){return{attachment:{schema:{inline:!0,atom:!0,attrs:{filename:{default:void 0},size:{default:void 0},option:{default:void 0},url:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-attachment",getAttrs:S.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-editorWeka-attachment","data-attrs":JSON.stringify({filename:e.attrs.filename,option:e.attrs.option,url:e.attrs.url})}]}},component:g.a,componentContext:{convertToImage:this._convertToImage.bind(this),convertToVideo:this._convertToVideo.bind(this),convertToAudio:this._convertToAudio.bind(this),updateNode:this._updateNode.bind(this),hasImageNode:this._hasImageNode.bind(this),hasVideoNode:this._hasVideoNode.bind(this),removeNode:this.removeNode.bind(this),hasAudioNode:this._hasAudioNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},attachments:{schema:{group:"block",allowGapCursor:!0,content:"attachment*",parseDOM:[{tag:"div.tui-editorWeka-attachments"}],toDOM:function(){return["div",{class:"tui-editorWeka-attachments"},0]}},component:b.a}}}},{key:"toolbarItems",value:function(){var e=this;return[new w.ToolbarItem({group:"upload",label:Object(x.langString)("attachment","editor_weka"),icon:"editor_weka|attachment",execute:function(t){Object(I.pickFiles)(t).then((function(t){e.startUploadingFiles(t)}))}})]}},{key:"plugins",value:function(){return[Object(N.attachment)({onDrop:this._onDropEvent.bind(this),onKeyDown:this._onKeyDownEvent.bind(this)})]}},{key:"_findAttachmentCollectionBlock",value:function(e){var t=e.selection.$from,n=t.parent;if(!n||"attachments"!==n.type.name)return null;var i=t.pos;return e.selection.empty||(i+=1),{from:t.before(),to:t.after(),insertPoint:i,node:n}}},{key:"startUploadingFiles",value:(t=a()(r.a.mark((function e(t){var n,i,o,a,s,u,c,l,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.editor.fileStorage.uploadFiles(t,this.acceptTypes);case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:i=this.editor.state.schema,o=this.editor.view,a=o.state.tr,s=this._findAttachmentCollectionBlock(a),u=n.map((function(e){var t=e.file,n=e.url,r=e.size;return i.node("attachment",{filename:t,url:n,size:r,option:{}})})),s?(a.insert(s.insertPoint,u),o.dispatch(a)):(c=i.node("attachments",null,u),l=a.selection.$from.pos,o.dispatch(a.replaceWith(l,l,c))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0),d=Object(x.langString)("error_upload_failed","editor_weka"),Object(x.loadLangStrings)([d]).then((function(){return Object(j.notify)({type:"error",message:d.toString()})}));case 17:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return t.apply(this,arguments)})},{key:"_onKeyDownEvent",value:function(e){var t=e.view,n=e.event,i=t.state.tr,r=this._findAttachmentCollectionBlock(i);if(!r)return!1;if("Enter"===n.key){var o=t.state.schema.nodes.paragraph.createAndFill();return i.insert(r.to,o),i.setSelection(new O.TextSelection(i.doc.resolve(r.to+1))),t.dispatch(i),!0}if("Backspace"===n.key){if(!i.selection.$from.nodeBefore)return!1;if(1===r.node.content.size)return i.delete(r.from,r.to),t.dispatch(i),!0}return!0}},{key:"_onDropEvent",value:function(e){var t=e.event;return!!(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length)&&(t.preventDefault(),this.startUploadingFiles(t.dataTransfer.files),!0)}},{key:"_convertToImage",value:function(e,t){var n=this,i=t.filename,r=t.alttext;this.editor.execute((function(t,o){var a=t.schema.node("image",{filename:i,url:n._getFileUrl(i),alttext:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_convertToVideo",value:function(e,t){var n=this,i=t.filename,r=t.mimeType;this.editor.execute((function(t,o){var a=t.schema.node("video",{filename:i,url:n._getFileUrl(i),mime_type:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_updateNode",value:function(e,t){var n=this,i=t.filename,r=t.option,o=t.size;this.editor.execute((function(t,a){var s=t.tr,u=e();a(s.replaceWith(u.from,u.to,t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),option:r,size:o}))),n.editor.view.focus()}))}},{key:"_hasImageNode",value:function(){return this.editor.hasNode("image")}},{key:"_hasVideoNode",value:function(){return this.editor.hasNode("video")}},{key:"_hasAudioNode",value:function(){return this.editor.hasNode("audio")}},{key:"removeNode",value:function(e){var t=this;this.editor.execute((function(n,i){var r=n.tr,o=t._findAttachmentCollectionBlock(r);if(1===o.node.content.size)r.delete(o.from,o.to);else{var a=e();r.delete(a.from,a.to)}i(r)}))}},{key:"_convertToAudio",value:function(e,t){var n=this,i=t.filename,r=t.mimeType;this.editor.execute((function(t,o){var a=t.schema.node("audio",{filename:i,url:n._getFileUrl(i),mime_type:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_doConvertToMedia",value:function(e,t,n,i){var r=this._findAttachmentCollectionBlock(t);if(r){if(t.insert(r.to,e),1===r.node.content.size)t.delete(r.from,r.to);else{var o=i();t.delete(o.from,o.to)}n(t)}}},{key:"_getFileUrl",value:function(e){var t=this.editor.fileStorage.getFile(e);return null===t?null:t.url}},{key:"_getItemId",value:function(){var e=this.editor.fileStorage.getRepositoryData();return e?e.itemId:null}}]),i}(k.default);t.default=function(e){return new T(e)}},oBkI:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("i7/w"),f=n.n(d),p=n("H/tB"),m=n.n(p),h=n("Mnur"),v=n.n(h),k=n("OWva"),_=n.n(k),g=(n("wd6j"),n("T7/7"),n("V68o")),y=n("TGM/"),b=n.n(y),w=function(e){var t=b()("sleep");return new Promise((function(n){return setTimeout((function(){t(),n()}),e)}))},x=function(){function e(t){u()(this,e),this.editor=null,this.options=Object.assign({},t)}var t,n;return l()(e,[{key:"setEditor",value:function(e){this.editor=e}},{key:"nodes",value:function(){return[]}},{key:"marks",value:function(){return[]}},{key:"plugins",value:function(){return[]}},{key:"toolbarItems",value:function(){return[]}},{key:"keymap",value:function(e){}},{key:"inputRules",value:function(){return[]}},{key:"getSchema",value:function(){return this.editor.schema}},{key:"showModal",value:(n=a()(r.a.mark((function e(t,n){var i,o,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=document.createElement("span"),this.editor.viewExtrasEl.appendChild(i),o={component:t,props:n},Object.preventExtensions(o),e.next=6,m.a.loadRequirements(t);case 6:return(a=new N({parent:this.editor.getParent(),propsData:{container:o}})).$mount(i),e.abrupt("return",new Promise((function(e){a.$on("close-complete",(function(t){a.$destroy(),e(t)})),a.show()})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"showComponent",value:function(e,t){var n=document.createElement("span"),i=f.a.extend(e);this.editor.viewExtrasEl.appendChild(n);var r=new i(Object.assign({parent:this.editor.getParent()},t));return r.$mount(n),r}},{key:"showActionDropdown",value:(t=a()(r.a.mark((function e(t,n){var i,o,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.actions,o=this.editor.view.coordsAtPos(t),a=this.editor.viewExtrasEl.offsetParent.getBoundingClientRect(),e.next=5,w(0);case 5:return e.next=7,Object(g.loadLangStrings)(i.map((function(e){return e.label})));case 7:return(s=this.showComponent(_.a,{propsData:{location:{x:o.left-a.left,y:o.bottom-a.top},actions:i}})).$on("dismiss",(function(){s.$destroy(),s.$el.remove()})),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"removeNode",value:function(e){this.editor.execute((function(t,n){var i=t.tr,r=e();i.delete(r.from,r.to),n(i)}))}},{key:"doc",get:function(){return this.editor.state.doc}}]),e}(),N=f.a.extend({props:{container:{type:Object}},data:function(){return{result:null,open:!1}},methods:{show:function(){this.open=!0},requestClose:function(e){this.result=e,this.open=!1},closeComplete:function(){this.$emit("close-complete",this.result)}},render:function(e){return e(v.a,{props:{open:this.open},on:{"request-close":this.requestClose,"close-complete":this.closeComplete}},[e(this.container.component,{props:this.container.props})])}})},oMuj:function(e,t){e.exports=tui.require("tui/components/form/InputText")},p2bi:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-attachment"},[e.$apollo.loading?e._e():[e.isImage?n("ImageAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"alt-text":e.option.alttext||null,"enable-convert":e.hasImageNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toImage,"update-alt-text":e.updateAltText,delete:e.removeNode,download:e.download}}):e.isVideo?n("VideoAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasVideoNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toVideo,delete:e.removeNode,download:e.download}}):e.isAudio?n("AudioAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasAudioNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toAudio,delete:e.removeNode,download:e.download}}):n("FileAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,filename:e.filename,"draft-id":e.itemId,"has-download-url":!!e.downloadUrl},on:{delete:e.removeNode,download:e.download}})]],2)};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("hg2Q"),s=n("gEm7"),u=n("D3bS"),c=n.n(u),l=n("+xcZ"),d=n.n(l),f=n("GqWi"),p=n.n(f),m=n("jHsM"),h=n.n(m),v={components:{ImageAttachment:c.a,FileAttachment:d.a,VideoAttachment:p.a,AudioAttachment:h.a},extends:o.a,apollo:{file:{query:a.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{isImage:function(){return this.file&&this.file.media_type===s.IMAGE},isVideo:function(){return this.file&&this.file.media_type===s.VIDEO},isAudio:function(){return this.file&&this.file.media_type===s.AUDIO},itemId:function(){if(!this.context.getItemId)throw new Error("There is no function 'getItemId'");return this.context.getItemId()},filename:function(){var e=this.attrs;return e.filename?e.filename:this.$str("unknown_attachment","editor_weka")},option:function(){return this.attrs.option?this.attrs.option:{}},hasImageNode:function(){return!!this.context.hasImageNode&&this.context.hasImageNode()},hasVideoNode:function(){return!!this.context.hasVideoNode&&this.context.hasVideoNode()},hasAudioNode:function(){return!!this.context.hasAudioNode&&this.context.hasAudioNode()},downloadUrl:function(){if(!this.context.getFileUrl)return null;var e=this.context.getFileUrl(this.filename);return e?this.$url(e):null}},methods:{toImage:function(){if(this.context.convertToImage){var e={filename:this.filename,alttext:this.option.alttext||null};this.context.convertToImage(this.getRange,e)}},updateAltText:function(e){this.$_updateNode({filename:this.filename,size:this.file?this.file.file_size:this.attrs.size,option:{alttext:e}})},$_updateNode:function(e){this.context.updateNode&&this.context.updateNode(this.getRange,e)},toVideo:function(){if(this.context.convertToVideo){var e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToVideo(this.getRange,e)}},toAudio:function(){if(this.context.convertToAudio){var e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToAudio(this.getRange,e)}},removeNode:function(){this.context.removeNode&&this.context.removeNode(this.getRange)},download:function(){var e=this.downloadUrl;e&&(window.document.location.href=e)}}},k=n("KHd+"),_=function(e){e.options.__langStrings={editor_weka:["unknown_attachment"]}},g=Object(k.a)(v,i,[],!1,null,null,null);"function"==typeof _&&_(g),g.options.__hasBlocks={script:!0,template:!0},g.options.__file="client/src/editor_weka/components/nodes/Attachment.vue";t.default=g.exports},qSeW:function(e,t,n){"use strict";n.r(t),n.d(t,"wrapInList",(function(){return o})),n.d(t,"splitListItem",(function(){return a})),n.d(t,"liftListItem",(function(){return s})),n.d(t,"sinkListItem",(function(){return u}));var i=n("sl/l"),r=n("wd6j");function o(e,t){return function(n,o){var a=n.selection,s=a.$from,u=a.$to,c=s.blockRange(u),l=!1,d=c;if(!c)return!1;if(c.depth>=2&&s.node(c.depth-1).type.compatibleContent(e)&&0==c.startIndex){if(0==s.index(c.depth-1))return!1;var f=n.doc.resolve(c.start-2);d=new r.NodeRange(f,f,c.depth),c.endIndex<c.parent.childCount&&(c=new r.NodeRange(s,n.doc.resolve(u.end(c.depth)),c.depth)),l=!0}var p=Object(i.findWrapping)(d,e,t,c);return!!p&&(o&&o(function(e,t,n,o,a){for(var s=r.Fragment.empty,u=n.length-1;u>=0;u--)s=r.Fragment.from(n[u].type.create(n[u].attrs,s));e.step(new i.ReplaceAroundStep(t.start-(o?2:0),t.end,t.start,t.end,new r.Slice(s,0,0),n.length,!0));for(var c=0,l=0;l<n.length;l++)n[l].type==a&&(c=l+1);for(var d=n.length-c,f=t.start+n.length-(o?2:0),p=t.parent,m=t.startIndex,h=t.endIndex,v=!0;m<h;m++,v=!1)!v&&Object(i.canSplit)(e.doc,f,d)&&(e.split(f,d),f+=2*d),f+=p.child(m).nodeSize;return e}(n.tr,c,p,l,e).scrollIntoView()),!0)}}function a(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=o.node;if(u&&u.isBlock||a.depth<2||!a.sameParent(s))return!1;var c=a.node(-1);if(c.type!=e)return!1;if(0==a.parent.content.size){if(2==a.depth||a.node(-3).type!=e||a.index(-2)!=a.node(-2).childCount-1)return!1;if(n){for(var l=r.Fragment.empty,d=a.index(-1)>0,f=a.depth-(d?1:2);f>=a.depth-3;f--)l=r.Fragment.from(a.node(f).copy(l));l=l.append(r.Fragment.from(e.createAndFill()));var p=t.tr.replace(a.before(d?null:-1),a.after(-3),new r.Slice(l,d?3:2,2));p.setSelection(t.selection.constructor.near(p.doc.resolve(a.pos+(d?3:2)))),n(p.scrollIntoView())}return!0}var m=s.pos==a.end()?c.contentMatchAt(0).defaultType:null,h=t.tr.delete(a.pos,s.pos),v=m&&[null,{type:m}];return!!Object(i.canSplit)(h.doc,a.pos,2,v)&&(n&&n(h.split(a.pos,2,v).scrollIntoView()),!0)}}function s(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=a.blockRange(s,(function(t){return t.childCount&&t.firstChild.type==e}));return!!u&&(!n||(a.node(u.depth-1).type==e?function(e,t,n,o){var a=e.tr,s=o.end,u=o.$to.end(o.depth);s<u&&(a.step(new i.ReplaceAroundStep(s-1,u,s,u,new r.Slice(r.Fragment.from(n.create(null,o.parent.copy())),1,0),1,!0)),o=new r.NodeRange(a.doc.resolve(o.$from.pos),a.doc.resolve(u),o.depth));return t(a.lift(o,Object(i.liftTarget)(o)).scrollIntoView()),!0}(t,n,e,u):function(e,t,n){for(var o=e.tr,a=n.parent,s=n.end,u=n.endIndex-1,c=n.startIndex;u>c;u--)s-=a.child(u).nodeSize,o.delete(s-1,s+1);var l=o.doc.resolve(n.start),d=l.nodeAfter,f=0==n.startIndex,p=n.endIndex==a.childCount,m=l.node(-1),h=l.index(-1);if(!m.canReplace(h+(f?0:1),h+1,d.content.append(p?r.Fragment.empty:r.Fragment.from(a))))return!1;var v=l.pos,k=v+d.nodeSize;return o.step(new i.ReplaceAroundStep(v-(f?1:0),k+(p?1:0),v+1,k-1,new r.Slice((f?r.Fragment.empty:r.Fragment.from(a.copy(r.Fragment.empty))).append(p?r.Fragment.empty:r.Fragment.from(a.copy(r.Fragment.empty))),f?0:1,p?0:1),f?0:1)),t(o.scrollIntoView()),!0}(t,n,u)))}}function u(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=a.blockRange(s,(function(t){return t.childCount&&t.firstChild.type==e}));if(!u)return!1;var c=u.startIndex;if(0==c)return!1;var l=u.parent,d=l.child(c-1);if(d.type!=e)return!1;if(n){var f=d.lastChild&&d.lastChild.type==l.type,p=r.Fragment.from(f?e.create():null),m=new r.Slice(r.Fragment.from(e.create(null,r.Fragment.from(l.type.create(null,p)))),f?3:1,0),h=u.start,v=u.end;n(t.tr.step(new i.ReplaceAroundStep(h-(f?3:1),v,h,v,m,1,!0)).scrollIntoView())}return!0}}},r4xq:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/NodeBar")},rLLB:function(e,t){e.exports=tui.require("editor_weka/components/editing/Emojis")},rR9N:function(e,t){e.exports=tui.require("tui/prosemirror/view")},rqBY:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Mention")},s0QR:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("oBkI"),m=n("fvDX"),h=n("V68o");function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var k=function(e){u()(n,e);var t=v(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{ruler:{schema:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}}}}}},{key:"toolbarItems",value:function(){return[new m.ToolbarItem({group:"embeds",label:Object(h.langString)("horizontalrule","editor"),icon:"editor_weka|arrows",execute:function(e){e.execute((function(t,n){var i=t.schema.nodes.ruler;n(t.tr.replaceSelectionWith(i.create())),e.view.focus()}))}})]}},{key:"keymap",value:function(e){var t=this.getSchema().nodes.ruler;e("Mod-_",(function(e,n){return n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0}))}}]),n}(p.default);t.default=function(e){return new k(e)}},sjpv:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.wrapperStyle},[n("ActionDropdown",{attrs:{actions:e.actions,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)})],1)};i._withStripped=!0;var r=n("ce8f"),o={components:{ActionDropdown:n.n(r).a},props:{location:{type:Object,validator:function(e){return"x"in e&&"y"in e}},actions:Array},computed:{wrapperStyle:function(){return{position:"absolute",left:this.location.x+"px",top:this.location.y+"px"}}}},a=n("KHd+"),s=Object(a.a)(o,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/editing/PositionedActionDropdown.vue";t.default=s.exports},"sl/l":function(e,t){e.exports=tui.require("tui/prosemirror/transform")},"t+A+":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaWithLearn"},[n("h3",{staticClass:"tui-wekaWithLearn__title"},[e._v("\n    "+e._s(e.$str("pluginname","editor_weka"))+"\n  ")]),e._v(" "),n("Form",{staticClass:"tui-wekaWithLearn__form",attrs:{method:"POST",action:e.$url("/lib/editor/weka/tests/fixtures/weka_with_learn.php",{sesskey:e.sesskey}),"input-width":"full",vertical:!0}},[n("FormRow",{staticClass:"tui-wekaWithLearn__form__row",attrs:{label:e.$str("pluginname","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("Weka",{attrs:{id:i,component:"editor_weka",area:"learn",doc:e.doc,"instance-id":e.instanceId},on:{update:e.updateContent}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__form__row",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"json_content",value:e.documentValue,hidden:!0}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__form__row",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"item_id",value:e.itemId,hidden:!0}})]}}])}),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaWithLearn__form__buttonGroup"},[n("Submit"),e._v(" "),n("Button",{attrs:{type:"submit",name:"cancel",value:"1",text:e.$str("cancel","moodle")}})],1)],1),e._v(" "),n("hr"),e._v(" "),n("pre",{staticClass:"tui-wekaWithLearn__code"},[e._v(e._s(e.jsonPretty))])],1)};i._withStripped=!0;var r=n("nEm4"),o=n.n(r),a=n("i/kK"),s=n.n(a),u=n("2wx7"),c=n.n(u),l=n("BN8m"),d=n.n(l),f=n("oMuj"),p=n.n(f),m=n("TXEh"),h=n("KRvX"),v=n.n(h),k=n("vF5l"),_=n.n(k),g={components:{Form:o.a,FormRow:s.a,Weka:c.a,ButtonGroup:d.a,InputText:p.a,Submit:v.a,Button:_.a},props:{defaultDoc:{type:String,default:""},instanceId:[String,Number],sesskey:{type:String,required:!0}},data:function(){return{doc:null,itemId:this.defaultItemId}},computed:{documentValue:function(){return null===this.doc?"":JSON.stringify(this.doc)},jsonPretty:function(){return JSON.stringify(this.doc,void 0,2)}},watch:{defaultDoc:{immediate:!0,handler:function(e){e&&(this.doc=JSON.parse(e))}}},methods:{$_readJSON:Object(m.debounce)((function(e){this.doc=e.getJSON(),this.itemId=e.getFileStorageItemId()}),250),updateContent:function(e){this.$_readJSON(e)}}},y=n("KHd+"),b=function(e){e.options.__langStrings={editor_weka:["pluginname"],moodle:["cancel"]}},w=Object(y.a)(g,i,[],!1,null,null,null);"function"==typeof b&&b(w),w.options.__hasBlocks={script:!0,template:!0},w.options.__file="client/src/editor_weka/pages/fixtures/WekaWithLearn.vue";t.default=w.exports},t6uu:function(e,t,n){"use strict";n.r(t),n.d(t,"createMentionContent",(function(){return r}));var i=n("kgTP");function r(e){var t=e.fullname,n=e.userId,r=Object(i.getDefaultDocument)();return r.content[0]={type:"paragraph",content:[{type:"mention",attrs:{id:n,display:t}},{type:"text",text:" "}]},r}},ta2K:function(e,t){e.exports=tui.require("editor_weka/components/nodes/VideoBlock")},tkAW:function(e,t){e.exports=tui.require("tui/components/modal/Modal")},tnXT:function(e,t){e.exports=tui.require("editor_weka/components/nodes/BaseNode")},u5iS:function(e,t){e.exports=tui.require("tui/components/modal/ModalContent")},vF5l:function(e,t){e.exports=tui.require("tui/components/buttons/Button")},vyVp:function(e,t){e.exports=tui.require("tui/notifications")},wbdD:function(e,t,n){"use strict";n.r(t),n.d(t,"createSchema",(function(){return a}));var i=n("wd6j"),r=["p",0],o={doc:{content:"block+"},paragraph:{group:"block",content:"inline*",parseDOM:[{tag:"p"}],toDOM:function(){return r}},text:{group:"inline"}};function a(e){var t=e.nodes,n=e.marks;return new i.Schema({nodes:Object.assign({},o,t),marks:n||{}})}},wd6j:function(e,t){e.exports=tui.require("tui/prosemirror/model")},"x/Nx":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-filePicker"},[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{type:"file",multiple:this.multiple},on:{change:this.$_pickFile}})])};i._withStripped=!0;var r={props:{autoTrigger:{type:Boolean,default:!1},maxFiles:{type:[String,Number]}},computed:{multiple:function(){return 1!=this.maxFiles}},mounted:function(){this.autoTrigger&&(this.$_click(),this.$window.document.addEventListener("keyup",this.$_dismiss))},beforeDestroy:function(){this.$window.document.removeEventListener("keyup",this.$_dismiss)},methods:{$_pickFile:function(e){var t=[];e&&e.target&&e.target.files&&(t=e.target.files),this.$emit("picked-files",t),this.$emit("dismiss")},$_click:function(){this.$refs.fileInput&&this.$refs.fileInput.click()},$_dismiss:function(e){e&&"Escape"===e.key&&this.$emit("dismiss")}}},o=n("KHd+"),a=Object(o.a)(r,i,[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0},a.options.__file="client/src/editor_weka/components/upload/FilePicker.vue";t.default=a.exports},x4h3:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),r=n("rR9N");t.default=function(e){return new i.Plugin({key:new i.PluginKey("text-placeholder"),props:{decorations:function(t){var n=t.doc;if(!e)return!1;if(1!==n.childCount||!n.firstChild.isTextblock)return!1;var i=[];return n.descendants((function(t,n){return t.type.isBlock&&0==t.childCount&&i.push(r.Decoration.node(n,n+t.nodeSize,{class:"tui-weka__placeholder","data-placeholder":e})),!0})),r.DecorationSet.create(n,i)}}})}},xYuG:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-linkBlock",attrs:{"data-url":e.attrs.url}},[n("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("div",{on:{"!click":function(e){return e.preventDefault(),i(e)}}},[n("LinkBlockInner",{attrs:{attrs:e.attrs}})],1),e._v(" "),n("div",{staticClass:"tui-editorWeka-linkBlock__btn-wrapper"},[n("ButtonIcon",{staticClass:"tui-editorWeka-linkBlock__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":r.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.attrs.title||e.attrs.url)},on:{click:i}},[n("More")],1)],1)]}}])},[e._v(" "),n("DropdownButton",{on:{click:e.open}},[e._v("\n      "+e._s(e.$str("go_to_link","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.edit}},[e._v("\n      "+e._s(e.$str("edit","moodle"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.toLink}},[e._v("\n      "+e._s(e.$str("display_as_text","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.remove}},[e._v("\n      "+e._s(e.$str("remove","moodle"))+"\n    ")])],1)],1)};i._withStripped=!0;var r=n("tnXT"),o=n.n(r),a=n("5h9J"),s=n.n(a),u=n("gLvT"),c=n.n(u),l=n("3sQR"),d=n.n(l),f=n("0QOp"),p=n.n(f),m=n("hCGN"),h=n.n(m),v={components:{ButtonIcon:s.a,Dropdown:c.a,DropdownButton:d.a,LinkBlockInner:p.a,More:h.a},extends:o.a,methods:{open:function(){window.open(this.attrs.url)},edit:function(){this.context.editCard(this.getRange)},toLink:function(){var e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})},remove:function(){this.$emit("remove")}}},k=n("KHd+"),_=function(e){e.options.__langStrings={editor_weka:["display_as_text","go_to_link","actions_menu_for"],moodle:["edit","remove"]}},g=Object(k.a)(v,i,[],!1,null,null,null);"function"==typeof _&&_(g),g.options.__hasBlocks={script:!0,template:!0},g.options.__file="client/src/editor_weka/components/nodes/LinkBlock.vue";t.default=g.exports},yHzl:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditImageAltTextModal")},z2s3:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/Toolbar")},z3By:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("wd6j"),u=n("i7/w"),c=n.n(u),l=function(){function e(t){r()(this,e),this._instance=null,this._editor=t}return a()(e,[{key:"matcher",value:function(e,t){if(!(t&&t instanceof s.ResolvedPos))return null;var n,i=t.doc.textBetween(t.start(),t.end(),"\0","\0");if(""===i)return null;for(e.lastIndex=0;n=e.exec(i);){var r=n.input.slice(Math.max(0,n.index-1),n.index);if(/^[\s\0]?$/.test(r)){var o=n.index+t.start(),a=o+n[0].length;if(o<t.pos&&a>=t.pos)return{range:{from:o,to:a},text:n[0]}}}return null}},{key:"destroyInstance",value:function(){null!==this._instance&&(this._instance.$destroy(),this._editor.viewExtrasLiveEl.removeChild(this._instance.$el),this._instance=null)}},{key:"resetComponent",value:function(){return{apply:!1,text:"",from:0,to:0}}},{key:"showList",value:function(e){var t=this,n=e.view,i=e.component,r=e.state,o=r.range,a=r.text,s=e.callback,u=document.createElement("span");this._editor.viewExtrasLiveEl.appendChild(u);var l=n.coordsAtPos(o.from),d=this._editor.viewExtrasLiveEl.offsetParent.getBoundingClientRect();this._instance=new(c.a.extend(i.component))({parent:this._editor.getParent(),propsData:{x:l.left-d.left,y:l.bottom-d.top,pattern:a}}),this._instance.$mount(u),this._instance.$on("item-selected",(function(e){var r=e.id,a=e.text;t.destroyInstance();var u=t.getNode(n.state,i.name,i.attrs(r,a));t.convertToNode(o,u),"function"==typeof s&&s()})),this._instance.$on("dismiss",(function(){t.destroyInstance(),t._editor.view.focus()}))}},{key:"getNode",value:function(e,t,n){return e.schema.node(t,n)}},{key:"convertToNode",value:function(e,t){var n=this;this._editor.execute((function(i,r){r(n.createTransaction(i,e,t)),n._editor.view.focus()}))}},{key:"createTransaction",value:function(e,t,n){var i=e.tr;return i=i.replaceWith(t.from,t.to,n)}},{key:"apply",value:function(e,t,n,i){var r=e.selection,o=Object.assign({},t);if(r.from===r.to){var a=this.matcher(n,r.$from);if(a)return o.active=!0,o.range=a.range,o.text=a.text,i&&(i.text=a.text,i.from=a.range.from,i.to=a.range.to),o}return o.active=!1,o.range={},o.text=null,o}}]),e}()},zK61:function(e,t){e.exports=tui.require("editor_weka/mixins/attachment_mixin")},zLSG:function(e,t,n){"use strict";n.r(t),n.d(t,"SetAttrsStep",(function(){return _})),n.d(t,"setAttrs",(function(){return g}));var i=n("cDf5"),r=n.n(i),o=n("lwsE"),a=n.n(o),s=n("W8MJ"),u=n.n(s),c=n("7W2i"),l=n.n(c),d=n("a1gu"),f=n.n(d),p=n("Nsbk"),m=n.n(p),h=n("wd6j"),v=n("sl/l");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=m()(e);if(t){var r=m()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f()(this,n)}}var _=function(e){l()(n,e);var t=k(n);function n(e,i){var r;return a()(this,n),(r=t.call(this)).pos=e,r.attrs=i,r}return u()(n,[{key:"apply",value:function(e){var t=e.nodeAt(this.pos);if(!t)return v.StepResult.fail("No node at given position");var n=t.type.create(this.attrs,h.Fragment.empty,t.marks),i=new h.Slice(h.Fragment.from(n),0,t.isLeaf?0:1);return v.StepResult.fromReplace(e,this.pos,this.pos+t.nodeSize,i)}},{key:"invert",value:function(e){var t=e.nodeAt(this.pos);return new n(this.pos,t?t.attrs:null)}},{key:"map",value:function(e){var t=e.mapResult(this.pos,1);return t.deleted?null:new n(t.pos,this.attrs)}},{key:"toJSON",value:function(){return{stepType:"setAttrs",pos:this.pos,attrs:this.attrs}}}],[{key:"fromJSON",value:function(e,t){if("number"!=typeof t.pos||null!=t.attrs&&"object"!=r()(t.attrs))throw new RangeError("Invalid input for SetAttrsStep.fromJSON");return new n(t.pos,t.attrs)}}]),n}(v.Step);v.Step.jsonID("setAttrs",_);var g=function(e,t){return function(n){return n.step(new _(e,t))}}},zdIk:function(e,t,n){!function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("editor_weka")?console.warn('[tui bundle] The bundle "editor_weka" is already loaded, skipping initialisation.'):(tui._bundle.register("editor_weka"),tui._bundle.addModulesFromContext("editor_weka",n("1j8w")),tui._bundle.addModulesFromContext("editor_weka/components",n("ISlu")),tui._bundle.addModulesFromContext("editor_weka/pages",n("YOQe")))}()},ziKp:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachment")}});