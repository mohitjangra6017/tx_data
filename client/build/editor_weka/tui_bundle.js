!function(e){function t(t){for(var i,r,s=t[0],l=t[1],d=t[2],u=0,m=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&m.push(o[r][0]),o[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(c&&c(t);m.length;)m.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},o={2:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var c=l;a.push(["zdIk",0]),n()}({"+MEP":function(e,t){e.exports=tui.require("tui/components/profile/MiniProfileCard")},"+pLW":function(e,t){e.exports=tui.require("editor_weka/components/suggestion/User")},"+xcZ":function(e,t){e.exports=tui.require("editor_weka/components/attachments/FileAttachment")},"/Kfb":function(e,t,n){"use strict";n.r(t),n.d(t,"findParentNode",(function(){return a})),n.d(t,"findParentNodeClosestToPos",(function(){return r})),n.d(t,"findParentDomRef",(function(){return s})),n.d(t,"hasParentNode",(function(){return l})),n.d(t,"findParentNodeOfType",(function(){return d})),n.d(t,"findParentNodeOfTypeClosestToPos",(function(){return c})),n.d(t,"hasParentNodeOfType",(function(){return u})),n.d(t,"findParentDomRefOfType",(function(){return m})),n.d(t,"findSelectedNodeOfType",(function(){return p})),n.d(t,"findPositionOfNodeBefore",(function(){return h})),n.d(t,"findDomRefAtPos",(function(){return f}));var i=n("n31W"),o=n("FtnZ");const a=e=>({$from:t})=>r(t,e),r=(e,t)=>{for(let n=e.depth;n>0;n--){const i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}},s=(e,t)=>n=>{const i=a(e)(n);if(i)return f(i.pos,t)},l=e=>t=>!!a(e)(t),d=e=>t=>a(t=>Object(o.equalNodeType)(e,t))(t),c=(e,t)=>r(e,e=>Object(o.equalNodeType)(t,e)),u=e=>t=>l(t=>Object(o.equalNodeType)(e,t))(t),m=(e,t)=>n=>s(t=>Object(o.equalNodeType)(e,t),t)(n),p=e=>t=>{if(Object(o.isNodeSelection)(t)){const{node:n,$from:i}=t;if(Object(o.equalNodeType)(e,n))return{node:n,pos:i.pos,depth:i.depth}}},h=e=>{const{nodeBefore:t}=e.$from,n=i.Selection.findFrom(e.$from,-1);if(n&&t){const e=d(t.type)(n);return e?e.pos:n.$from.pos}},f=(e,t)=>{const n=t(e),i=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:i&&i.nodeType!==Node.TEXT_NODE?i:n.node}},"00Pk":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AudioBlock")},"0QOp":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/LinkBlock")},"12HA":function(e,t){e.exports=tui.require("tui/config")},"1RMz":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-fileAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var o=n("RNtj"),a=n.n(o),r=n("r4xq"),s=n.n(r),l=n("zK61"),d=n.n(l),c={components:{AttachmentNode:a.a,NodeBar:s.a},mixins:[d.a],computed:{actions(){let e=[{label:this.$str("remove","moodle"),action:()=>{this.$emit("delete")}}];return this.hasDownloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{this.$emit("download")}}),e}}},u=n("KHd+"),m=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["actions_menu_for"]}},p=Object(u.a)(c,i,[],!1,null,null,null);"function"==typeof m&&m(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/FileAttachment.vue";t.default=p.exports},"1bAF":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-nodeBar"},[n("ActionDropdown",{attrs:{position:"bottom-right",actions:e.actions},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("ButtonIcon",{attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":o?"true":"false","aria-label":e.ariaLabel?e.ariaLabel:e.$str("more_items","editor_weka")},on:{click:i}},[n("More")],1)]}}])})],1)};i._withStripped=!0;var o=n("ce8f"),a=n.n(o),r=n("5h9J"),s=n.n(r),l=n("hCGN"),d=n.n(l),c={components:{ActionDropdown:a.a,ButtonIcon:s.a,More:d.a},props:{actions:{type:Array,required:!0},ariaLabel:String}},u=n("KHd+"),m=function(e){e.options.__langStrings={editor_weka:["more_items"]}},p=Object(u.a)(c,i,[],!1,null,null,null);"function"==typeof m&&m(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/toolbar/NodeBar.vue";t.default=p.exports},"1j8w":function(e,t,n){var i={"./ComponentView":"lELM","./ComponentView.js":"lELM","./Editor":"T7/7","./Editor.js":"T7/7","./WekaValue":"DgbO","./WekaValue.js":"DgbO","./api":"JMt+","./api.js":"JMt+","./extensions/Base":"oBkI","./extensions/Base.js":"oBkI","./extensions/attachment":"oBVP","./extensions/attachment.js":"oBVP","./extensions/emoji":"HtKA","./extensions/emoji.js":"HtKA","./extensions/hashtag":"MbZ7","./extensions/hashtag.js":"MbZ7","./extensions/link":"eoJc","./extensions/link.js":"eoJc","./extensions/list":"O2zc","./extensions/list.js":"O2zc","./extensions/media":"2pXJ","./extensions/media.js":"2pXJ","./extensions/mention":"Z8if","./extensions/mention.js":"Z8if","./extensions/ruler":"s0QR","./extensions/ruler.js":"s0QR","./extensions/text":"SFqO","./extensions/text.js":"SFqO","./extensions/util":"iag4","./extensions/util.js":"iag4","./helpers/editor":"VUoS","./helpers/editor.js":"VUoS","./helpers/file":"MJ7y","./helpers/file.js":"MJ7y","./helpers/media":"gEm7","./helpers/media.js":"gEm7","./helpers/mention":"t6uu","./helpers/mention.js":"t6uu","./helpers/suggestion":"z3By","./helpers/suggestion.js":"z3By","./integration":"e9dp","./integration.js":"e9dp","./keymap":"5yv7","./keymap.js":"5yv7","./lib/prosemirror_schema_list/schema_list":"qSeW","./lib/prosemirror_schema_list/schema_list.js":"qSeW","./lib/prosemirror_utils/helpers":"FtnZ","./lib/prosemirror_utils/helpers.js":"FtnZ","./lib/prosemirror_utils/selection":"/Kfb","./lib/prosemirror_utils/selection.js":"/Kfb","./lib/prosemirror_utils/transforms":"Jfd+","./lib/prosemirror_utils/transforms.js":"Jfd+","./mixins/attachment_mixin":"BPQQ","./mixins/attachment_mixin.js":"BPQQ","./plugins/attachment":"f56J","./plugins/attachment.js":"f56J","./plugins/emoji":"9COe","./plugins/emoji.js":"9COe","./plugins/hashtag":"FGzX","./plugins/hashtag.js":"FGzX","./plugins/mention":"BDOe","./plugins/mention.js":"BDOe","./plugins/text_placeholder":"x4h3","./plugins/text_placeholder.js":"x4h3","./schema":"wbdD","./schema.js":"wbdD","./toolbar":"fvDX","./toolbar.js":"fvDX","./transaction":"zLSG","./transaction.js":"zLSG","./util":"X7tx","./util.js":"X7tx","./utils/list":"WI/B","./utils/list.js":"WI/B","./utils/upload":"ddKQ","./utils/upload.js":"ddKQ"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="1j8w"},"1k+S":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-suggestion__hashtag",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!1,open:e.showSuggestions},on:{dismiss:e.dismiss},scopedSlots:e._u([{key:"trigger",fn:function(){return[n("span",{staticClass:"sr-only"},[e._v("\n        "+e._s(e.$str("matching_hashtags","weka_editor"))+":\n      ")])]},proxy:!0}])},[e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","moodle"))+"\n      ")])]:e._l(e.hashtags,(function(t,i){return n("DropdownItem",{key:i,on:{click:function(n){return e.pickTag(t)}}},[e._v("\n        "+e._s(t.tag)+"\n      ")])}))],2)],1)};i._withStripped=!0;var o=n("gLvT"),a=n.n(o),r=n("KGcv"),s=n.n(r),l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_find_hashtags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"hashtags"},name:{kind:"Name",value:"core_hashtags_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tag"},arguments:[],directives:[]}]}}]}}]},d={components:{Dropdown:a.a,DropdownItem:s.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},x:{required:!0,type:[Number,String]},y:{required:!0,type:[Number,String]},pattern:{required:!0,type:String}},data:()=>({hashtags:[]}),apollo:{hashtags:{query:l,variables(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},computed:{showSuggestions(){return this.$apollo.loading||this.hashtags.length>0},positionStyle(){return{left:this.x+"px",top:this.y+"px"}}},watch:{showSuggestions(e){e||this.$emit("dismiss")}},mounted(){let e=this.$refs.customTrigger;e&&e.click()},methods:{pickTag({id:e,tag:t}){this.$emit("item-selected",{id:e,text:t})},dismiss(){this.open=!1,this.$emit("dismiss")}}},c=n("KHd+"),u=function(e){e.options.__langStrings={editor_weka:["matching_hashtags"],moodle:["loadinghelp"]}},m=Object(c.a)(d,i,[],!1,null,null,null);"function"==typeof u&&u(m),m.options.__hasBlocks={script:!0,template:!0},m.options.__file="client/src/editor_weka/components/suggestion/Hashtag.vue";t.default=m.exports},"2pXJ":function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("fvDX"),a=n("V68o"),r=n("ddKQ"),s=n("Cx/y"),l=n.n(s),d=n("ta2K"),c=n.n(d),u=n("AtFJ"),m=n.n(u),p=n("JMt+"),h=n("gEm7"),f=n("iag4"),_=n("vyVp");class g extends i.default{constructor(e){super(e),this.acceptTypes=e.accept_types||[]}nodes(){return{image:{schema:{atom:!0,group:"block",inline:!1,selectable:!0,attrs:{filename:{default:void 0},url:{default:void 0},alttext:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-imageBlock",getAttrs:f.getJsonAttrs},{tag:"div.tui-imageBlock",getAttrs:f.getJsonAttrs}],toDOM:e=>["div",{class:"tui-editorWeka-imageBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,alttext:e.attrs.alttext,url:e.attrs.url})}]},component:l.a,componentContext:{replaceWithAttachment:this._replaceImageWithAttachment.bind(this),updateImage:this._updateImage.bind(this),hasAttachmentNode:this._hasAttachmentsNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},video:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-videoBlock",getAttrs:f.getJsonAttrs},{tag:"div.tui-videoBlock",getAttrs:f.getJsonAttrs}],toDOM:e=>["div",{class:"tui-editorWeka-videoBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]},component:c.a,componentContext:{replaceWithAttachment:this._replaceVideoWithAttachment.bind(this),hasAttachmentNode:this._hasAttachmentNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},audio:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-audioBlock",getAttrs:f.getJsonAttrs},{tag:"div.tui-audioBlock",getAttrs:f.getJsonAttrs}],toDOM:e=>["div",{class:"tui-editorWeka-audioBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]},component:m.a,componentContext:{hasAttachmentNode:this._hasAttachmentNode.bind(this),replaceWithAttachment:this._replaceAudioWithAttachment.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}}}}toolbarItems(){return[new o.ToolbarItem({group:"upload",label:Object(a.langString)("embedded_media","editor_weka"),icon:"editor_weka|image",execute:e=>{Object(r.pickFiles)(e).then(async e=>{e&&this._startUploading(e)})}})]}async _startUploading(e){try{const t=await this.editor.fileStorage.uploadFiles(e,this.acceptTypes);if(0===t.length)return;const n=this.editor.state.schema,i=await Promise.all(t.map(({file:e,id:t,url:i})=>Object(p.getMediaType)({filename:e,itemId:t}).then(({mediaType:t,mimeType:o})=>h.IMAGE===t?n.node("image",{filename:e,alttext:"",url:i}):h.VIDEO===t?n.node("video",{filename:e,url:i,mime_type:o}):n.node("audio",{url:i,filename:e,mime_type:o}))));this.editor.execute((e,t)=>{const o=e.tr,{selection:a}=o;if(this._hasAttachmentsNode()){const{attachments:e}=n.nodes;if(a.$from.parent&&e.name===a.$from.parent.type.name)return o.insert(o.selection.$from.after(),i),void t(o)}if(a.empty){let e=a.$from,t=e.parent;"paragraph"===t.type.name&&0===t.content.size?(o.replaceWith(e.before(),e.after(),i),this.editor.view.focus()):o.insert(e.pos,i)}else o.replaceWith(a.from,a.to,i);t(o)})}catch(e){console.error(e);const t=Object(a.langString)("error_upload_failed","editor_weka");Object(a.loadLangStrings)([t]).then(()=>Object(_.notify)({type:"error",message:t.toString()}))}}_replaceImageWithAttachment(e,{filename:t,alttext:n,size:i}){this.editor.execute((o,a)=>{const r=o.tr,s=e();let l=o.schema.node("attachment",{filename:t,url:this._getFileUrl(t),size:i,option:{alttext:n}});a(r.replaceWith(s.from,s.to,o.schema.node("attachments",null,[l])))})}_replaceVideoWithAttachment(e,{filename:t,size:n}){this.editor.execute((i,o)=>{const a=i.tr,r=e();let s=i.schema.node("attachment",{filename:t,url:this._getFileUrl(t),size:n,option:{}});o(a.replaceWith(r.from,r.to,i.schema.node("attachments",null,[s])))})}_updateImage(e,{filename:t,alttext:n,mimeType:i}){this.editor.execute((o,a)=>{const r=o.tr,s=e();let l=o.schema.node("image",{filename:t,url:this._getFileUrl(t),alttext:n,mime_type:i});a(r.replaceWith(s.from,s.to,l)),this.editor.view.focus()})}_replaceAudioWithAttachment(e,{filename:t,size:n}){this.editor.execute((i,o)=>{const a=i.tr,r=e();let s=i.schema.node("attachment",{filename:t,url:this._getFileUrl(t),size:n,option:{}});o(a.replaceWith(r.from,r.to,i.schema.node("attachments",null,[s])))})}_hasAttachmentNode(){return this.editor.hasNode("attachment")}_hasAttachmentsNode(){return this.editor.hasNode("attachments")}_getFileUrl(e){let t=this.editor.fileStorage.getFile(e);return t?t.url:null}_getItemId(){let e=this.editor.fileStorage.getRepositoryData();return e?e.itemId:null}}t.default=e=>new g(e)},"2wx7":function(e,t){e.exports=tui.require("editor_weka/components/Weka")},"36rR":function(e,t){e.exports=tui.require("tui/dom/focus")},"3Nur":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{staticClass:"tui-editorWeka-editImageAltTextModal"},[n("ModalContent",{staticClass:"tui-editorWeka-editImageAltTextModal__content",attrs:{title:e.modalTitle}},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[n("div",{staticClass:"tui-editorWeka-editImageAltTextModal__input"},[n("InputText",{attrs:{autofocus:!0},model:{value:e.innerValue,callback:function(t){e.innerValue=t},expression:"innerValue"}}),e._v(" "),n("p",{staticClass:"tui-editorWeka-editImageAltTextModal__input__helpText"},[e._v("\n          "+e._s(e.$str("image_alt_help","editor_weka"))+"\n        ")])],1),e._v(" "),n("ButtonGroup",{staticClass:"tui-editorWeka-editImageAltTextModal__buttonGroup"},[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka")},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:function(t){return t.preventDefault(),e.$emit("request-close")}}})],1)],1)],1)],1)};i._withStripped=!0;var o=n("nEm4"),a=n.n(o),r=n("tkAW"),s=n.n(r),l=n("u5iS"),d=n.n(l),c=n("oMuj"),u=n.n(c),m=n("BN8m"),p=n.n(m),h=n("vF5l"),f=n.n(h),_=n("nXMa"),g=n.n(_),v={components:{Modal:s.a,ModalContent:d.a,Form:a.a,InputText:u.a,ButtonGroup:p.a,Button:f.a,ButtonCancel:g.a},props:{value:{type:String,required:!0}},data(){return{innerValue:this.value}},computed:{modalTitle(){return 0===this.value.length?this.$str("add_image_alt_text","editor_weka"):this.$str("edit_image_alt_text","editor_weka")}},methods:{confirm(){this.$emit("change",this.innerValue)}}},k=n("KHd+"),b=function(e){e.options.__langStrings={editor_weka:["add_image_alt_text","edit_image_alt_text","done","image_alt_help"]}},y=Object(k.a)(v,i,[],!1,null,null,null);"function"==typeof b&&b(y),y.options.__hasBlocks={script:!0,template:!0},y.options.__file="client/src/editor_weka/components/editing/EditImageAltTextModal.vue";t.default=y.exports},"3bgQ":function(e,t){e.exports=tui.require("tui/components/embeds/ResponsiveEmbedIframe")},"3sQR":function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownButton")},"3t4c":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dropdown",{attrs:{position:e.position,open:e.open},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)},[e._v(" "),e._t("dropdown-items",e._l(e.actions,(function(t,i){return n("DropdownButton",{key:i,on:{click:function(e){return e.preventDefault(),t.action()}}},[e._v("\n      "+e._s(t.label)+"\n    ")])})))],2)};i._withStripped=!0;var o=n("gLvT"),a=n.n(o),r=n("3sQR"),s=n.n(r),l={components:{Dropdown:a.a,DropdownButton:s.a},props:{position:String,open:Boolean,actions:Array}},d=n("KHd+"),c=Object(d.a)(l,i,[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0},c.options.__file="client/src/editor_weka/components/editing/ActionDropdown.vue";t.default=c.exports},"5XLN":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-user",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!0,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}}},[n("span",{staticClass:"sr-only"},[e._v("\n      "+e._s(e.$str("matching_users","weka_editor"))+":\n    ")]),e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","moodle"))+"\n      ")])]:e._l(e.users,(function(t,i){var o=t.user,a=t.jobassignments;return n("DropdownItem",{key:i,attrs:{paddingless:!0},on:{click:function(t){return e.pickUser(o)}}},[n("MiniProfileCard",{attrs:{"no-border":!0,interactive:!1,"avatar-src":o.profileimageurl,"avatar-alt":o.profileimagealt||"",name:o.fullname,mention:"mention","job-assignment":e.getJobAssignment(a),email:o.email}})],1)}))],2)],1)};i._withStripped=!0;var o=n("gLvT"),a=n.n(o),r=n("KGcv"),s=n.n(r),l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_find_users_by_pattern"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"users"},name:{kind:"Name",value:"editor_weka_users_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileimageurl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileimagealt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"jobassignments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]}]}}]}}]}}]},d=n("+MEP"),c=n.n(d),u={components:{Dropdown:a.a,DropdownItem:s.a,MiniProfileCard:c.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},x:{required:!0,type:[Number,String]},y:{required:!0,type:[Number,String]},pattern:{required:!0,type:String}},apollo:{users:{query:l,variables(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},data:()=>({users:[]}),computed:{positionStyle(){return{left:this.x+"px",top:this.y+"px"}}},methods:{getJobAssignment(e){if(e&&0<e.length){let{fullname:t}=e[0];return t}return""},pickUser({id:e,fullname:t}){this.$emit("item-selected",{id:e,text:t})}}},m=n("KHd+"),p=function(e){e.options.__langStrings={editor_weka:["matching_users"],moodle:["loadinghelp"]}},h=Object(m.a)(u,i,[],!1,null,null,null);"function"==typeof p&&p(h),h.options.__hasBlocks={script:!0,template:!0},h.options.__file="client/src/editor_weka/components/suggestion/User.vue";t.default=h.exports},"5h9J":function(e,t){e.exports=tui.require("tui/components/buttons/ButtonIcon")},"5yv7":function(e,t,n){"use strict";n.r(t),n.d(t,"buildKeymap",(function(){return s}));var i=n("FtgP"),o=n("OQYi"),a=n("AApu");const r="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function s(e,t){let n={};function s(e,t){n[e]=t}s("Mod-z",o.undo),s("Shift-Mod-z",o.redo),s("Backspace",a.undoInputRule),r||s("Mod-y",o.redo),s("Alt-ArrowUp",i.joinUp),s("Alt-ArrowDown",i.joinDown),s("Mod-BracketLeft",i.lift),s("Escape",i.selectParentNode);const l={schema:e,isMac:r};return t.forEach(e=>{e(s,l)}),n}},"6RS6":function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachments")},"78qK":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-emojis"},e._l(e.emojis,(function(t,i){return n("ButtonIcon",{key:i,attrs:{styleclass:{stealth:!0},"aria-label":e.fromShortCode(t.shortcode)},nativeOn:{click:function(n){return e.select(t)}}},[n("Emoji",{staticClass:"tui-editorWeka-emojis__emoji",attrs:{"short-code":t.shortcode}})],1)})),1)};i._withStripped=!0;var o=n("5h9J"),a=n.n(o),r=n("QCX9"),s=n.n(r),l={components:{ButtonIcon:a.a,Emoji:s.a},props:{emojis:{type:Array,required:!0,validator:e=>e.every(e=>"shortcode"in e)}},methods:{select(e){this.$emit("emoji-selected",e)},fromShortCode:e=>String.fromCodePoint("0x"+e)}},d=n("KHd+"),c=Object(d.a)(l,i,[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0},c.options.__file="client/src/editor_weka/components/editing/Emojis.vue";t.default=c.exports},"8gR2":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-fixture-wekaBasic"},[t("Weka",{attrs:{component:"editor_weka",area:"behat"}})],1)};i._withStripped=!0;var o=n("2wx7"),a={components:{Weka:n.n(o).a}},r=n("KHd+"),s=Object(r.a)(a,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/pages/fixtures/WekaBasic.vue";t.default=s.exports},"9COe":function(e,t,n){"use strict";n.r(t);var i=n("n31W"),o=n("wd6j");t.default=function(e,t,n){const a=new i.PluginKey("emojis");let r=!1;return new i.Plugin({key:a,appendTransaction(e,t,n){const{text:i,active:o,range:r,emoji:s}=a.getState(n);if(!i||!o)return null;const l=n.schema.node("emoji",{id:s.id,shortcode:s.shortcode});return n.tr.replaceWith(r.from,r.to,l)},state:{init:()=>({active:!1,range:{},text:null}),apply(e,n){const{selection:i}=e;let a=Object.assign({},n);if(a.active=!1,!r)return a;if(i.from===i.to){const e=function(e,t){if(!(e&&e instanceof o.ResolvedPos))return null;const n=e.doc.textBetween(e.start(),e.end(),"\0","\0");if(""===n)return null;if(!t)return null;let i,a;for(let o=0;o<t.length;++o){let r=t[o];if(""!==r.pattern)for(a=new RegExp(r.pattern,"g");i=a.exec(n);){let t=i.input.slice(Math.max(0,i.index-1),i.index);if(!/^[\s\0]?$/.test(t))continue;let n=i.index+e.start(),o=n+i[0].length;if(n<e.pos&&o>=e.pos)return{range:{from:n,to:o},text:i[0],emoji:r}}}return null}(i.$from,t);e&&(a.active=!0,a.range=e.range,a.text=e.text,a.emoji=e.emoji)}return a.active||(a.range={},a.text=null),a}},props:{handleKeyDown(e,t){r=n.find(e=>e===t.key)}}})}},"9E4C":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-imageAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,component:"user",area:"draft","item-id":this.draftId}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var o=n("RNtj"),a=n.n(o),r=n("r4xq"),s=n.n(r),l=n("zK61"),d=n.n(l),c={components:{AttachmentNode:a.a,NodeBar:s.a},mixins:[d.a],props:{enableConvert:{type:Boolean,default:!0}},data:()=>({showModal:!1}),computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","moodle"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{this.$emit("download")}}),e}}},u=n("KHd+"),m=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],moodle:["remove","download"]}},p=Object(u.a)(c,i,[],!1,null,null,null);"function"==typeof m&&m(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/ImageAttachment.vue";t.default=p.exports},"9G+f":function(e,t){e.exports=tui.require("tui/components/popover/Popover")},"9Ovj":function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButton")},"9Wm2":function(e,t){e.exports=tui.require("editor_weka/components/marks/Link")},"9cw/":function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkMedia")},"9s3S":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{attrs:{size:"normal","aria-labelledby":e.$id("title")}},[n("ModalContent",{attrs:{title:e.isNew?e.$str("insert_link","editor_weka"):e.$str("edit_link","editor_weka"),"title-id":e.$id("title"),"close-button":!0},scopedSlots:e._u([{key:"buttons",fn:function(){return[n("ButtonGroup",[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka"),disabled:!e.formValid||e.loading},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:e.close}})],1)]},proxy:!0}])},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[e.error?n("p",[e._v(e._s(e.error))]):e._e(),e._v(" "),n("FormRow",{attrs:{label:e.$str("linkurl","editor")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{ref:"url",attrs:{id:i,autofocus:!0},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("display_text","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,value:"link"==e.display?e.text:"",disabled:"link"!=e.display},on:{input:e.updateText}})]}}])}),e._v(" "),n("input",{style:{display:"none"},attrs:{type:"submit"}})],1)],1)],1)};i._withStripped=!0;var o=n("i7/w"),a=n.n(o),r=n("nEm4"),s=n.n(r),l=n("i/kK"),d=n.n(l),c=n("oMuj"),u=n.n(c),m=n("tkAW"),p=n.n(m),h=n("u5iS"),f=n.n(h),_=n("vF5l"),g=n.n(_),v=n("nXMa"),k=n.n(v),b=n("BN8m"),y=n.n(b),w={components:{Form:s.a,FormRow:d.a,InputText:u.a,Modal:p.a,ModalContent:f.a,Button:g.a,ButtonCancel:k.a,ButtonGroup:y.a},props:{isNew:Boolean,attrs:Object,save:Function,isMedia:Function},data:function(){return{url:this.attrs.url,text:this.attrs.text,loading:!1,display:this.attrs.type||"link",wasText:!!this.attrs.text,error:null}},computed:{urlIsMedia(){return this.isMedia&&this.isMedia(this.url)},formValue(){return{type:this.display,url:this.url,text:this.text}},formValid(){return!!this.url}},watch:{urlIsMedia(e){this.wasText||(this.display=e?"link_media":"link")},formValue(){this.error=null}},mounted(){a.a.nextTick(()=>{this.$refs.url&&this.$refs.url.$el&&this.$refs.url.$el.focus()})},methods:{close(){this.$emit("request-close")},confirm(){if(this.loading)return;this.loading=!0;const e=this.formValue;Promise.resolve(this.save(e)).then(this.close).catch(e=>{console.error(e)}).then(()=>this.loading=!1)},updateText(e){this.text=e}}},x=n("KHd+"),N=function(e){e.options.__langStrings={editor:["linkurl"],editor_weka:["done","displayas","display_text","edit_link","insert_link","error_no_url_info","type_embedded_media","type:linkcard","type:plainlink"],moodle:["ok","cancel"]}},S=Object(x.a)(w,i,[],!1,null,null,null);"function"==typeof N&&N(S),S.options.__hasBlocks={script:!0,template:!0},S.options.__file="client/src/editor_weka/components/editing/EditLinkModal.vue";t.default=S.exports},AApu:function(e,t){e.exports=tui.require("tui/prosemirror/inputrules")},"AL+t":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/VideoBlock")},AtFJ:function(e,t){e.exports=tui.require("editor_weka/components/nodes/AudioBlock")},BDOe:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),o=n("z3By"),a=n("+pLW"),r=n.n(a);t.default=function(e){const t=new i.PluginKey("mentions");let n=new o.default(e);const a=new RegExp("@[^@\\s]+","g");return new i.Plugin({key:t,view(){return{update:e=>{const{text:t,active:i,range:o}=this.key.getState(e.state);n.destroyInstance(),t&&i&&n.showList({view:e,component:{name:"mention",component:r.a,attrs:(e,t)=>({id:e,display:t})},state:{text:t.slice(1),active:i,range:o}})}}},state:{init:()=>({active:!1,range:{},text:null}),apply:(e,t)=>n.apply(e,t,a)},props:{handleKeyDown(e,t){if("Escape"===t.key){const{active:t}=this.getState(e.state);return!!t&&(n.destroyInstance(),e.focus(),!0)}}}})}},BN8m:function(e,t){e.exports=tui.require("tui/components/buttons/ButtonGroup")},BPQQ:function(e,t,n){"use strict";n.r(t),t.default={props:{filename:{type:String,required:!0},fileSize:{type:[String,Number],required:!0},draftId:{type:[String,Number],required:!0},hasDownloadUrl:Boolean}}},C9aM:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-imageBlock"},[e.$apollo.loading?[n("p",{staticClass:"tui-editorWeka-imageBlock__text"},[e._v("\n      "+e._s(e.$str("loadinghelp","moodle"))+"\n    ")])]:n("div",{staticClass:"tui-editorWeka-imageBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.$_hideModal}},[n("EditImageAltTextModal",{attrs:{value:e.altText},on:{change:e.$_updateAltText}})],1),e._v(" "),n("ImageBlock",{attrs:{url:e.file.url,filename:e.filename,"alt-text":e.altText}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)],2)};i._withStripped=!0;var o=n("iPZg"),a=n.n(o),r=n("tnXT"),s=n.n(r),l=n("hg2Q"),d=n("r4xq"),c=n.n(d),u=n("yHzl"),m=n.n(u),p=n("Mnur"),h=n.n(p),f={components:{EditImageAltTextModal:m.a,ModalPresenter:h.a,ImageBlock:a.a,NodeBar:c.a},extends:s.a,apollo:{file:{query:l.a,variables(){return{filename:this.filename,item_id:this.itemId}}}},data:()=>({file:{},showModal:!1}),computed:{hasAttachmentNode(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions(){let e=[];return this.hasAttachmentNode&&e.push({label:this.$str("display_as_attachment","editor_weka"),action:()=>{this.$_toAttachment()}}),e=e.concat([{label:this.altTextLabel,action:()=>{this.$_showModal()}},{label:this.$str("remove","moodle"),action:()=>{this.$_removeNode()}}]),this.downloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{window.document.location.href=this.downloadUrl}}),e},altTextLabel(){return this.altText?this.$str("edit_image_alt_text","editor_weka"):this.$str("add_image_alt_text","editor_weka")},altText(){return this.attrs.alttext?this.attrs.alttext:""},filename(){return this.attrs.filename?this.attrs.filename:null},itemId(){if(!this.context.getItemId)throw new Error("No function 'getItemId' for extension media");return this.context.getItemId()},downloadUrl(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,alttext:this.altText,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)},$_showModal(){this.showModal=!0},$_hideModal(){this.showModal=!1},$_updateAltText(e){if(this.$_hideModal(),!this.context.updateImage)return;const t={filename:this.filename,alttext:e,mimeType:this.file.mime_type};this.context.updateImage(this.getRange,t)},$_removeNode(){if(this.context.removeNode)return this.context.removeNode(this.getRange)}}},_=n("KHd+"),g=function(e){e.options.__langStrings={moodle:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","add_image_alt_text","edit_image_alt_text","actions_menu_for"]}},v=Object(_.a)(f,i,[],!1,null,null,null);"function"==typeof g&&g(v),v.options.__hasBlocks={script:!0,template:!0},v.options.__file="client/src/editor_weka/components/nodes/ImageBlock.vue";t.default=v.exports},"Cx/y":function(e,t){e.exports=tui.require("editor_weka/components/nodes/ImageBlock")},D3bS:function(e,t){e.exports=tui.require("editor_weka/components/attachments/ImageAttachment")},DgbO:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("n31W");var i=n("VUoS");class o{constructor(){this._editor=null,this._state=null,this._doc=null,this._map=null,Object.preventExtensions(this)}static fromState(e,t){const n=new o;return n._editor=t,n._state=e,n}static fromDoc(e){const t=new o;return t._doc=e,t}static empty(){return o.fromDoc(Object(i.getDefaultDocument)())}inflated(e){return this._editor==e||this._map&&!!this._map[e.uid]}inflate(e,t){this._editor?(this._map||(this._map={}),this._map[e.uid]=t):(this._editor=e,this._state=t)}getState(e=null){return e?this._editor===e?this._state:this._map&&this._map[e.uid]?this._map[e.uid]:null:this._state}getDoc(){return this._doc||(this._doc=this._state.toJSON().doc),this._doc}toJSON(){return this.getDoc()}get isEmpty(){if(this._state){const{doc:e}=this._state;return 0===e.childCount||1===e.childCount&&e.firstChild.isTextblock&&0===e.firstChild.content.size}if(this._doc){if(0===a(this._doc))return!0;if(1===a(this._doc)){const e=this._doc.content[0];return"paragraph"==e.type&&0===a(e)}return!1}return!0}get fileStorageItemId(){return this._editor&&this._editor.getFileStorageItemId()}}function a(e){return e&&e.content?e.content.length:0}},EBtw:function(e,t){e.exports=tui.require("editor_weka/components/suggestion/Hashtag")},Ea1X:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-audioAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var o=n("RNtj"),a=n.n(o),r=n("r4xq"),s=n.n(r),l=n("zK61"),d=n.n(l),c={components:{AttachmentNode:a.a,NodeBar:s.a},mixins:[d.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","moodle"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{this.$emit("download")}}),e}}},u=n("KHd+"),m=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},p=Object(u.a)(c,i,[],!1,null,null,null);"function"==typeof m&&m(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/AudioAttachment.vue";t.default=p.exports},FGzX:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),o=n("EBtw"),a=n.n(o),r=n("z3By");t.default=function(e){const t=new i.PluginKey("hashtags");let n=new r.default(e),o=n.resetComponent();const s=new RegExp("#[A-Za-z0-9]+$","g");let l=e=>{const t=n.getNode(e.state,"hashtag",{text:o.text.slice(1)});n.convertToNode(o,t),o=n.resetComponent()};return new i.Plugin({key:t,view(){return{update:e=>{const{text:t,active:i,range:r}=this.key.getState(e.state);n.destroyInstance(),t&&i&&n.showList({view:e,component:{name:"hashtag",component:a.a,attrs:(e,t)=>({text:t})},state:{text:t.slice(1),active:i,range:r},callback:()=>{o=n.resetComponent()}})}}},state:{init:()=>({active:!1,range:{},text:null}),apply:(e,t)=>n.apply(e,t,s,o)},props:{handleKeyDown(e,t){o.text.length<=0||(t.key.includes("Arrow")?o=n.resetComponent():(o.apply=void 0!==[" ","Tab","Enter","PageUp","PageDown","Home","End","Escape"].find(e=>e===t.key),o.apply&&l(e)))},handleClick:e=>!(o.text.length<=0)&&(!(o.from<=e.state.selection.from&&o.to>=e.state.selection.to)&&(l(e),!0))}})}},Fmi9:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement;return(e._self._c||t)("ButtonIcon",{staticClass:"tui-editorWeka-toolbarButton",attrs:{styleclass:{toolbar:!0,selected:e.selected},"aria-label":e.text,"aria-pressed":e.ariaPressed,title:e.text,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}},[e._t("icon")],2)};i._withStripped=!0;var o=n("5h9J"),a={components:{ButtonIcon:n.n(o).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},disabled:Boolean},computed:{ariaPressed(){return null!=this.selected&&(this.selected?"true":"false")}}},r=n("KHd+"),s=Object(r.a)(a,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/toolbar/ToolbarButton.vue";t.default=s.exports},FtgP:function(e,t){e.exports=tui.require("tui/prosemirror/commands")},FtnZ:function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeSelection",(function(){return s})),n.d(t,"equalNodeType",(function(){return l})),n.d(t,"cloneTr",(function(){return d})),n.d(t,"replaceNodeAtPos",(function(){return c})),n.d(t,"canReplace",(function(){return u})),n.d(t,"removeNodeAtPos",(function(){return m})),n.d(t,"tableNodeTypes",(function(){return p})),n.d(t,"canInsert",(function(){return h})),n.d(t,"isEmptyParagraph",(function(){return f})),n.d(t,"findTableClosestToPos",(function(){return _})),n.d(t,"createCell",(function(){return g})),n.d(t,"transpose",(function(){return v})),n.d(t,"checkInvalidMovements",(function(){return k}));var i=n("n31W"),o=n("wd6j"),a=n("Jfd+"),r=n("/Kfb");const s=e=>e instanceof i.NodeSelection,l=(e,t)=>Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e,d=e=>Object.assign(Object.create(e),e).setTime(Date.now()),c=(e,t)=>n=>{const i=n.doc.nodeAt(e),o=n.doc.resolve(e);if(u(o,t)){const o=(n=n.replaceWith(e,e+i.nodeSize,t)).selection.$from.pos-1;return n=Object(a.setTextSelection)(Math.max(o,0),-1)(n),n=Object(a.setTextSelection)(n.selection.$from.start())(n),d(n)}return n},u=(e,t)=>{const n=e.node(e.depth);return n&&n.type.validContent(t instanceof o.Fragment?t:o.Fragment.from(t))},m=e=>t=>{const n=t.doc.nodeAt(e);return d(t.delete(e,e+n.nodeSize))},p=e=>{if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const i=e.nodes[n];i.spec.tableRole&&(t[i.spec.tableRole]=i)}),e.cached.tableNodeTypes=t,t},h=(e,t)=>{const n=e.index();return t instanceof o.Fragment?e.parent.canReplace(n,n,t):t instanceof o.Node&&e.parent.canReplaceWith(n,n,t.type)},f=e=>!e||"paragraph"===e.type.name&&2===e.nodeSize,_=e=>Object(r.findParentNodeClosestToPos)(e,e=>e.type.spec.tableRole&&/table/i.test(e.type.spec.tableRole)),g=(e,t=null)=>t?e.createChecked(null,t):e.createAndFill(),v=e=>e[0].map((t,n)=>e.map(e=>e[n])),k=(e,t,n,i)=>{const o=`Target position is invalid, you can't move the ${i} ${e} to ${t}, the target can't be split. You could use tryToFit option.`;if(1===(e>t?-1:1)){if(-1!==n.slice(0,n.length-1).indexOf(t))throw new Error(o)}else if(-1!==n.slice(1).indexOf(t))throw new Error(o);return!0}},GMmN:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-linkMedia",class:{"tui-editorWeka-linkMedia--intrinsic-width":!e.attrs.loading&&!e.iframeUrl},attrs:{"data-url":e.attrs.url}},[n("div",{staticClass:"tui-editorWeka-linkMedia__inner"},[e.attrs.loading?n("div",[e._v("\n      Loading...\n    ")]):e.iframeUrl?n("div",{staticClass:"tui-editorWeka-linkMedia__embed"},[n("ResponsiveEmbedIframe",{attrs:{src:e.iframeUrl,resolution:e.attrs.resolution,title:e.attrs.title||e.attrs.url}})],1):"audio"==e.pluginKey?n("div",[n("audio",{attrs:{controls:"",src:e.attrs.url}})]):"image"==e.pluginKey?n("div",[n("ResponsiveImage",{attrs:{src:e.attrs.url}})],1):n("div",[n("a",{attrs:{href:e.attrs.url}},[e._v(e._s(e.attrs.url))])]),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.summaryText)}})],1)])};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("r4xq"),s=n.n(r),l=n("3bgQ"),d=n.n(l),c=n("IBd2"),u=n.n(c),m={components:{NodeBar:s.a,ResponsiveEmbedIframe:d.a,ResponsiveImage:u.a},extends:a.a,computed:{pluginMatch(){return this.context.urlPlugin({type:"media",url:this.attrs.url})||{}},pluginKey(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.key},pluginName(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.name},details(){return this.pluginMatch.details||{}},actions(){return[{label:this.$str("go_to_link","editor_weka"),action:()=>this.open()},{label:this.$str("edit","moodle"),action:()=>this.edit()},{label:this.$str("display_as_text","editor_weka"),action:()=>this.toLink()},{label:this.$str("remove","moodle"),action:()=>this.$emit("remove")}]},iframeUrl(){const{details:e}=this;switch(this.pluginKey){case"youtube":return"https://www.youtube.com/embed/"+e.id+"?rel=0";case"vimeo":return"https://player.vimeo.com/video/"+e.id+"?portrait=0"}return null},summaryText(){return this.pluginName+" - "+(this.attrs.title||this.attrs.url)}},methods:{open(){window.open(this.attrs.url)},edit(){this.context.editCard(this.getRange)},toLink(){const e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})}}},p=n("KHd+"),h=function(e){e.options.__langStrings={editor_weka:["display_as_text","go_to_link","actions_menu_for"],moodle:["edit","remove"]}},f=Object(p.a)(m,i,[],!1,null,null,null);"function"==typeof h&&h(f),f.options.__hasBlocks={script:!0,template:!0},f.options.__file="client/src/editor_weka/components/nodes/LinkMedia.vue";t.default=f.exports},GqWi:function(e,t){e.exports=tui.require("editor_weka/components/attachments/VideoAttachment")},"H/tB":function(e,t){e.exports=tui.require("tui/tui")},HdaA:function(e,t,n){"use strict";n.r(t);var i={props:{nodeInfo:Object,contextInfo:Object,updateAttrs:Function,replaceWith:Function,getPos:Function,getRange:Function},computed:{node(){return this.nodeInfo.node},attrs(){return this.nodeInfo.node.attrs},context(){return this.contextInfo.context}}},o=n("KHd+"),a=Object(o.a)(i,void 0,void 0,!1,null,null,null);a.options.__hasBlocks={script:!0,template:!1},a.options.__file="client/src/editor_weka/components/nodes/BaseNode.vue";t.default=a.exports},HtKA:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("fvDX"),a=n("V68o"),r=n("rLLB"),s=n.n(r),l=n("fRht"),d=n.n(l),c=n("i7/w"),u=n.n(c),m=n("9COe"),p=n("iag4");class h extends i.default{constructor(e){super(e),void 0===e&&(e={}),this.emojis=e.emojis||[];let t=this.emojis.map(e=>e.pattern);this.charArray=t.toString().split(""),this.charArray=this.charArray.filter((e,t)=>this.charArray.indexOf(e)===t)}nodes(){return{emoji:{schema:{group:"inline",inline:!0,attrs:{shortcode:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-emoji",getAttrs:p.getJsonAttrs}],toDOM:e=>["span",{class:"tui-editorWeka-emoji","data-attrs":JSON.stringify({shortcode:e.attrs.shortcode})},String.fromCodePoint("0x"+e.attrs.shortcode)]},component:d.a}}}plugins(){return[Object(m.default)(this.editor,this.emojis,this.charArray)]}toolbarItems(){return[new o.ToolbarItem({group:"embeds",popover:{title:"",component:this.getEmojiPopover()},label:Object(a.langString)("insertemoji","editor"),icon:"editor_weka|emoji",enabled:e=>e.view.state.selection.$head.pos>0,reset:e=>{e.view.focus()}})]}getEmojiPopover(){return u.a.extend({data:()=>({insertEmoji:this.insertEmoji.bind(this),emojiData:this.emojis}),methods:{emojiSelected(e){this.$emit("close"),this.insertEmoji(e)}},render(e){return e(s.a,{props:{emojis:this.emojiData},on:{"emoji-selected":this.emojiSelected}})}})}insertEmoji({shortcode:e}){this.editor.execute((t,n)=>{const i=t.schema.node("emoji",{shortcode:e}),{from:o,to:a}=t.selection;n(t.tr.replaceWith(o,a,i)),this.editor.view.focus()})}}t.default=e=>new h(e)},IBd2:function(e,t){e.exports=tui.require("tui/components/images/ResponsiveImage")},ISlu:function(e,t,n){var i={"./Weka":"cmE2","./Weka.vue":"cmE2","./attachments/AudioAttachment":"Ea1X","./attachments/AudioAttachment.vue":"Ea1X","./attachments/FileAttachment":"1RMz","./attachments/FileAttachment.vue":"1RMz","./attachments/ImageAttachment":"9E4C","./attachments/ImageAttachment.vue":"9E4C","./attachments/VideoAttachment":"T72/","./attachments/VideoAttachment.vue":"T72/","./editing/ActionDropdown":"3t4c","./editing/ActionDropdown.vue":"3t4c","./editing/EditImageAltTextModal":"3Nur","./editing/EditImageAltTextModal.vue":"3Nur","./editing/EditLinkModal":"9s3S","./editing/EditLinkModal.vue":"9s3S","./editing/Emojis":"78qK","./editing/Emojis.vue":"78qK","./editing/PositionedActionDropdown":"sjpv","./editing/PositionedActionDropdown.vue":"sjpv","./marks/Link":"YByl","./marks/Link.vue":"YByl","./nodes/Attachment":"p2bi","./nodes/Attachment.vue":"p2bi","./nodes/Attachments":"dlhR","./nodes/Attachments.vue":"dlhR","./nodes/AudioBlock":"JUJ1","./nodes/AudioBlock.vue":"JUJ1","./nodes/BaseNode":"HdaA","./nodes/BaseNode.vue":"HdaA","./nodes/Emoji":"fReT","./nodes/Emoji.vue":"fReT","./nodes/Hashtag":"euDZ","./nodes/Hashtag.vue":"euDZ","./nodes/ImageBlock":"C9aM","./nodes/ImageBlock.vue":"C9aM","./nodes/LinkBlock":"xYuG","./nodes/LinkBlock.vue":"xYuG","./nodes/LinkMedia":"GMmN","./nodes/LinkMedia.vue":"GMmN","./nodes/Mention":"bEBJ","./nodes/Mention.vue":"bEBJ","./nodes/VideoBlock":"ln5p","./nodes/VideoBlock.vue":"ln5p","./suggestion/Hashtag":"1k+S","./suggestion/Hashtag.vue":"1k+S","./suggestion/User":"5XLN","./suggestion/User.vue":"5XLN","./toolbar/NodeBar":"1bAF","./toolbar/NodeBar.vue":"1bAF","./toolbar/Toolbar":"hKQV","./toolbar/Toolbar.vue":"hKQV","./toolbar/ToolbarButton":"Fmi9","./toolbar/ToolbarButton.vue":"Fmi9","./upload/FilePicker":"x/Nx","./upload/FilePicker.vue":"x/Nx"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="ISlu"},"JMt+":function(e,t,n){"use strict";n.r(t);var i=n("UpZR"),o=n.n(i),a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_repository_data"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"repository_data"},name:{kind:"Name",value:"editor_weka_repository_data"},arguments:[{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}},{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"item_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]},r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_get_linkmetadata"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_url"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"link"},name:{kind:"Name",value:"core_get_linkmetadata"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videoheight"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videowidth"},arguments:[],directives:[]}]}}]}}]},s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_media_type_of_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]}]}}]}}]};async function l(e){return(await o.a.query({query:r,variables:{url:e}})).data.link}async function d({component:e,area:t,contextId:n,instanceId:i}){const{data:{result:r}}=await o.a.mutate({mutation:a,variables:{component:e,area:t,context_id:n,instance_id:i}});return r}async function c({itemId:e,filename:t}){const{data:{file:{media_type:n,mime_type:i}}}=await o.a.query({query:s,variables:{item_id:e,filename:t}});return{mediaType:n,mimeType:i}}n.d(t,"getLinkMetadata",(function(){return l})),n.d(t,"prepareDraftFileArea",(function(){return d})),n.d(t,"getMediaType",(function(){return c}))},JUJ1:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-audioBlock"},[e.$apollo.loading?e._e():[n("div",{staticClass:"tui-editorWeka-audioBlock__inner"},[n("CoreAudioBlock",{attrs:{filename:e.filename,"item-id":e.itemId,url:e.file.url,"mime-type":e.file.mime_type}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)};i._withStripped=!0;var o=n("00Pk"),a=n.n(o),r=n("tnXT"),s=n.n(r),l=n("hg2Q"),d=n("r4xq"),c=n.n(d),u={components:{CoreAudioBlock:a.a,NodeBar:c.a},extends:s.a,apollo:{file:{query:l.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{}}),computed:{actions(){let e=[];return this.hasAttachmentNode&&e.push({label:this.$str("display_as_attachment","editor_weka"),action:()=>{this.$_toAttachment()}}),e=e.concat([{label:this.$str("remove","moodle"),action:()=>{this.$_removeNode()}}]),this.downloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{window.document.location.href=this.downloadUrl}}),e},itemId(){if(!this.context.getItemId)throw new Error('No function "getItemId" found for extension media');return this.context.getItemId()},filename(){return this.attrs.filename?this.attrs.filename:null},hasAttachmentNode(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},downloadUrl(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_removeNode(){if(this.context.removeNode)return this.context.removeNode(this.getRange)},$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}}},m=n("KHd+"),p=function(e){e.options.__langStrings={moodle:["remove","download"],editor_weka:["display_as_attachment","actions_menu_for"]}},h=Object(m.a)(u,i,[],!1,null,null,null);"function"==typeof p&&p(h),h.options.__hasBlocks={script:!0,template:!0},h.options.__file="client/src/editor_weka/components/nodes/AudioBlock.vue";t.default=h.exports},"Jfd+":function(e,t,n){"use strict";n.r(t),n.d(t,"removeParentNodeOfType",(function(){return s})),n.d(t,"replaceParentNodeOfType",(function(){return l})),n.d(t,"removeSelectedNode",(function(){return d})),n.d(t,"replaceSelectedNode",(function(){return c})),n.d(t,"setTextSelection",(function(){return u})),n.d(t,"safeInsert",(function(){return h})),n.d(t,"setParentNodeMarkup",(function(){return f})),n.d(t,"selectParentNodeOfType",(function(){return _})),n.d(t,"removeNodeBefore",(function(){return g}));var i=n("n31W"),o=n("wd6j"),a=n("/Kfb"),r=n("FtnZ");const s=e=>t=>{const n=Object(a.findParentNodeOfType)(e)(t.selection);return n?Object(r.removeNodeAtPos)(n.pos)(t):t},l=(e,t)=>n=>{Array.isArray(e)||(e=[e]);for(let i=0,o=e.length;i<o;i++){const o=Object(a.findParentNodeOfType)(e[i])(n.selection);if(o){const e=Object(r.replaceNodeAtPos)(o.pos,t)(n);if(e!==n)return e}}return n},d=e=>{if(Object(r.isNodeSelection)(e.selection)){const t=e.selection.$from.pos,n=e.selection.$to.pos;return Object(r.cloneTr)(e.delete(t,n))}return e},c=e=>t=>{if(Object(r.isNodeSelection)(t.selection)){const{$from:n,$to:a}=t.selection;if(e instanceof o.Fragment&&n.parent.canReplace(n.index(),n.indexAfter(),e)||n.parent.canReplaceWith(n.index(),n.indexAfter(),e.type))return Object(r.cloneTr)(t.replaceWith(n.pos,a.pos,e).setSelection(new i.NodeSelection(t.doc.resolve(n.pos))))}return t},u=(e,t=1)=>n=>{const o=i.Selection.findFrom(n.doc.resolve(e),t,!0);return o?n.setSelection(o):n},m=e=>e.type&&e.type.spec.selectable,p=(e,t,n)=>(e=>m(e)&&e.type.isLeaf)(e)?n.setSelection(new i.NodeSelection(n.doc.resolve(t))):u(t)(n),h=(e,t,n)=>i=>{const o="number"==typeof t,{$from:a}=i.selection,s=o?i.doc.resolve(t):Object(r.isNodeSelection)(i.selection)?i.doc.resolve(a.pos+1):a,{parent:d}=s;if(Object(r.isNodeSelection)(i.selection)&&n){if(i!==(i=c(e)(i)))return i}if(Object(r.isEmptyParagraph)(d)){if(i!==(i=l(d.type,e)(i))){const t=m(e)?s.before(s.depth):s.pos;return p(e,t,i)}}if(Object(r.canInsert)(s,e)){i.insert(s.pos,e);const t=o?s.pos:m(e)?i.selection.$anchor.pos-1:i.selection.$anchor.pos;return Object(r.cloneTr)(p(e,t,i))}for(let t=s.depth;t>0;t--){const n=s.after(t),o=i.doc.resolve(n);if(Object(r.canInsert)(o,e))return i.insert(n,e),Object(r.cloneTr)(p(e,n,i))}return i},f=(e,t,n,i)=>o=>{const s=Object(a.findParentNodeOfType)(e)(o.selection);return s?Object(r.cloneTr)(o.setNodeMarkup(s.pos,t,Object.assign({},s.node.attrs,n),i)):o},_=e=>t=>{if(!Object(r.isNodeSelection)(t.selection)){const n=Object(a.findParentNodeOfType)(e)(t.selection);if(n)return Object(r.cloneTr)(t.setSelection(i.NodeSelection.create(t.doc,n.pos)))}return t},g=e=>{const t=Object(a.findPositionOfNodeBefore)(e.selection);return"number"==typeof t?Object(r.removeNodeAtPos)(t)(e):e}},KGcv:function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownItem")},KRvX:function(e,t){e.exports=tui.require("tui/components/buttons/Submit")},MJ7y:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var i=n("JMt+"),o=n("ddKQ"),a=n("V68o");const r=Object.prototype.hasOwnProperty;class s{constructor({component:e,area:t,instanceId:n,contextId:i}){this.repositoryData=null,this.files={},this.contextId=i,this.component=e,this.area=t,this.instanceId=n}getContextId(){return this.contextId}getComponent(){return this.component}getArea(){return this.area}setRepositoryData({item_id:e,repository_id:t,url:n}){this.repositoryData||(this.repositoryData={itemId:e,repositoryId:t,url:n})}async _fetchRepositoryData(){return new Promise(e=>{if(this.repositoryData)return void e("done");const t={component:this.component,area:this.area,contextId:this.contextId,instanceId:this.instanceId};Object(i.prepareDraftFileArea)(t).then(({item_id:t,repository_id:n,url:i})=>{this.setRepositoryData({item_id:t,repository_id:n,url:i}),e("done")})})}getRepositoryData(){return this.repositoryData}addFile({file:e,size:t,url:n}){r.call(this.files,e)||(this.files[e]={file:e,size:t,url:n})}getFile(e){return r.call(this.files,e)?this.files[e]:null}async uploadFile(e,t){await this._fetchRepositoryData();const{itemId:n,repositoryId:i,url:s}=this.repositoryData,l=await Object(o.upload)({file:e,contextId:this.contextId,acceptTypes:t,repositoryId:i,itemId:n,url:s});if(r.call(l,"id")&&r.call(l,"file")){let t=Object.assign({},l);return t.size=e.size,this.addFile(t),t}if(r.call(l,"event")&&"fileexists"===l.event){const{existingfile:{filename:e},newfile:{filename:t,url:n}}=l;if(r.call(this.files,e)){const{size:i}=this.files[e],o={id:this.repositoryData.itemId,url:n,file:t,size:i};return this.addFile(o),o}}let d=Object(a.langString)("invalid_response","editor_weka");throw await Object(a.loadLangStrings)([d]),new Error(d.toString())}async uploadFiles(e,t){return t=Array.prototype.slice.call(t),e=Object(o.parseFiles)(e),new Promise((n,i)=>{0!==e.length?Promise.all(e.map(e=>this.uploadFile(e,t))).then(e=>{n(e)}).catch(e=>{i(e)}):n([])})}}},MbZ7:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("FGzX"),a=n("nFyd"),r=n.n(a);class s extends i.default{nodes(){return{hashtag:{schema:{group:"inline",inline:!0,attrs:{text:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-node__hashtag",getAttrs(e){try{return{text:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:e=>["span",{class:"tui-editorWeka-node__hashtag"},"#"+e.attrs.text]},component:r.a}}}plugins(){return[Object(o.default)(this.editor)]}}t.default=e=>new s(e)},Mnur:function(e,t){e.exports=tui.require("tui/components/modal/ModalPresenter")},Nfo2:function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkBlock")},O2zc:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("V68o"),a=n("fvDX"),r=n("WI/B"),s=n("qSeW"),l=n("AApu");const d=["ol",0],c=["ul",0],u=["li",0];class m extends i.default{nodes(){return{bullet_list:{schema:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>c}},ordered_list:{schema:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?d:["ol",{start:e.attrs.order},0]}},list_item:{schema:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>u,defining:!0,draggable:!1}}}}toolbarItems(){const{bullet_list:e,ordered_list:t,list_item:n}=this.getSchema().nodes,i=[e,t];return[Object(a.cmdItem)(Object(r.toggleList)(e,n,i),{group:"node",label:Object(o.langString)("bulletlist","editor"),icon:"editor_weka|bulletlist",active:t=>Object(r.isListActive)(t.state,e)}),Object(a.cmdItem)(Object(r.toggleList)(t,n,i),{group:"node",label:Object(o.langString)("numberedlist","editor"),icon:"editor_weka|numberedlist",active:e=>Object(r.isListActive)(e.state,t)})]}keymap(e){const{bullet_list:t,ordered_list:n,list_item:i}=this.getSchema().nodes,o=[t,n];e("Shift-Ctrl-8",Object(r.toggleList)(t,i,o)),e("Shift-Ctrl-9",Object(r.toggleList)(n,i,o)),e("Enter",Object(s.splitListItem)(i)),e("Shift-Tab",Object(s.liftListItem)(i)),e("Tab",Object(s.sinkListItem)(i))}inputRules(){const{bullet_list:e,ordered_list:t}=this.getSchema().nodes;return[(n=e,Object(l.wrappingInputRule)(/^\s*([-+*])\s$/,n)),p(t)];var n}}function p(e){return Object(l.wrappingInputRule)(/^(\d+)\.\s$/,e,e=>({order:+e[1]}),(e,t)=>t.childCount+t.attrs.order==+e[1])}t.default=e=>new m(e)},OQYi:function(e,t){e.exports=tui.require("tui/prosemirror/history")},OWva:function(e,t){e.exports=tui.require("editor_weka/components/editing/PositionedActionDropdown")},OxlY:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditLinkModal")},QCX9:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Emoji")},RNtj:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNode")},SFqO:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("V68o"),a=n("fvDX"),r=n("FtgP"),s=n("AApu");const l=["blockquote",0],d=["em",0],c=["strong",0],u=["h4","h5"];class m extends i.default{nodes(){return{blockquote:{schema:{group:"block",content:"block+",parseDOM:[{tag:"blockquote"}],toDOM:()=>l}},heading:{schema:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>["h"+e.attrs.level,0]},view(e){const t=Math.max(e.attrs.level,1)-1,n=u[t]||u[u.length-1],i=document.createElement(n);return{dom:i,contentDOM:i}}},hard_break:{schema:{group:"inline",parseDOM:[{tag:"br"}],toDOM:()=>["br"],inline:!0,selectable:!1}}}}marks(){return{em:{schema:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>d}},strong:{schema:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>c}}}}toolbarItems(){const e=this.getSchema().nodes.paragraph,t=this.getSchema().nodes.heading,n=this.getSchema().marks.strong,i=this.getSchema().marks.em;return[Object(a.blockTypeItem)(e,{},{group:"blocks",label:Object(o.langString)("paragraph","editor")}),Object(a.blockTypeItem)(t,{attrs:{level:1}},{group:"blocks",label:Object(o.langString)("heading","editor")}),Object(a.blockTypeItem)(t,{attrs:{level:2}},{group:"blocks",label:Object(o.langString)("subheading","editor")}),Object(a.markItem)(n,{group:"marks",label:Object(o.langString)("bold","editor"),icon:"editor_weka|bold"}),Object(a.markItem)(i,{group:"marks",label:Object(o.langString)("italic","editor"),icon:"editor_weka|italic"})]}keymap(e,{isMac:t}){const{paragraph:n,blockquote:i,heading:o,hard_break:a}=this.getSchema().nodes,{strong:s,em:l}=this.getSchema().marks;e("Shift-Ctrl-0",Object(r.setBlockType)(n)),e("Ctrl->",Object(r.wrapIn)(i));for(let t=1;t<=6;t++)e("Shift-Ctrl-"+t,Object(r.setBlockType)(o,{level:t}));const d=(e,t)=>(t(e.tr.replaceSelectionWith(a.create()).scrollIntoView()),!0);e("Mod-Enter",d),e("Shift-Enter",d),t&&e("Ctrl-Enter",d),e("Mod-b",Object(r.toggleMark)(s)),e("Mod-B",Object(r.toggleMark)(s)),e("Mod-i",Object(r.toggleMark)(l)),e("Mod-I",Object(r.toggleMark)(l))}inputRules(){const{blockquote:e,heading:t}=this.getSchema().nodes;return[s.ellipsis,(n=e,Object(s.wrappingInputRule)(/^\s*>\s$/,n)),p(t,6)];var n}}function p(e,t){return Object(s.textblockTypeInputRule)(new RegExp("^(#{1,"+t+"})\\s$"),e,e=>({level:e[1].length}))}t.default=e=>new m(e)},"T7/7":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var i=n("n31W"),o=n("rR9N"),a=n("a2/6"),r=n("OQYi"),s=n("FtgP"),l=n("o7S+"),d=n("c+sf"),c=n("AApu"),u=n("5yv7"),m=n("wbdD"),p=n("lELM"),h=(n("zLSG"),n("x4h3")),f=n("DgbO"),_=n("TXEh"),g=n("vyVp"),v=n("V68o");class k{constructor(e){this.uid=Object(_.uniqueId)(),this._options=e,this._parent=e.parent,this.viewExtrasEl=e.viewExtrasEl,this.viewExtrasLiveEl=e.viewExtrasLiveEl,this._extensions=e.extensions||[],this.fileStorage=e.fileStorage,this._extensions.forEach(e=>e.setEditor(this));const t={};this._nodeViews={};const n={};this._markViews={},this._allVueComponents=[],this._extensions.forEach(e=>{this._extractExtensionSchema(e,"node","nodes",t,this._nodeViews),this._extractExtensionSchema(e,"mark","marks",n,this._nodeViews)}),this.schema=Object(m.createSchema)({nodes:t,marks:n}),this._plugins=[Object(h.default)(e.placeholder)],this._extensions.forEach(e=>{const t=e.plugins();t&&t.forEach(e=>this._plugins.push(e))}),this._toolbarItemInstances=this._extensions.reduce((e,t)=>t.toolbarItems?e.concat(t.toolbarItems()):e,[]),this._toolbarItems=this._toolbarItemInstances.map(e=>e.getDef()),this._mapKeys=this._extensions.map(e=>e.keymap&&e.keymap.bind(e)).filter(Boolean),this._inputRules=this._extensions.reduce((e,t)=>t.inputRules?e.concat(t.inputRules()):e,[]),this.dispatch=this.dispatch.bind(this),this.execute=this.execute.bind(this),this.getFileStorageItemId=this.getFileStorageItemId.bind(this),this.setValue(e.value)}_extractExtensionSchema(e,t,n,i,o){const a=e[n]&&e[n]();if(a)for(const e in a){const n=a[e];i[e]&&console.warn(`[editor_weka] ${t} "${e}" was redefined`),i[e]=n.schema,n.component&&(this._allVueComponents.push(n.component),o[e]=this._componentNodeView.bind(this,n.component,n.componentContext)),n.view&&(o[e]=n.view)}}setValue(e){if(!e.inflated(this)){const t=i.EditorState.fromJSON(this._editorConfig(),{doc:e.getDoc(),selection:{anchor:0,head:0,type:"text"}});e.inflate(this,t)}this._value=e,this.state=e.getState(this),this.view&&this.view.updateState(this.state)}_editorConfig(){return{schema:this.schema,plugins:this._createPlugins()}}createView(e){return this.view=new o.EditorView(e,{state:this.state,dispatchTransaction:this.dispatch,nodeViews:this._nodeViews,attributes:{class:"tui-weka-editor"}}),this.view}allVueComponents(){return this._allVueComponents}allStrings(){return this._toolbarItems.filter(e=>e.label).map(e=>e.label)}getParent(){return this._parent}_componentNodeView(e,t,n,i,o){return new p.default(e,{editor:this,node:n,view:i,getPos:o,parent:this._parent,context:t})}dispatch(e){const t=this.state.apply(e);this.view.updateState(t),this.state=t,this._value=f.default.fromState(t,this),this._options.onTransaction&&this._options.onTransaction({value:this._value,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this._options.onUpdate&&this._options.onUpdate(this._value)}getFileStorageItemId(){let e=this.fileStorage.getRepositoryData();return e?e.itemId:null}_createPlugins(){let e=[];return Array.isArray(this._plugins)&&(e=this._plugins),e.concat(Object(c.inputRules)({rules:this._inputRules}),Object(a.keymap)(Object(u.buildKeymap)(this.schema,this._mapKeys)),Object(a.keymap)(s.baseKeymap),Object(l.dropCursor)(),Object(d.gapCursor)(),Object(r.history)())}getToolbarItems(){return this._toolbarItemInstances.forEach(e=>e.update(this)),this._toolbarItems}execute(e){try{return e(this.state,this.dispatch,this.view)}catch(e){console.error("[Weka] Failed to execute command."),console.error(e);const t=Object(v.langString)("error_failed_to_execute","editor_weka");return Object(v.loadLangStrings)([t]).then(()=>Object(g.notify)({type:"error",message:t.toString()})),!1}}canExecute(e){return e(this.state,null,null)}hasNode(e){return e in this.state.schema.nodes}destroy(){this.view&&this.view.destroy()}}},"T72/":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-videoAttachment"},[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)};i._withStripped=!0;var o=n("RNtj"),a=n.n(o),r=n("r4xq"),s=n.n(r),l=n("zK61"),d=n.n(l),c={components:{NodeBar:s.a,AttachmentNode:a.a},mixins:[d.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions(){let e=[];return this.enableConvert&&e.push({label:this.$str("display_as_embedded_media","editor_weka"),action:()=>{this.$emit("convert-to-embedded-media")}}),e=e.concat([{label:this.$str("remove","moodle"),action:()=>{this.$emit("delete")}}]),this.hasDownloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{this.$emit("download")}}),e}}},u=n("KHd+"),m=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],moodle:["remove","download"]}},p=Object(u.a)(c,i,[],!1,null,null,null);"function"==typeof m&&m(p),p.options.__hasBlocks={script:!0,template:!0},p.options.__file="client/src/editor_weka/components/attachments/VideoAttachment.vue";t.default=p.exports},"TGM/":function(e,t){e.exports=tui.require("tui/pending")},TXEh:function(e,t){e.exports=tui.require("tui/util")},UpZR:function(e,t){e.exports=tui.require("tui/apollo_client")},V68o:function(e,t){e.exports=tui.require("tui/i18n")},VUoS:function(e,t,n){"use strict";function i(){return{type:"doc",content:[{type:"paragraph"}]}}n.r(t),n.d(t,"getDefaultDocument",(function(){return i}))},"WI/B":function(e,t,n){"use strict";n.r(t),n.d(t,"toggleList",(function(){return a})),n.d(t,"isListActive",(function(){return r}));var i=n("qSeW"),o=n("/Kfb");n("wd6j"),n("n31W");function a(e,t,n){const a=Object(i.liftListItem)(t),r=Object(i.wrapInList)(e);return(t,i,s)=>{const{selection:l}=t,d=l.$from.blockRange(l.$to);if(!d)return!1;const c=function(e,t){return Object(o.findParentNode)(e=>t.includes(e.type))(e)}(l,n),u=c&&d.depth-c.depth<=1;if(d.depth>=1&&u){if(c.node.type===e)return a(t,i,s);if(e.validContent(c.node.content))return i&&i(t.tr.setNodeMarkup(c.pos,e)),!0}return r(t,i,s)}}function r(e,t){const{selection:n}=e,i=n.$from.blockRange(n.$to);if(!i)return!1;const a=Object(o.findParentNode)(e=>e.type==t)(n);return i.depth>=1&&a&&i.depth-a.depth<=1}},Wdod:function(e,t){e.exports=tui.require("editor_weka/components/upload/FilePicker")},X7tx:function(e,t,n){"use strict";function i(e,t){const n=s(e);if(!n.node)return!1;const i=n.node.marks.find(e=>e.type===t);if(!i)return!1;let o=e.index(),a=e.start()+n.offset,r=a+n.node.nodeSize;return{from:l(e.parent,i,o,a,-1),to:l(e.parent,i,o,r,1)}}function o(e){if(e&&e.$from.parent!=e.$from.doc&&e.$from.sameParent(e.$to)&&0===e.$from.parentOffset&&e.$to.parentOffset===e.$to.parent.nodeSize-2){const t=e.$from.doc;return new r(t.resolve(e.$from.pos-1),t.resolve(e.$to.pos+1))}return e}function a(e,t){return s(e).node.marks.find(e=>e.type===t)}n.r(t),n.d(t,"default",(function(){return i})),n.d(t,"expandContentResolvedRange",(function(){return o})),n.d(t,"getMark",(function(){return a})),n.d(t,"ResolvedRange",(function(){return r}));class r{constructor(e,t){this.$from=e,this.$to=t}static resolve(e,t){return new r(e.resolve(t.from),e.resolve(t.to))}}function s(e){return e.parent.childAfter(e.parentOffset)}function l(e,t,n,i,o){const a=e.childCount-1;for(;!((n+=o)<0||n>a);){const a=e.child(n);if(!t.isInSet(a.marks))break;i+=e.child(n).nodeSize*o}return i}},Y4vP:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Mention")},YByl:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"tui-editorWeka-link"},[n("a",{ref:"content",attrs:{href:e.attrs.href,title:e.attrs.title},on:{click:e.showDropdown}}),e._v(" "),n("ButtonIcon",{staticClass:"tui-editorWeka-link__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":e.dropdownShown.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.textContent)},on:{click:e.showDropdown}},[n("More")],1)],1)};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("5h9J"),s=n.n(r),l=n("hCGN"),d=n.n(l),c=n("TGM/"),u=n.n(c),m={components:{ButtonIcon:s.a,More:d.a},extends:a.a,props:{ariaLabel:String},data:()=>({textContent:"",dropdownShown:!1}),mounted(){this.observer=new MutationObserver(this.$_updateTextContent),this.observer.observe(this.$refs.content,{childList:!0,subtree:!0,characterData:!0}),this.$_updateTextContent()},beforeDestroy(){this.observer.disconnect()},methods:{showDropdown(){this.context.showMarkDropdown(this.getRange).then(e=>{this.dropdownShown=!0,e.$on("dismiss",()=>this.dropdownShown=!1)})},$_updateTextContent(){const e=u()();setTimeout(()=>{e(),this.textContent=this.$refs.content.textContent},0)}}},p=n("KHd+"),h=function(e){e.options.__langStrings={editor_weka:["actions_menu_for"]}},f=Object(p.a)(m,i,[],!1,null,null,null);"function"==typeof h&&h(f),f.options.__hasBlocks={script:!0,template:!0},f.options.__file="client/src/editor_weka/components/marks/Link.vue";t.default=f.exports},YOQe:function(e,t,n){var i={"./fixtures/WekaBasic":"8gR2","./fixtures/WekaBasic.vue":"8gR2","./fixtures/WekaWithLearn":"t+A+","./fixtures/WekaWithLearn.vue":"t+A+"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id="YOQe"},Z8if:function(e,t,n){"use strict";n.r(t);var i=n("Y4vP"),o=n.n(i),a=n("oBkI"),r=n("BDOe");class s extends a.default{nodes(){return{mention:{schema:{group:"inline",inline:!0,attrs:{type:{default:void 0},id:{default:void 0},display:{default:""}},parseDOM:[{tag:"span.tui-editorWeka-mention",getAttrs(e){try{return{type:JSON.parse(e.getAttribute("data-type")),id:JSON.parse(e.getAttribute("data-id")),display:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:e=>["span",{class:"tui-editorWeka-mention","data-type":JSON.stringify(e.attrs.type),"data-id":JSON.stringify(e.attrs.id)},"@"+e.attrs.display]},component:o.a}}}plugins(){return[Object(r.default)(this.editor)]}}t.default=e=>new s(e)},"a2/6":function(e,t){e.exports=tui.require("tui/prosemirror/keymap")},bEBJ:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"tui-editorWeka-mention"},[t("Mention",{attrs:{"user-id":this.userId,fullname:this.displayName},nativeOn:{click:function(e){e.preventDefault()}}})],1)};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("rqBY"),s={components:{Mention:n.n(r).a},extends:a.a,computed:{displayName(){let e=this.attrs;return e.display?e.display:""},userId(){let e=this.attrs;return e.id?e.id:0}}},l=n("KHd+"),d=Object(l.a)(s,i,[],!1,null,null,null);d.options.__hasBlocks={script:!0,template:!0},d.options.__file="client/src/editor_weka/components/nodes/Mention.vue";t.default=d.exports},bJQT:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNodeCollection")},"c+sf":function(e,t){e.exports=tui.require("tui/prosemirror/gapcursor")},ce8f:function(e,t){e.exports=tui.require("editor_weka/components/editing/ActionDropdown")},cmE2:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-weka no-yui-ids",attrs:{id:e.uid}},[e.showToolbar?n("Toolbar",{attrs:{items:e.toolbarItems}}):e._e(),e._v(" "),n("div",{ref:"editorHost",staticClass:"tui-rendered",attrs:{"data-placeholder":e.placeholder}}),e._v(" "),n("div",{ref:"extras"}),e._v(" "),n("div",{ref:"extrasLive",attrs:{"aria-live":"polite",role:"status"}})],1)};i._withStripped=!0;var o=n("H/tB"),a=n.n(o),r=n("TXEh"),s=n("T7/7"),l=n("z2s3"),d=n.n(l),c=n("V68o"),u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_weka"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"editor"},name:{kind:"Name",value:"editor_weka_editor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"showtoolbar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"extensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tuicomponent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"instance_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"context_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"component"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"area"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_data"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"item_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"files"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}}]},m=n("MJ7y"),p=n("DgbO");const h=e=>(t,n)=>{JSON.stringify(n)!=JSON.stringify(t)&&console.warn(`[Weka] Prop "${e}" has changed from ${JSON.stringify(n)} to `+JSON.stringify(t)+". This change will not be reflected. Instead, create the Weka component instance (change key prop to force a new instance to be created)")},f=e=>void 0!==e.showtoolbar&&void 0!==e.extensions;var _={components:{Toolbar:d.a},props:{placeholder:{type:String,default:""},instanceId:[Number,String],component:String,area:String,doc:Object,options:{type:Object,validator:f},option:{type:Object,validator:f},value:p.default},data:()=>({toolbarItems:[],toolbarEnabled:!1}),computed:{showToolbar(){return!!this.toolbarEnabled&&this.toolbarItems.length>0}},watch:{doc(e){e?this.displayedValue&&this.displayedValue.getDoc()===e||(this.displayedValue=p.default.fromDoc(e),this.editor&&this.editor.setValue(this.displayedValue)):this.value||(this.displayedValue=p.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},value(e){this.displayedValue!==e&&(this.displayedValue=e||p.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},component:h("component"),area:h("area"),instanceId:h("instanceId"),option:h("option")},created(){this.updateToolbarThrottled=Object(r.throttle)(this.updateToolbar,100),this.value?this.displayedValue=this.value:this.doc?this.displayedValue=p.default.fromDoc(this.doc):this.displayedValue=p.default.empty(),this.finalOptions=null},mounted(){this.createEditor()},beforeDestroy(){this.editor&&this.editor.destroy()},methods:{async setupOptions(){this.option&&console.warn('[Weka] Prop "option" is deprecated. Please update your code to pass "options" instead.');const e=this.options||this.option;if(e)return this.finalOptions=Object.assign({},e),void(this.toolbarEnabled=this.finalOptions.showtoolbar);const t=await this.$apollo.query({query:u,fetchPolicy:"no-cache",variables:{instance_id:this.instanceId,component:this.component,area:this.area}});this.finalOptions=Object.assign({},t.data.editor),this.toolbarEnabled=this.finalOptions.showtoolbar},async getExtensions(){await this.setupOptions();let e=[];return Array.isArray(this.finalOptions.extensions)&&(e=await Promise.all(this.finalOptions.extensions.map(({tuicomponent:e,options:t})=>{let n={};return null!=t&&(n=JSON.parse(t)),a.a.import(e).then(e=>e.default(n))}))),e},async getRepositoryData(){return await this.setupOptions(),this.finalOptions.repository_data||null},async getCurrentFiles(){return await this.setupOptions(),this.finalOptions.files||[]},async createEditor(){if(this.editor)return;const e=await this.getExtensions(),t=await this.getRepositoryData();let n=new m.default({component:this.component,area:this.area,instanceId:this.instanceId,contextId:this.finalOptions.context_id||null});null!==t&&n.setRepositoryData(t);let i=await this.getCurrentFiles();Array.prototype.forEach.call(i,({filename:e,url:t,file_size:i})=>{n.addFile({file:e,url:t,size:i})}),this.editor=new s.default({value:this.displayedValue,placeholder:this.placeholder,parent:this,viewExtrasEl:this.$refs.extras,viewExtrasLiveEl:this.$refs.extrasLive,extensions:e,fileStorage:n,onUpdate:this.$_onUpdate.bind(this),onTransaction:()=>{this.updateToolbarThrottled()}});const o=this.editor.allVueComponents();await Promise.all([a.a.loadRequirements({components:o}),Object(c.loadLangStrings)(this.editor.allStrings())]),this.view=this.editor.createView(this.$refs.editorHost),this.updateToolbar(),this.$emit("editor-mounted"),this.$emit("editor-ready")},updateToolbar(){this.toolbarItems=this.editor.getToolbarItems()},$_onUpdate(e){this.displayedValue=e,this.$emit("input",e),this.$listeners.update&&this.$emit("update",{getJSON:()=>e.getDoc(),isEmpty:()=>e.empty,getFileStorageItemId:()=>e.fileStorageItemId})}}},g=n("KHd+"),v=Object(g.a)(_,i,[],!1,null,null,null);v.options.__hasBlocks={script:!0,template:!0},v.options.__file="client/src/editor_weka/components/Weka.vue";t.default=v.exports},ddKQ:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFiles",(function(){return c})),n.d(t,"upload",(function(){return u})),n.d(t,"pickFiles",(function(){return m}));var i=n("12HA"),o=n("TGM/"),a=n.n(o),r=n("Wdod"),s=n.n(r),l=n("i7/w"),d=n.n(l);n("T7/7");function c(e){return Array.isArray(e)?e:Array.prototype.slice.call(e).filter(e=>e instanceof File)}async function u({file:e,repositoryId:t,itemId:n,contextId:o,acceptTypes:a,url:r}){return void 0!==a&&(a=Array.prototype.slice.call(a)),new Promise((s,l)=>{const d=new FormData,c=new XMLHttpRequest;d.append("repo_upload_file",e),d.append("title",e.name),d.append("sesskey",i.globalConfig.sesskey),d.append("repo_id",String(t)),d.append("itemid",String(n)),d.append("ctx_id",String(o)),0!==a.length&&a.forEach(e=>{d.append("accepted_types[]",e)}),c.addEventListener("readystatechange",()=>{if(4===c.readyState){if(200===c.status){let e=JSON.parse(c.responseText);if(e)return e.error?void l({message:e.error}):void s(e)}l({message:"Response is not a 200 response"})}}),c.open("POST",r,!0),c.send(d)})}async function m(e){const t=new(d.a.extend(s.a))({parent:e.getParent(),propsData:{autoTrigger:!0}}),n=a()("weka-file-picker");return setTimeout(()=>{n();const i=document.createElement("span");e.viewExtrasEl.appendChild(i),t.$mount(i)},0),new Promise(n=>{t.$on("picked-files",e=>{n(e)}),t.$on("dismiss",()=>{t.$destroy(),e.viewExtrasEl.removeChild(t.$el)})})}},dlhR:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("AttachmentNodeCollection",{staticClass:"tui-editorWeka-attachments"},[t("div",{ref:"content",staticClass:"tui-editorWeka-attachments__content"})])};i._withStripped=!0;var o=n("bJQT"),a={components:{AttachmentNodeCollection:n.n(o).a}},r=n("KHd+"),s=Object(r.a)(a,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/nodes/Attachments.vue";t.default=s.exports},e9dp:function(e,t,n){"use strict";n.r(t),n.d(t,"setupTexteditor",(function(){return l}));var i=n("H/tB"),o=n.n(i),a=n("TXEh"),r=n("2wx7"),s=n.n(r);function l({id:e,extensions:t,showtoolbar:n}){const i=document.getElementById(e);new d(e,i,{extensions:t,showtoolbar:n})}class d{constructor(e,t,n){this.id=e,this.textareaEl=t,t.style.display="none",this.wrapper=document.createElement("div");const i=document.createElement("div");this.wrapper.appendChild(i),this.textareaEl.parentNode.insertBefore(this.wrapper,this.textareaEl.nextSibling);let r,l=this.getDoc();const d=Object(a.debounce)(()=>{this.textareaEl.value=JSON.stringify(r.getJSON())},250);o.a.mount(s.a,{props:{doc:l,option:n},on:{update:e=>{r=e,d()}}},i)}getDoc(){let e={type:"doc",content:[{type:"paragraph"}]},t=this.textareaEl.value;if(t)try{e=JSON.parse(t)}catch(e){console.error("[editor_weka] Error parsing JSON"),console.error(e)}return e}}},eoJc:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("iag4"),a=n("Nfo2"),r=n.n(a),s=n("9cw/"),l=n.n(s),d=n("9Wm2"),c=n.n(d),u=n("OxlY"),m=n.n(u),p=n("n31W"),h=n("wd6j"),f=n("V68o"),_=n("fvDX"),g=n("JMt+"),v=n("zLSG"),k=n("X7tx"),b=n("TXEh"),y=n("vyVp");const w=/\bhttps?:\/\/[-a-zA-Z0-9@:%._+~#=]+\b(?:[-a-zA-Z0-9@:%_+.~#?&//=]*)/g,x=["link_block","link_media"];class N extends i.default{constructor(e){super(e),this.isMedia=this.isMedia.bind(this),this._convertPastedUrl=this._convertPastedUrl.bind(this),this._getSelectionRange=this._getSelectionRange.bind(this)}nodes(){return{link_media:{schema:{group:"block",atom:!0,attrs:{url:{},loading:{default:void 0},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0},resolution:{default:void 0}},parseDOM:[{tag:".tui-editorWeka-linkMedia",getAttrs:o.getJsonAttrs}],toDOM:e=>["a",{class:"tui-editorWeka-linkMedia","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]},component:l.a,componentContext:{urlPlugin:this.urlPlugin.bind(this),editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}},link_block:{schema:{group:"block",atom:!0,attrs:{url:{},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0}},parseDOM:[{tag:".tui-editorWeka-linkBlock",getAttrs:o.getJsonAttrs}],toDOM:e=>["a",{class:"tui-editorWeka-linkBlock","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]},component:r.a,componentContext:{editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}}}}marks(){return{link:{schema:{attrs:{href:{},title:{default:void 0}},inclusive:!1,parseDOM:[{tag:"a[href]:not([class*=tui-editorWeka])",getAttrs:Object(o.attrGetter)(["href","title"])}],toDOM(e){let{href:t,title:n}=e.attrs;return["a",{href:t,title:n},0]}},component:c.a,componentContext:{showMarkDropdown:this.showMarkDropdown.bind(this)}}}}plugins(){return[new p.Plugin({props:{transformPasted:e=>new h.Slice(function e(t,n){const i=[];return t.forEach((function(t){if(t.isText){const e=t.text;let o,a=0;for(w.lastIndex=0;o=w.exec(e);){const r=o.index,s=r+o[0].length;r>0&&i.push(t.cut(a,r));const l=e.slice(r,s),d=n.convert(l);d instanceof h.Node?t.canReplace(r,s,h.Fragment.from(d))?i.push(d):i.push(t.cut(r,s)):d instanceof h.Mark?i.push(t.cut(r,s).mark(d.addToSet(t.marks))):i.push(t.cut(r,s)),a=s}a<e.length&&i.push(t.cut(a))}else i.push(t.copy(e(t.content,n)))})),h.Fragment.fromArray(i)}(e.content,{convert:this._convertPastedUrl}),e.openStart,e.openEnd)}})]}toolbarItems(){return[new _.ToolbarItem({group:"embeds",label:Object(f.langString)("insert_link","editor_weka"),icon:"editor_weka|link",execute:e=>{const t=this._getSelectionRange(),n=this.doc.textBetween(t.from,t.to);this.showModal(m.a,{isNew:!0,isMedia:this.isMedia,attrs:{url:"",text:n},save:async t=>{const n=await this._prepareLinkUpdate(t);this._updateLink({type:null,getRange:this._getSelectionRange},n),e.view.focus()}})}})]}replaceWithTextLink(e,{url:t}){this.editor.execute((n,i)=>{const o=n.schema.text(t,[n.schema.mark("link",{href:t})]),a=e();i(n.tr.replaceWith(a.from,a.to,o))})}urlPlugin(e){return this._findLinkPlugin(e)}isMedia(e){return!!this._findLinkPlugin({type:"media",url:e})}editCard(e){const t=this.doc.nodeAt(e().from),n=t.type.name;x.includes(n)&&this.showModal(m.a,{isMedia:this.isMedia,attrs:{type:n,url:t.attrs.url},save:async t=>{const i=await this._prepareLinkUpdate(t);this._updateLink({type:n,getRange:e},i),this.editor.view.focus()}})}showMarkDropdown(e){const t=this._getLinkMark(e);if(!t)return;const n=t&&this.isMedia(t.attrs.href);return this.showActionDropdown(e().from,{actions:[{label:Object(f.langString)("go_to_link","editor_weka"),action:()=>this._openLinkMarkAt(e)},{label:Object(f.langString)("edit","moodle"),action:()=>this._editMarkAt(e)},{label:n?Object(f.langString)("display_as_embedded_media","editor_weka"):Object(f.langString)("display_as_card","editor_weka"),action:()=>this._markToCardAt(n?"link_media":"link_block",e)},{label:Object(f.langString)("remove","moodle"),action:()=>this._removeMarkAt(e)}]})}_findLinkPlugin({type:e,url:t}){for(let n=0;n<O.length;n++){const i=O[n];if(!e||i.type===e)for(let e=0;e<i.matches.length;e++){const n=i.matches[e],o=n.match.exec(t);if(o)return{plugin:i,details:n.details?n.details(o):{}}}}return null}_updateLink(e,t){e||(e={type:null,getRange:this._getSelectionRange});let n=null;if("link"===e.type||null===e.type){const t=e.getRange();n=this.doc.textBetween(t.from,t.to)}this.editor.execute((i,o)=>{const a=Object(k.expandContentResolvedRange)(k.ResolvedRange.resolve(this.doc,e.getRange()));if("link"==t.type){const r=i.schema.marks.link,s=t.text||t.url,l=r.create({href:t.url});let d;d="link"==e.type&&n&&s===n?i.tr.removeMark(a.$from.pos,a.$to.pos,r).addMark(a.$from.pos,a.$to.pos,l):i.tr.replaceWith(a.$from.pos,a.$to.pos,s?i.schema.text(s,[l]):h.Fragment.empty),o(d)}else x.includes(t.type)&&o(i.tr.replaceWith(a.$from.pos,a.$to.pos,t.content))})}async _prepareLinkUpdate(e){const{type:t,url:n,text:i}=e;if(x.includes(t)){const e=this.editor.state.schema,i=(!t||"link_media"==t)&&this._findLinkPlugin({type:"media",url:n});if(i){let o;if(i.plugin.nodeAttrs)try{o=await i.plugin.nodeAttrs({url:n})}catch(e){o={},console.error(e)}return new S({type:t,url:n,content:e.node("link_media",Object.assign({url:n},o))})}{let i;try{i=function(e){if(null===e)return null;return I(Object(b.pick)(e,["url","image","title","description"]))}(await Object(g.getLinkMetadata)(n))}catch(e){console.error(e),i={}}return new S({type:t,url:n,content:e.node("link_block",Object.assign({url:n},i))})}}return new S({type:"link",url:n,text:i})}_convertPastedUrl(e){const t=this.getSchema().marks.link,n=this.getSchema().nodes.link_media,i=this._findLinkPlugin({type:"media",url:e});if(i){const t={url:e};i.plugin.nodeAttrs&&(t.loading=!0);const o=n.create(t);return t.loading&&i.plugin.nodeAttrs({url:e}).then(t=>{this._updatePastedMedia(e,t)}).catch(t=>{console.error(t),this._updatePastedMedia(e,{})}),o}return t.create({href:e})}_updatePastedMedia(e,t){const n=this.getSchema().nodes.link_media;let i=this.editor.state.tr;this.editor.state.doc.descendants((o,a)=>{if(o.type==n&&o.attrs.loading&&o.attrs.url===e){const e=Object.assign({},o.attrs,{loading:!1},t);i=Object(v.setAttrs)(a,e)(i)}}),i.setMeta("addToHistory",!1),this.editor.dispatch(i)}_getSelectionRange(){return Object(b.pick)(this.editor.state.selection,["from","to"])}_getLinkMark(e){return Object(k.getMark)(this.doc.resolve(e().from),this.getSchema().marks.link)}_openLinkMarkAt(e){const t=this._getLinkMark(e);t&&window.open(t.attrs.href)}_editMarkAt(e){const t=e(),n=this._getLinkMark(e);if(!n)return;const i=n.attrs.href;let o=this.doc.textBetween(t.from,t.to);i===o&&(o=null),this.showModal(m.a,{isMedia:this.isMedia,attrs:{url:i,text:o},save:async t=>{const n=await this._prepareLinkUpdate(t);this._updateLink({type:"link",getRange:e},n),this.editor.view.focus()}})}async _markToCardAt(e,t){const n=this._getLinkMark(t);if(!n)return;let i;try{i=await this._prepareLinkUpdate({type:e,url:n.attrs.href})}catch(e){return void async function(){const e=Object(f.langString)("error_no_url_info","editor_weka");await Object(f.loadLangStrings)([e]),Object(y.notify)({type:"error",message:e.toString()})}()}this._updateLink({type:"link",getRange:t},i),this.editor.view.focus()}_removeMarkAt(e){this.editor.execute((t,n)=>{const i=Object(k.expandContentResolvedRange)(k.ResolvedRange.resolve(this.doc,e()));n(t.tr.delete(i.$from.pos,i.$to.pos))}),this.editor.view.focus()}}class S{constructor(e){Object.assign(this,e)}}const O=[{key:"youtube",type:"media",name:"YouTube",matches:[{match:/^https?:\/\/(?:www\.)?youtube.com\/watch\?v=([a-zA-Z0-9_-]+)/,details:e=>({id:e[1]})},{match:/^https?:\/\/(?:www\.)?youtu.be\/([a-zA-Z0-9_-]+)/,details:e=>({id:e[1]})}],nodeAttrs:async({url:e})=>j(await Object(g.getLinkMetadata)(e))},{key:"vimeo",type:"media",name:"Vimeo",matches:[{match:/^https?:\/\/(?:www\.)?vimeo.com\/([0-9]+)/,details:e=>({id:e[1]})}],nodeAttrs:async({url:e})=>j(await Object(g.getLinkMetadata)(e))},{key:"image",type:"media",name:"Image",matches:[{match:/\.(png|jpe?g|gif|webp|avif)$/}]},{key:"audio",type:"media",name:"Audio",matches:[{match:/\.(aac|flac|m4a|mp3|ogg|opus|wav|wma)$/}]}];const I=e=>{const t={};for(const n in e)null!=e[n]&&(t[n]=e[n]);return t};function j(e){if(null===e)return null;const t=I(Object(b.pick)(e,["url","image","title","description"])),n=Number(e.videowidth),i=Number(e.videoheight);return t.resolution=isNaN(n)||isNaN(i)?void 0:{width:n,height:i},t}t.default=e=>new N(e)},euDZ:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement;return(this._self._c||e)("Hashtag",{attrs:{url:this.url,text:this.$str("hashtag","editor_weka",this.text)},nativeOn:{click:function(e){e.preventDefault()}}})};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("mD75"),s={components:{Hashtag:n.n(r).a},extends:a.a,computed:{text(){return this.attrs.text},url(){return this.$url("/totara/catalog/index.php",{catalog_fts:this.attrs.text})}}},l=n("KHd+"),d=function(e){e.options.__langStrings={editor_weka:["hashtag"]}},c=Object(l.a)(s,i,[],!1,null,null,null);"function"==typeof d&&d(c),c.options.__hasBlocks={script:!0,template:!0},c.options.__file="client/src/editor_weka/components/nodes/Hashtag.vue";t.default=c.exports},f56J:function(e,t,n){"use strict";n.r(t),n.d(t,"pluginKey",(function(){return a})),n.d(t,"attachment",(function(){return r}));var i=n("n31W");const o=Object.prototype.hasOwnProperty,a=new i.PluginKey("attachment");function r(e){const{onDrop:t,onKeyDown:n}=function(e){let t={};return["onDrop","onKeyDown"].forEach(n=>{o.call(e,n)&&"function"==typeof e[n]?t[n]=e[n]:t[n]=()=>!1}),t}(e);return new i.Plugin({key:a,state:{init:()=>({}),apply:()=>({})},props:{handleDOMEvents:{drop:(e,n)=>t({view:e,event:n})},handleKeyDown:(e,t)=>n({view:e,event:t})}})}},fReT:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement;return(this._self._c||e)("Emoji",{staticClass:"tui-editorWeka-emoji",attrs:{"short-code":this.shortCode}})};i._withStripped=!0;var o=n("QCX9"),a=n.n(o),r=n("tnXT"),s=n.n(r),l={components:{Emoji:a.a},extends:s.a,computed:{shortCode(){if(this.attrs.shortcode)return this.attrs.shortcode}}},d=n("KHd+"),c=Object(d.a)(l,i,[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0},c.options.__file="client/src/editor_weka/components/nodes/Emoji.vue";t.default=c.exports},fRht:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Emoji")},fvDX:function(e,t,n){"use strict";n.r(t),n.d(t,"ToolbarItem",(function(){return o})),n.d(t,"cmdItem",(function(){return a})),n.d(t,"markItem",(function(){return r})),n.d(t,"blockTypeItem",(function(){return s}));var i=n("FtgP");class o{constructor(e){this._opts=e,this._editor=null,this._def={group:e.group,label:e.label,icon:e.icon,enabled:!0,active:null,children:e.children&&e.children.map(e=>e.getDef()),popover:e.popover,execute:()=>e.execute(this._editor),reset:()=>e.reset(this._editor)}}update(e){const{_def:t,_opts:n}=this;return this._editor=e,t.enabled=void 0===n.enabled||n.enabled(e),t.active=null!=n.active?n.active(e):null,n.children&&n.children.forEach(t=>t.update(e)),Object.assign({},t)}getDef(){return this._def}}function a(e,t){return new o(Object.assign({enabled:t=>t.canExecute(e),execute:t=>{t.view.focus(),t.execute(e)}},t))}function r(e,t){return t=Object.assign({active:t=>function(e,t){let{from:n,$from:i,to:o,empty:a}=e.selection;return a?!!t.isInSet(e.storedMarks||i.marks()):!!e.doc.rangeHasMark(n,o,t)}(t.state,e)},t),a(Object(i.toggleMark)(e),t)}function s(e,t,n){return n=Object.assign({active(n){let{$from:i,to:o,node:a}=n.state.selection;return a&&a.isTextblock?a.hasMarkup(e,t.attrs):o<=i.end()&&i.parent.hasMarkup(e,t.attrs)}},n),a(Object(i.setBlockType)(e,t.attrs),n)}},gEm7:function(e,t,n){"use strict";n.r(t),n.d(t,"IMAGE",(function(){return i})),n.d(t,"VIDEO",(function(){return o})),n.d(t,"AUDIO",(function(){return a}));const i="IMAGE",o="VIDEO",a="AUDIO"},gLvT:function(e,t){e.exports=tui.require("tui/components/dropdown/Dropdown")},hCGN:function(e,t){e.exports=tui.require("tui/components/icons/common/More")},hKQV:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-toolbar",attrs:{role:"toolbar","aria-label":e.$str("label_toolbar","weka_editor")}},[n("div",{staticClass:"tui-editorWeka-toolbar__group"},[n("Dropdown",{attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("ButtonIcon",{staticClass:"tui-editorWeka-toolbar__currentBlock tui-editorWeka-toolbar__button",attrs:{styleclass:{toolbar:!0,textFirst:!0},text:e.activeBlockName,"aria-expanded":o?"true":"false","aria-label":e.$str("format_as_blocktype_status","editor_weka",e.activeBlockName),disabled:!e.blockSelectorEnabled},on:{click:function(e){return i()}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("FlexIcon",{attrs:{icon:"caret-down",size:"100"}})],1)]}}])},[e._v(" "),e._l(e.blockItems,(function(t,i){return n("DropdownItem",{key:i,attrs:{selected:t.active,disabled:!t.active&&!t.enabled,small:!0},on:{click:function(n){return e.itemClick(t)}}},[e._v("\n        "+e._s(t.label.toString())+"\n      ")])}))],2)],1),e._v(" "),e._l(e.itemGroups,(function(t,i){return n("div",{key:i,staticClass:"tui-editorWeka-toolbar__group"},[e._l(t,(function(t,i){return[t.children?n("Dropdown",{key:i,attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(i){var o=i.toggle;return[n("ToolbarButton",{staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),active:t.active,disabled:!t.enabled},on:{click:o},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}}],null,!0)},[e._v(" "),e._l(t.children,(function(t,i){return n("DropdownItem",{key:i,attrs:{disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[n("FlexIcon",{attrs:{icon:t.icon}}),e._v("\n          "+e._s(t.label.toString())+"\n        ")],1)}))],2):t.popover?n("Popover",{key:i,attrs:{triggers:["click"],title:t.popover.title},on:{"open-changed":function(n){for(var i=arguments.length,o=Array(i);i--;)o[i]=arguments[i];return e.openChanged.apply(void 0,[t].concat(o))}},scopedSlots:e._u([{key:"trigger",fn:function(i){var o=i.isOpen;return[n("ToolbarButton",{staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled,"aria-haspopup":"true","aria-expanded":o?"true":"false"},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}},{key:"default",fn:function(e){var i=e.close;return[n(t.popover.component,{tag:"component",on:{close:i}})]}}],null,!0)}):n("ToolbarButton",{key:i,staticClass:"tui-editorWeka-toolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n("FlexIcon",{attrs:{icon:t.icon}})],1)],2)]}))],2)}))],2)};i._withStripped=!0;var o=n("TXEh"),a=n("36rR"),r=n("gLvT"),s=n.n(r),l=n("KGcv"),d=n.n(l),c=n("lBzj"),u=n.n(c),m=n("5h9J"),p=n.n(m),h=n("9Ovj"),f=n.n(h),_=n("9G+f"),g=n.n(_),v={components:{Dropdown:s.a,DropdownItem:d.a,FlexIcon:u.a,ButtonIcon:p.a,ToolbarButton:f.a,Popover:g.a},props:{items:{type:Array}},computed:{activeBlockName(){const e=this.blockItems.find(e=>e.active);return e?e.label.toString():"Block"},blockSelectorEnabled(){return this.blockItems.some(e=>e.enabled)},blockItems(){return this.items.filter(e=>"blocks"==e.group)},itemGroups(){return Object(o.groupBy)(this.items.filter(e=>"blocks"!=e.group),e=>e.group)}},methods:{itemClick(e){e.enabled&&e.execute&&e.execute()},openChanged(e,t){!t&&e.enabled&&e.reset&&e.reset()},handleButtonKeydown(e){const t=e.currentTarget;switch(e.key){case"ArrowLeft":case"Left":this.$_moveFocus(t,"prev");break;case"ArrowRight":case"Right":this.$_moveFocus(t,"next");break;case"Home":this.$_moveFocus(t,"first");break;case"End":this.$_moveFocus(t,"last");break;default:return}e.stopPropagation(),e.preventDefault()},handleButtonFocus(e){const t=e.currentTarget;this.$_getAllButtons().forEach(e=>{e.tabIndex=e==t?0:-1})},$_getAllButtons(){return Array.prototype.slice.call(this.$el.querySelectorAll(".tui-editorWeka-toolbar__button"))},$_moveFocus(e,t){const n=Object(a.getTabbableElements)(this.$el),i=this.$_getAllButtons().filter(e=>n.includes(e)),o=i.length-1;let r=0;"prev"==t||"next"==t?(r=i.indexOf(e),-1==r?r="next"==t?o:0:(r+="next"==t?1:-1,r>o?r=0:r<0&&(r=o))):"first"==t?r=0:"last"==t&&(r=o),i[r]&&i[r].focus()}}},k=n("KHd+"),b=function(e){e.options.__langStrings={editor_weka:["format_as_blocktype_status","label_toolbar"]}},y=Object(k.a)(v,i,[],!1,null,null,null);"function"==typeof b&&b(y),y.options.__hasBlocks={script:!0,template:!0},y.options.__file="client/src/editor_weka/components/toolbar/Toolbar.vue";t.default=y.exports},hg2Q:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}},"i/kK":function(e,t){e.exports=tui.require("tui/components/form/FormRow")},"i7/w":function(e,t){e.exports=tui.require("vue")},iPZg:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/ImageBlock")},iag4:function(e,t,n){"use strict";function i(e){try{return JSON.parse(e.getAttribute("data-attrs"))}catch(e){return{}}}function o(e){return t=>{const n={};return e.forEach(e=>{const i=t.getAttribute(e);n[e]=null==i?void 0:i}),n}}n.r(t),n.d(t,"getJsonAttrs",(function(){return i})),n.d(t,"attrGetter",(function(){return o}))},jHsM:function(e,t){e.exports=tui.require("editor_weka/components/attachments/AudioAttachment")},kgTP:function(e,t){e.exports=tui.require("editor_weka/helpers/editor")},lBzj:function(e,t){e.exports=tui.require("tui/components/icons/FlexIcon")},lELM:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));var i=n("i7/w"),o=n.n(i),a=n("X7tx");class r{constructor(e,{editor:t,node:n,view:i,getPos:o,parent:a,context:r}){this.component=e,this.editor=t,this.node=n,this.view=i,this.parent=a,this.context=r,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isNode?o:null,this.createVue(),this.dom=this.vm.$el,this.contentDOM=this.vm.$refs.content}createVue(){const e=o.a.extend(this.component),t={nodeInfo:this.getNodeInfo(),contextInfo:this.getContextInfo(),updateAttrs:e=>this.updateAttrs(e),replaceWith:e=>this.replaceWith(e),getPos:this.getPos,getRange:this.getRange.bind(this)};this.vm=new e({parent:this.parent,propsData:t}).$mount(),this.vm.$on("remove",this.remove.bind(this))}getNodeInfo(){const e={node:this.node,editor:this.editor};return Object.preventExtensions(e),e}getContextInfo(){const e={context:this.context};return Object.preventExtensions(e),e}update(e,t){return e.type===this.node.type&&(e===this.node&&this.decorations===t||(this.node=e,this.updateComponentProps({nodeInfo:this.getNodeInfo()})),!0)}updateComponentProps(e){if(!this.vm._props)return;const t=o.a.config.silent;o.a.config.silent=!0,Object.entries(e).forEach(([e,t])=>{this.vm._props[e]=t}),o.a.config.silent=t}updateAttrs(e){if(!this.view.editable)return;const{state:t}=this.view,{type:n}=this.node,i=this.getPos(),o=Object.assign({},this.node.attrs,e),a=this.isMark?t.tr.removeMark(i.from,i.to,n).addMark(i.from,i.to,n.create(o)):t.tr.setNodeMarkup(i,null,o);this.view.dispatch(a)}replaceWith(e){const t=e(this.view.state.schema);if(void 0===t)return;const n=this.getRange(),i=this.view.state.tr.replaceWith(n.from,n.to,t);this.view.dispatch(i)}remove(){const e=this.view.state.tr,t=this.getRange(),n=e.delete(t.from,t.to);this.view.dispatch(n)}getSize(){return this.node.nodeSize}getRange(){if(this.isNode){const e=this.getPos();return{from:e,to:e+this.getSize()}}if(this.isMark){const e=this.view.posAtDOM(this.dom),t=this.view.state.doc.resolve(e);return Object(a.default)(t,this.node.type)}}destroy(){this.vm.$destroy()}}},ln5p:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-videoBlock"},[e.$apollo.loading?[n("p",[e._v("\n      "+e._s(e.$str("loadinghelp","moodle"))+"\n    ")])]:[n("div",{staticClass:"tui-editorWeka-videoBlock__inner"},[n("CoreVideoBlock",{attrs:{"mime-type":e.file.mime_type,url:e.file.url,filename:e.filename}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("AL+t"),s=n.n(r),l=n("hg2Q"),d=n("r4xq"),c=n.n(d),u={components:{CoreVideoBlock:s.a,NodeBar:c.a},extends:a.a,apollo:{file:{query:l.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{}}),computed:{hasAttachmentNode(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions(){let e=[];return this.hasAttachmentNode&&e.push({label:this.$str("display_as_attachment","editor_weka"),action:()=>{this.$_toAttachment()}}),e=e.concat([{label:this.$str("remove","moodle"),action:()=>{this.$_removeNode()}}]),this.downloadUrl&&e.push({label:this.$str("download","moodle"),action:()=>{window.document.location.href=this.downloadUrl}}),e},itemId(){if(!this.context.getItemId)throw new Error("No function 'getItemId' was found from extension");return this.context.getItemId()},filename(){return this.attrs.filename?this.attrs.filename:null},downloadUrl(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment(){if(!this.context.replaceWithAttachment)return;const e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)},$_removeNode(){this.context.removeNode&&this.context.removeNode(this.getRange)}}},m=n("KHd+"),p=function(e){e.options.__langStrings={moodle:["loadinghelp","remove"],editor_weka:["display_as_attachment","actions_menu_for"]}},h=Object(m.a)(u,i,[],!1,null,null,null);"function"==typeof p&&p(h),h.options.__hasBlocks={script:!0,template:!0},h.options.__file="client/src/editor_weka/components/nodes/VideoBlock.vue";t.default=h.exports},mD75:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Hashtag")},n31W:function(e,t){e.exports=tui.require("tui/prosemirror/state")},nEm4:function(e,t){e.exports=tui.require("tui/components/form/Form")},nFyd:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Hashtag")},nXMa:function(e,t){e.exports=tui.require("tui/components/buttons/Cancel")},"o7S+":function(e,t){e.exports=tui.require("tui/prosemirror/dropcursor")},oBVP:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("ziKp"),a=n.n(o),r=n("6RS6"),s=n.n(r),l=n("fvDX"),d=n("V68o"),c=n("f56J"),u=n("iag4"),m=n("n31W"),p=n("ddKQ"),h=n("vyVp");class f extends i.default{constructor(e){super(e),void 0===e&&(e={}),this.acceptTypes=e.accepttypes||[]}nodes(){return{attachment:{schema:{inline:!0,atom:!0,attrs:{filename:{default:void 0},size:{default:void 0},option:{default:void 0},url:{default:void 0}},parseDOM:[{tag:"div.tui-editorWeka-attachment",getAttrs:u.getJsonAttrs}],toDOM:e=>["div",{class:"tui-editorWeka-attachment","data-attrs":JSON.stringify({filename:e.attrs.filename,option:e.attrs.option,url:e.attrs.url})}]},component:a.a,componentContext:{convertToImage:this._convertToImage.bind(this),convertToVideo:this._convertToVideo.bind(this),convertToAudio:this._convertToAudio.bind(this),updateNode:this._updateNode.bind(this),hasImageNode:this._hasImageNode.bind(this),hasVideoNode:this._hasVideoNode.bind(this),removeNode:this.removeNode.bind(this),hasAudioNode:this._hasAudioNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},attachments:{schema:{group:"block",allowGapCursor:!0,content:"attachment*",parseDOM:[{tag:"div.tui-editorWeka-attachments"}],toDOM:()=>["div",{class:"tui-editorWeka-attachments"},0]},component:s.a}}}toolbarItems(){return[new l.ToolbarItem({group:"upload",label:Object(d.langString)("attachment","editor_weka"),icon:"editor_weka|attachment",execute:e=>{Object(p.pickFiles)(e).then(e=>{this.startUploadingFiles(e)})}})]}plugins(){return[Object(c.attachment)({onDrop:this._onDropEvent.bind(this),onKeyDown:this._onKeyDownEvent.bind(this)})]}_findAttachmentCollectionBlock(e){const t=e.selection.$from,n=t.parent;if(!n||"attachments"!==n.type.name)return null;let i=t.pos;return e.selection.empty||(i+=1),{from:t.before(),to:t.after(),insertPoint:i,node:n}}async startUploadingFiles(e){try{const t=await this.editor.fileStorage.uploadFiles(e,this.acceptTypes);if(0===t.length)return;const n=this.editor.state.schema,i=this.editor.view;let o=i.state.tr,a=this._findAttachmentCollectionBlock(o);const r=t.map(({file:e,url:t,size:i})=>n.node("attachment",{filename:e,url:t,size:i,option:{}}));if(a)o.insert(a.insertPoint,r),i.dispatch(o);else{const e=n.node("attachments",null,r),t=o.selection.$from.pos;i.dispatch(o.replaceWith(t,t,e))}}catch(e){console.error(e);const t=Object(d.langString)("error_upload_failed","editor_weka");Object(d.loadLangStrings)([t]).then(()=>Object(h.notify)({type:"error",message:t.toString()}))}}_onKeyDownEvent({view:e,event:t}){const{tr:n}=e.state,i=this._findAttachmentCollectionBlock(n);if(!i)return!1;if("Enter"===t.key){const t=e.state.schema.nodes.paragraph.createAndFill();return n.insert(i.to,t),n.setSelection(new m.TextSelection(n.doc.resolve(i.to+1))),e.dispatch(n),!0}if("Backspace"===t.key){if(!n.selection.$from.nodeBefore)return!1;if(1===i.node.content.size)return n.delete(i.from,i.to),e.dispatch(n),!0}return!0}_onDropEvent({event:e}){return!!(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length)&&(e.preventDefault(),this.startUploadingFiles(e.dataTransfer.files),!0)}_convertToImage(e,{filename:t,alttext:n}){this.editor.execute((i,o)=>{const a=i.schema.node("image",{filename:t,url:this._getFileUrl(t),alttext:n});this._doConvertToMedia(a,i.tr,o,e)})}_convertToVideo(e,{filename:t,mimeType:n}){this.editor.execute((i,o)=>{const a=i.schema.node("video",{filename:t,url:this._getFileUrl(t),mime_type:n});this._doConvertToMedia(a,i.tr,o,e)})}_updateNode(e,{filename:t,option:n,size:i}){this.editor.execute((o,a)=>{const r=o.tr,s=e();a(r.replaceWith(s.from,s.to,o.schema.node("attachment",{filename:t,url:this._getFileUrl(t),option:n,size:i}))),this.editor.view.focus()})}_hasImageNode(){return this.editor.hasNode("image")}_hasVideoNode(){return this.editor.hasNode("video")}_hasAudioNode(){return this.editor.hasNode("audio")}removeNode(e){this.editor.execute((t,n)=>{const i=t.tr,o=this._findAttachmentCollectionBlock(i);if(1===o.node.content.size)i.delete(o.from,o.to);else{let t=e();i.delete(t.from,t.to)}n(i)})}_convertToAudio(e,{filename:t,mimeType:n}){this.editor.execute((i,o)=>{const a=i.schema.node("audio",{filename:t,url:this._getFileUrl(t),mime_type:n});this._doConvertToMedia(a,i.tr,o,e)})}_doConvertToMedia(e,t,n,i){const o=this._findAttachmentCollectionBlock(t);if(o){if(t.insert(o.to,e),1===o.node.content.size)t.delete(o.from,o.to);else{const e=i();t.delete(e.from,e.to)}n(t)}}_getFileUrl(e){let t=this.editor.fileStorage.getFile(e);return null===t?null:t.url}_getItemId(){let e=this.editor.fileStorage.getRepositoryData();return e?e.itemId:null}}t.default=e=>new f(e)},oBkI:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var i=n("i7/w"),o=n.n(i),a=n("H/tB"),r=n.n(a),s=n("Mnur"),l=n.n(s),d=n("OWva"),c=n.n(d),u=(n("wd6j"),n("T7/7"),n("V68o")),m=n("TGM/"),p=n.n(m);class h{constructor(e){this.editor=null,this.options=Object.assign({},e)}setEditor(e){this.editor=e}nodes(){return[]}marks(){return[]}plugins(){return[]}toolbarItems(){return[]}keymap(e){}inputRules(){return[]}getSchema(){return this.editor.schema}get doc(){return this.editor.state.doc}async showModal(e,t){const n=document.createElement("span");this.editor.viewExtrasEl.appendChild(n);const i={component:e,props:t};Object.preventExtensions(i),await r.a.loadRequirements(e);const o=new f({parent:this.editor.getParent(),propsData:{container:i}});return o.$mount(n),new Promise(e=>{o.$on("close-complete",t=>{o.$destroy(),e(t)}),o.show()})}showComponent(e,t){const n=document.createElement("span"),i=o.a.extend(e);this.editor.viewExtrasEl.appendChild(n);const a=new i(Object.assign({parent:this.editor.getParent()},t));return a.$mount(n),a}async showActionDropdown(e,{actions:t}){const n=this.editor.view.coordsAtPos(e),i=this.editor.viewExtrasEl.offsetParent.getBoundingClientRect();await(e=>{const t=p()("sleep");return new Promise(n=>setTimeout(()=>{t(),n()},e))})(0),await Object(u.loadLangStrings)(t.map(e=>e.label));const o=this.showComponent(c.a,{propsData:{location:{x:n.left-i.left,y:n.bottom-i.top},actions:t}});return o.$on("dismiss",()=>{o.$destroy(),o.$el.remove()}),o}removeNode(e){this.editor.execute((t,n)=>{const i=t.tr,o=e();i.delete(o.from,o.to),n(i)})}}const f=o.a.extend({props:{container:{type:Object}},data:()=>({result:null,open:!1}),methods:{show(){this.open=!0},requestClose(e){this.result=e,this.open=!1},closeComplete(){this.$emit("close-complete",this.result)}},render(e){return e(l.a,{props:{open:this.open},on:{"request-close":this.requestClose,"close-complete":this.closeComplete}},[e(this.container.component,{props:this.container.props})])}})},oMuj:function(e,t){e.exports=tui.require("tui/components/form/InputText")},p2bi:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-attachment"},[e.$apollo.loading?e._e():[e.isImage?n("ImageAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"alt-text":e.option.alttext||null,"enable-convert":e.hasImageNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toImage,"update-alt-text":e.updateAltText,delete:e.removeNode,download:e.download}}):e.isVideo?n("VideoAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasVideoNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toVideo,delete:e.removeNode,download:e.download}}):e.isAudio?n("AudioAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasAudioNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toAudio,delete:e.removeNode,download:e.download}}):n("FileAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,filename:e.filename,"draft-id":e.itemId,"has-download-url":!!e.downloadUrl},on:{delete:e.removeNode,download:e.download}})]],2)};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("hg2Q"),s=n("gEm7"),l=n("D3bS"),d=n.n(l),c=n("+xcZ"),u=n.n(c),m=n("GqWi"),p=n.n(m),h=n("jHsM"),f=n.n(h),_={components:{ImageAttachment:d.a,FileAttachment:u.a,VideoAttachment:p.a,AudioAttachment:f.a},extends:a.a,apollo:{file:{query:r.a,variables(){return{item_id:this.itemId,filename:this.filename}}}},data:()=>({file:{}}),computed:{isImage(){return this.file&&this.file.media_type===s.IMAGE},isVideo(){return this.file&&this.file.media_type===s.VIDEO},isAudio(){return this.file&&this.file.media_type===s.AUDIO},itemId(){if(!this.context.getItemId)throw new Error("There is no function 'getItemId'");return this.context.getItemId()},filename(){const e=this.attrs;return e.filename?e.filename:this.$str("unknown_attachment","editor_weka")},option(){return this.attrs.option?this.attrs.option:{}},hasImageNode(){return!!this.context.hasImageNode&&this.context.hasImageNode()},hasVideoNode(){return!!this.context.hasVideoNode&&this.context.hasVideoNode()},hasAudioNode(){return!!this.context.hasAudioNode&&this.context.hasAudioNode()},downloadUrl(){if(!this.context.getFileUrl)return null;let e=this.context.getFileUrl(this.filename);return e?this.$url(e):null}},methods:{toImage(){if(!this.context.convertToImage)return;const e={filename:this.filename,alttext:this.option.alttext||null};this.context.convertToImage(this.getRange,e)},updateAltText(e){this.$_updateNode({filename:this.filename,size:this.file?this.file.file_size:this.attrs.size,option:{alttext:e}})},$_updateNode(e){this.context.updateNode&&this.context.updateNode(this.getRange,e)},toVideo(){if(!this.context.convertToVideo)return;const e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToVideo(this.getRange,e)},toAudio(){if(!this.context.convertToAudio)return;const e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToAudio(this.getRange,e)},removeNode(){this.context.removeNode&&this.context.removeNode(this.getRange)},download(){let e=this.downloadUrl;e&&(window.document.location.href=e)}}},g=n("KHd+"),v=function(e){e.options.__langStrings={editor_weka:["unknown_attachment"]}},k=Object(g.a)(_,i,[],!1,null,null,null);"function"==typeof v&&v(k),k.options.__hasBlocks={script:!0,template:!0},k.options.__file="client/src/editor_weka/components/nodes/Attachment.vue";t.default=k.exports},qSeW:function(e,t,n){"use strict";n.r(t),n.d(t,"wrapInList",(function(){return a})),n.d(t,"splitListItem",(function(){return r})),n.d(t,"liftListItem",(function(){return s})),n.d(t,"sinkListItem",(function(){return l}));var i=n("sl/l"),o=n("wd6j");function a(e,t){return function(n,a){let{$from:r,$to:s}=n.selection,l=r.blockRange(s),d=!1,c=l;if(!l)return!1;if(l.depth>=2&&r.node(l.depth-1).type.compatibleContent(e)&&0==l.startIndex){if(0==r.index(l.depth-1))return!1;let e=n.doc.resolve(l.start-2);c=new o.NodeRange(e,e,l.depth),l.endIndex<l.parent.childCount&&(l=new o.NodeRange(r,n.doc.resolve(s.end(l.depth)),l.depth)),d=!0}let u=Object(i.findWrapping)(c,e,t,l);return!!u&&(a&&a(function(e,t,n,a,r){let s=o.Fragment.empty;for(let e=n.length-1;e>=0;e--)s=o.Fragment.from(n[e].type.create(n[e].attrs,s));e.step(new i.ReplaceAroundStep(t.start-(a?2:0),t.end,t.start,t.end,new o.Slice(s,0,0),n.length,!0));let l=0;for(let e=0;e<n.length;e++)n[e].type==r&&(l=e+1);let d=n.length-l,c=t.start+n.length-(a?2:0),u=t.parent;for(let n=t.startIndex,o=t.endIndex,a=!0;n<o;n++,a=!1)!a&&Object(i.canSplit)(e.doc,c,d)&&(e.split(c,d),c+=2*d),c+=u.child(n).nodeSize;return e}(n.tr,l,u,d,e).scrollIntoView()),!0)}}function r(e){return function(t,n){let{$from:a,$to:r,node:s}=t.selection;if(s&&s.isBlock||a.depth<2||!a.sameParent(r))return!1;let l=a.node(-1);if(l.type!=e)return!1;if(0==a.parent.content.size){if(2==a.depth||a.node(-3).type!=e||a.index(-2)!=a.node(-2).childCount-1)return!1;if(n){let i=o.Fragment.empty,r=a.index(-1)>0;for(let e=a.depth-(r?1:2);e>=a.depth-3;e--)i=o.Fragment.from(a.node(e).copy(i));i=i.append(o.Fragment.from(e.createAndFill()));let s=t.tr.replace(a.before(r?null:-1),a.after(-3),new o.Slice(i,r?3:2,2));s.setSelection(t.selection.constructor.near(s.doc.resolve(a.pos+(r?3:2)))),n(s.scrollIntoView())}return!0}let d=r.pos==a.end()?l.contentMatchAt(0).defaultType:null,c=t.tr.delete(a.pos,r.pos),u=d&&[null,{type:d}];return!!Object(i.canSplit)(c.doc,a.pos,2,u)&&(n&&n(c.split(a.pos,2,u).scrollIntoView()),!0)}}function s(e){return function(t,n){let{$from:a,$to:r}=t.selection,s=a.blockRange(r,t=>t.childCount&&t.firstChild.type==e);return!!s&&(!n||(a.node(s.depth-1).type==e?function(e,t,n,a){let r=e.tr,s=a.end,l=a.$to.end(a.depth);s<l&&(r.step(new i.ReplaceAroundStep(s-1,l,s,l,new o.Slice(o.Fragment.from(n.create(null,a.parent.copy())),1,0),1,!0)),a=new o.NodeRange(r.doc.resolve(a.$from.pos),r.doc.resolve(l),a.depth));return t(r.lift(a,Object(i.liftTarget)(a)).scrollIntoView()),!0}(t,n,e,s):function(e,t,n){let a=e.tr,r=n.parent;for(let e=n.end,t=n.endIndex-1,i=n.startIndex;t>i;t--)e-=r.child(t).nodeSize,a.delete(e-1,e+1);let s=a.doc.resolve(n.start),l=s.nodeAfter,d=0==n.startIndex,c=n.endIndex==r.childCount,u=s.node(-1),m=s.index(-1);if(!u.canReplace(m+(d?0:1),m+1,l.content.append(c?o.Fragment.empty:o.Fragment.from(r))))return!1;let p=s.pos,h=p+l.nodeSize;return a.step(new i.ReplaceAroundStep(p-(d?1:0),h+(c?1:0),p+1,h-1,new o.Slice((d?o.Fragment.empty:o.Fragment.from(r.copy(o.Fragment.empty))).append(c?o.Fragment.empty:o.Fragment.from(r.copy(o.Fragment.empty))),d?0:1,c?0:1),d?0:1)),t(a.scrollIntoView()),!0}(t,n,s)))}}function l(e){return function(t,n){let{$from:a,$to:r}=t.selection,s=a.blockRange(r,t=>t.childCount&&t.firstChild.type==e);if(!s)return!1;let l=s.startIndex;if(0==l)return!1;let d=s.parent,c=d.child(l-1);if(c.type!=e)return!1;if(n){let a=c.lastChild&&c.lastChild.type==d.type,r=o.Fragment.from(a?e.create():null),l=new o.Slice(o.Fragment.from(e.create(null,o.Fragment.from(d.type.create(null,r)))),a?3:1,0),u=s.start,m=s.end;n(t.tr.step(new i.ReplaceAroundStep(u-(a?3:1),m,u,m,l,1,!0)).scrollIntoView())}return!0}}},r4xq:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/NodeBar")},rLLB:function(e,t){e.exports=tui.require("editor_weka/components/editing/Emojis")},rR9N:function(e,t){e.exports=tui.require("tui/prosemirror/view")},rqBY:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Mention")},s0QR:function(e,t,n){"use strict";n.r(t);var i=n("oBkI"),o=n("fvDX"),a=n("V68o");class r extends i.default{nodes(){return{ruler:{schema:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}}}toolbarItems(){return[new o.ToolbarItem({group:"embeds",label:Object(a.langString)("horizontalrule","editor"),icon:"editor_weka|arrows",execute:e=>{e.execute((t,n)=>{let i=t.schema.nodes.ruler;n(t.tr.replaceSelectionWith(i.create())),e.view.focus()})}})]}keymap(e){const{ruler:t}=this.getSchema().nodes;e("Mod-_",(e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0))}}t.default=e=>new r(e)},sjpv:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.wrapperStyle},[n("ActionDropdown",{attrs:{actions:e.actions,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)})],1)};i._withStripped=!0;var o=n("ce8f"),a={components:{ActionDropdown:n.n(o).a},props:{location:{type:Object,validator:e=>"x"in e&&"y"in e},actions:Array},computed:{wrapperStyle(){return{position:"absolute",left:this.location.x+"px",top:this.location.y+"px"}}}},r=n("KHd+"),s=Object(r.a)(a,i,[],!1,null,null,null);s.options.__hasBlocks={script:!0,template:!0},s.options.__file="client/src/editor_weka/components/editing/PositionedActionDropdown.vue";t.default=s.exports},"sl/l":function(e,t){e.exports=tui.require("tui/prosemirror/transform")},"t+A+":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaWithLearn"},[n("h3",{staticClass:"tui-wekaWithLearn__title"},[e._v("\n    "+e._s(e.$str("pluginname","editor_weka"))+"\n  ")]),e._v(" "),n("Form",{staticClass:"tui-wekaWithLearn__form",attrs:{method:"POST",action:e.$url("/lib/editor/weka/tests/fixtures/weka_with_learn.php",{sesskey:e.sesskey}),"input-width":"full",vertical:!0}},[n("FormRow",{staticClass:"tui-wekaWithLearn__form__row",attrs:{label:e.$str("pluginname","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("Weka",{attrs:{id:i,component:"editor_weka",area:"learn",doc:e.doc,"instance-id":e.instanceId},on:{update:e.updateContent}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__form__row",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"json_content",value:e.documentValue,hidden:!0}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__form__row",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"item_id",value:e.itemId,hidden:!0}})]}}])}),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaWithLearn__form__buttonGroup"},[n("Submit"),e._v(" "),n("Button",{attrs:{type:"submit",name:"cancel",value:"1",text:e.$str("cancel","moodle")}})],1)],1),e._v(" "),n("hr"),e._v(" "),n("pre",{staticClass:"tui-wekaWithLearn__code"},[e._v(e._s(e.jsonPretty))])],1)};i._withStripped=!0;var o=n("nEm4"),a=n.n(o),r=n("i/kK"),s=n.n(r),l=n("2wx7"),d=n.n(l),c=n("BN8m"),u=n.n(c),m=n("oMuj"),p=n.n(m),h=n("TXEh"),f=n("KRvX"),_=n.n(f),g=n("vF5l"),v=n.n(g),k={components:{Form:a.a,FormRow:s.a,Weka:d.a,ButtonGroup:u.a,InputText:p.a,Submit:_.a,Button:v.a},props:{defaultDoc:{type:String,default:""},instanceId:[String,Number],sesskey:{type:String,required:!0}},data(){return{doc:null,itemId:this.defaultItemId}},computed:{documentValue(){return null===this.doc?"":JSON.stringify(this.doc)},jsonPretty(){return JSON.stringify(this.doc,void 0,2)}},watch:{defaultDoc:{immediate:!0,handler(e){e&&(this.doc=JSON.parse(e))}}},methods:{$_readJSON:Object(h.debounce)((function(e){this.doc=e.getJSON(),this.itemId=e.getFileStorageItemId()}),250),updateContent(e){this.$_readJSON(e)}}},b=n("KHd+"),y=function(e){e.options.__langStrings={editor_weka:["pluginname"],moodle:["cancel"]}},w=Object(b.a)(k,i,[],!1,null,null,null);"function"==typeof y&&y(w),w.options.__hasBlocks={script:!0,template:!0},w.options.__file="client/src/editor_weka/pages/fixtures/WekaWithLearn.vue";t.default=w.exports},t6uu:function(e,t,n){"use strict";n.r(t),n.d(t,"createMentionContent",(function(){return o}));var i=n("kgTP");function o({fullname:e,userId:t}){let n=Object(i.getDefaultDocument)();return n.content[0]={type:"paragraph",content:[{type:"mention",attrs:{id:t,display:e}},{type:"text",text:" "}]},n}},ta2K:function(e,t){e.exports=tui.require("editor_weka/components/nodes/VideoBlock")},tkAW:function(e,t){e.exports=tui.require("tui/components/modal/Modal")},tnXT:function(e,t){e.exports=tui.require("editor_weka/components/nodes/BaseNode")},u5iS:function(e,t){e.exports=tui.require("tui/components/modal/ModalContent")},vF5l:function(e,t){e.exports=tui.require("tui/components/buttons/Button")},vyVp:function(e,t){e.exports=tui.require("tui/notifications")},wbdD:function(e,t,n){"use strict";n.r(t),n.d(t,"createSchema",(function(){return r}));var i=n("wd6j");const o=["p",0],a={doc:{content:"block+"},paragraph:{group:"block",content:"inline*",parseDOM:[{tag:"p"}],toDOM:()=>o},text:{group:"inline"}};function r({nodes:e,marks:t}){return new i.Schema({nodes:Object.assign({},a,e),marks:t||{}})}},wd6j:function(e,t){e.exports=tui.require("tui/prosemirror/model")},"x/Nx":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-editorWeka-filePicker"},[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{type:"file",multiple:this.multiple},on:{change:this.$_pickFile}})])};i._withStripped=!0;var o={props:{autoTrigger:{type:Boolean,default:!1},maxFiles:{type:[String,Number]}},computed:{multiple(){return 1!=this.maxFiles}},mounted(){this.autoTrigger&&(this.$_click(),this.$window.document.addEventListener("keyup",this.$_dismiss))},beforeDestroy(){this.$window.document.removeEventListener("keyup",this.$_dismiss)},methods:{$_pickFile(e){let t=[];e&&e.target&&e.target.files&&(t=e.target.files),this.$emit("picked-files",t),this.$emit("dismiss")},$_click(){this.$refs.fileInput&&this.$refs.fileInput.click()},$_dismiss(e){e&&"Escape"===e.key&&this.$emit("dismiss")}}},a=n("KHd+"),r=Object(a.a)(o,i,[],!1,null,null,null);r.options.__hasBlocks={script:!0,template:!0},r.options.__file="client/src/editor_weka/components/upload/FilePicker.vue";t.default=r.exports},x4h3:function(e,t,n){"use strict";n.r(t);var i=n("n31W"),o=n("rR9N");t.default=function(e){return new i.Plugin({key:new i.PluginKey("text-placeholder"),props:{decorations({doc:t}){if(!e)return!1;if(1!==t.childCount||!t.firstChild.isTextblock)return!1;let n=[];return t.descendants((t,i)=>(t.type.isBlock&&0==t.childCount&&n.push(o.Decoration.node(i,i+t.nodeSize,{class:"tui-weka__placeholder","data-placeholder":e})),!0)),o.DecorationSet.create(t,n)}}})}},xYuG:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-editorWeka-linkBlock",attrs:{"data-url":e.attrs.url}},[n("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,o=t.isOpen;return[n("div",{on:{"!click":function(e){return e.preventDefault(),i(e)}}},[n("LinkBlockInner",{attrs:{attrs:e.attrs}})],1),e._v(" "),n("div",{staticClass:"tui-editorWeka-linkBlock__btn-wrapper"},[n("ButtonIcon",{staticClass:"tui-editorWeka-linkBlock__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":o.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.attrs.title||e.attrs.url)},on:{click:i}},[n("More")],1)],1)]}}])},[e._v(" "),n("DropdownButton",{on:{click:e.open}},[e._v("\n      "+e._s(e.$str("go_to_link","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.edit}},[e._v("\n      "+e._s(e.$str("edit","moodle"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.toLink}},[e._v("\n      "+e._s(e.$str("display_as_text","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.remove}},[e._v("\n      "+e._s(e.$str("remove","moodle"))+"\n    ")])],1)],1)};i._withStripped=!0;var o=n("tnXT"),a=n.n(o),r=n("5h9J"),s=n.n(r),l=n("gLvT"),d=n.n(l),c=n("3sQR"),u=n.n(c),m=n("0QOp"),p=n.n(m),h=n("hCGN"),f=n.n(h),_={components:{ButtonIcon:s.a,Dropdown:d.a,DropdownButton:u.a,LinkBlockInner:p.a,More:f.a},extends:a.a,methods:{open(){window.open(this.attrs.url)},edit(){this.context.editCard(this.getRange)},toLink(){const e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})},remove(){this.$emit("remove")}}},g=n("KHd+"),v=function(e){e.options.__langStrings={editor_weka:["display_as_text","go_to_link","actions_menu_for"],moodle:["edit","remove"]}},k=Object(g.a)(_,i,[],!1,null,null,null);"function"==typeof v&&v(k),k.options.__hasBlocks={script:!0,template:!0},k.options.__file="client/src/editor_weka/components/nodes/LinkBlock.vue";t.default=k.exports},yHzl:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditImageAltTextModal")},z2s3:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/Toolbar")},z3By:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));var i=n("wd6j"),o=n("i7/w"),a=n.n(o);class r{constructor(e){this._instance=null,this._editor=e}matcher(e,t){if(!(t&&t instanceof i.ResolvedPos))return null;const n=t.doc.textBetween(t.start(),t.end(),"\0","\0");if(""===n)return null;let o;for(e.lastIndex=0;o=e.exec(n);){let e=o.input.slice(Math.max(0,o.index-1),o.index);if(!/^[\s\0]?$/.test(e))continue;let n=o.index+t.start(),i=n+o[0].length;if(n<t.pos&&i>=t.pos)return{range:{from:n,to:i},text:o[0]}}return null}destroyInstance(){null!==this._instance&&(this._instance.$destroy(),this._editor.viewExtrasLiveEl.removeChild(this._instance.$el),this._instance=null)}resetComponent(){return{apply:!1,text:"",from:0,to:0}}showList({view:e,component:t,state:{range:n,text:i},callback:o}){const r=document.createElement("span");this._editor.viewExtrasLiveEl.appendChild(r);const s=e.coordsAtPos(n.from),l=this._editor.viewExtrasLiveEl.offsetParent.getBoundingClientRect();this._instance=new(a.a.extend(t.component))({parent:this._editor.getParent(),propsData:{x:s.left-l.left,y:s.bottom-l.top,pattern:i}}),this._instance.$mount(r),this._instance.$on("item-selected",({id:i,text:a})=>{this.destroyInstance();const r=this.getNode(e.state,t.name,t.attrs(i,a));this.convertToNode(n,r),"function"==typeof o&&o()}),this._instance.$on("dismiss",()=>{this.destroyInstance(),this._editor.view.focus()})}getNode(e,t,n){return e.schema.node(t,n)}convertToNode(e,t){this._editor.execute((n,i)=>{i(this.createTransaction(n,e,t)),this._editor.view.focus()})}createTransaction(e,t,n){let i=e.tr;return i=i.replaceWith(t.from,t.to,n),i}apply(e,t,n,i){const{selection:o}=e;let a=Object.assign({},t);if(o.from===o.to){const e=this.matcher(n,o.$from);if(e)return a.active=!0,a.range=e.range,a.text=e.text,i&&(i.text=e.text,i.from=e.range.from,i.to=e.range.to),a}return a.active=!1,a.range={},a.text=null,a}}},zK61:function(e,t){e.exports=tui.require("editor_weka/mixins/attachment_mixin")},zLSG:function(e,t,n){"use strict";n.r(t),n.d(t,"SetAttrsStep",(function(){return a})),n.d(t,"setAttrs",(function(){return r}));var i=n("wd6j"),o=n("sl/l");class a extends o.Step{constructor(e,t){super(),this.pos=e,this.attrs=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return o.StepResult.fail("No node at given position");let n=t.type.create(this.attrs,i.Fragment.empty,t.marks),a=new i.Slice(i.Fragment.from(n),0,t.isLeaf?0:1);return o.StepResult.fromReplace(e,this.pos,this.pos+t.nodeSize,a)}invert(e){let t=e.nodeAt(this.pos);return new a(this.pos,t?t.attrs:null)}map(e){let t=e.mapResult(this.pos,1);return t.deleted?null:new a(t.pos,this.attrs)}toJSON(){return{stepType:"setAttrs",pos:this.pos,attrs:this.attrs}}static fromJSON(e,t){if("number"!=typeof t.pos||null!=t.attrs&&"object"!=typeof t.attrs)throw new RangeError("Invalid input for SetAttrsStep.fromJSON");return new a(t.pos,t.attrs)}}o.Step.jsonID("setAttrs",a);const r=(e,t)=>n=>n.step(new a(e,t))},zdIk:function(e,t,n){!function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("editor_weka")?console.warn('[tui bundle] The bundle "editor_weka" is already loaded, skipping initialisation.'):(tui._bundle.register("editor_weka"),tui._bundle.addModulesFromContext("editor_weka",n("1j8w")),tui._bundle.addModulesFromContext("editor_weka/components",n("ISlu")),tui._bundle.addModulesFromContext("editor_weka/pages",n("YOQe")))}()},ziKp:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachment")}});