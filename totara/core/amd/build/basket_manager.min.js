define([],function(){function a(){return this instanceof a?(this.basketRequestArgs={action:"",basket:0,ids:[]},this.classBasketWide="tw-selectionBasket--wide",this.eventListener="totara_core/selection_basket",this.eventNode=null,this.selectedItems=[],this.webservices={del:"totara_core_basket_delete",show:"totara_core_basket_show",upd:"totara_core_basket_update"},void(this.widget=null)):new a}a.prototype.bubbledEventsListener=function(){var a=this;this.eventNode.addEventListener(this.eventListener+":transition",function(b){"small"===b.detail.state&&a.onBasketHidden(),M.util.js_complete("basketTransition")}),this.eventNode.addEventListener(this.eventListener+":update",function(b){var c=b.detail.action;"show"===c?(M.util.js_pending("basketTransition"),a.onBasketShow()):"hide"===c?a.onBasketHide():"clear"===c&&a.onBasketClear()})},a.prototype.clearBasketArgs=function(){this.basketRequestArgs.action="",this.basketRequestArgs.ids=[]},a.prototype.getAllArgs=function(){return this.basketRequestArgs},a.prototype.getBasketKey=function(){return this.basketRequestArgs.basket},a.prototype.getEventListener=function(){return this.eventListener},a.prototype.getSelectedItems=function(){return this.selectedItems},a.prototype.getWebservice=function(a){return this.webservices[a]},a.prototype.getWideClass=function(){return this.classBasketWide},a.prototype.onBasketClear=function(){},a.prototype.onBasketHidden=function(){},a.prototype.onBasketHide=function(){},a.prototype.onBasketShow=function(){},a.prototype.onBasketUpdate=function(){},a.prototype.setBasketArgs=function(a,b){this.basketRequestArgs.action!==a&&(this.basketRequestArgs.ids=[],this.basketRequestArgs.action=a),this.basketRequestArgs.ids.indexOf(b)>-1||this.basketRequestArgs.ids.push(b)},a.prototype.setBasketKey=function(a){this.basketRequestArgs.basket=a},a.prototype.setSelectedItems=function(a){a||(a=[]),this.selectedItems=a},a.prototype.toggleExpandedView=function(){this.widget.classList.toggle(this.classBasketWide)},a.prototype.toggleShowBasketBtn=function(){this.widget.classList.toggle("tw-selectionBasket__displayed")},a.prototype.renderBasket=function(a){var b,c=this.widget,d=this;return this.setSelectedItems(a.ids),this.clearBasketArgs(),new Promise(function(a){c&&(b=0,d.selectedItems&&(b=d.selectedItems.length),c.setAttribute("data-tw-selectionbasket-countchange",b)),d.onBasketUpdate(),a()})},a.prototype.setParent=function(a){this.widget=a},a.prototype.setParentEventNode=function(a){this.eventNode=a},a.prototype.updateBasketView=function(){return{args:{basket:this.getBasketKey()},callback:[this.renderBasket.bind(this)],methodname:this.getWebservice("show")}},a.prototype.updateBasketValAndView=function(){return{args:this.getAllArgs(),callback:[this.renderBasket.bind(this)],methodname:this.getWebservice("upd")}},a.prototype.updateDeleteBasket=function(){return{args:{basket:this.getBasketKey()},callback:[this.renderBasket.bind(this)],methodname:this.getWebservice("del")}};var b=function(b,c){var d=b.querySelector("[data-tw-selectionBasket]"),e=new a;return e.setParent(d),e.setParentEventNode(b),e.setBasketKey(c),e.bubbledEventsListener(),e};return{init:b}});