define(["core/ajax","totara_core/filters","totara_core/basket_manager","totara_core/crumb_manager","totara_core/action_list_manager","totara_core/filter_manager","totara_core/loader_manager"],function(a,b,c,d,e,f,g){function h(){return this instanceof h?(this.basket=null,this.hideClass="tw-basketlist__hide",this.crumb=null,this.filters=null,this.loader=null,this.listParent=null,this.list=null,void(this.selectors=null)):new h}return h.prototype.setListParent=function(a){this.listParent=a.querySelector("[data-tw-basket-list]")},h.prototype.reset=function(){this.filters.clearFilters(),this.crumb&&(this.crumb.clearCrumbtrail(),this.crumb.setHeadingToTop()),this.selectors.clearFiltersRegionPanel(),this.selectors.clearPrimarySearch(),this.selectors.clearPrimaryTree(),this.list.disableToggleLevel()},h.prototype.updatePage=function(b){var c=this;return new Promise(function(d,e){a.getDataUpdate(b).then(function(){c.loader.hide(),d()})["catch"](function(){c.loader.hide(),e()})})},h.prototype.basketEvents=function(b){var c=this;b.onBasketClear=function(){c.loader.show(),a.getData(b.updateDeleteBasket()).then(function(a){var c=a.callbacks[0];c(a),b.onBasketHide()})},b.onBasketHidden=function(){c.crumb&&(c.crumb.removeClass(c.hideClass),c.crumb.headingRemoveClass(c.hideClass)),c.selectors.primarySearchRemoveClass(c.hideClass),c.selectors.primaryTreeRemoveClass(c.hideClass)},b.onBasketHide=function(){b.toggleExpandedView(),b.toggleShowBasketBtn(),c.reset(),c.list.enabledActions=!0,c.list.enabledHierarchy=!0,c.list.update()},b.onBasketShow=function(){b.toggleExpandedView(),b.toggleShowBasketBtn(),c.selectors.primarySearchToggleClass(c.hideClass),c.selectors.primaryTreeToggleClass(c.hideClass),c.crumb&&(c.crumb.toggleClass(c.hideClass),c.crumb.headingToggleClass(c.hideClass)),c.list.disableToggleLevel(),c.loader.show(),c.filters.clearFilters(),c.selectors.clearFiltersRegionPanel(),c.filters.setFilter("basket",b.getBasketKey()),c.list.enabledActions=!1,c.list.enabledHierarchy=!1,c.list.update()},b.onBasketUpdate=function(){c.list.selectedItems=b.getSelectedItems()}},h.prototype.filterEvents=function(a){var b=this;a.onFiltersUpdate=function(){b.list.setRequestArg("filters",a.getFilters())}},h.prototype.listEvents=function(a){var b=this;a.onListHierarchyLevelChange=function(c){b.filters.clearFilters(),b.selectors.clearFiltersRegionPanel(),b.selectors.clearPrimarySearch(),b.filters.setFilter(c.detail.key,c.detail.val,c.detail.groupValues),b.crumb.setParentId(c.detail.val),a.resetToggleLevel(),b.loader.show(),b.updatePage([b.list.getUpdateRequestArgs(),b.crumb.updateCrumbAndHeader()])},a.onItemSelected=function(a){b.basket.setBasketArgs("add",a)},a.onItemUnselected=function(a){b.basket.setBasketArgs("remove",a)},a.onItemUpdate=function(){b.updatePage([b.basket.updateBasketValAndView()])},a.onPreRequest=function(){b.loader.show()},a.onPostRequest=function(){b.loader.hide()}},h.prototype.selectorEvents=function(a){var b=this;a.onFilterRegionPanelAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onFilterRegionPanelUpdate=function(){b.list.update()},a.onFilterRegionPanelReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)},a.onPrimaryFilterSearchAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onPrimaryFilterSearchUpdate=function(){b.list.update()},a.onPrimaryFilterSearchReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)},a.onPrimaryFilterTreeAdd=function(a){b.filters.setFilter(a.detail.key,a.detail.val,a.detail.groupValues)},a.onPrimaryFilterTreeUpdate=function(){b.list.update()},a.onPrimaryFilterTreeReset=function(a){var c=a.detail.groupValues?a.detail.groupValues:"";b.filters.removeFilter(a.detail.key,c)}},h.prototype.initExtend=function(){},h.prototype.init=function(a){var h=a.parent,i=a.basketKey+"Pause",j=this;return new Promise(function(k){M.util.js_pending(i),j.setListParent(h),j.loader=g.init(h),j.loader.show(),j.filters=new b,j.filterEvents(j.filters),j.basket=c.init(h,a.basketKey),j.basketEvents(j.basket),a.crumbtrail&&(j.crumb=d.init(h,a.crumbtrail)),a.list.map.hasCheckboxes=!0,j.list=e.init(h,a.list),j.listEvents(j.list),j.selectors=f.init(h),j.selectorEvents(j.selectors),j.initExtend(),k();var l=[j.list.prepare()];a.crumbtrail&&l.push(j.crumb.loadCrumbStrings()),Promise.all(l).then(function(){j.updatePage([j.basket.updateBasketView(),j.list.getUpdateRequestArgs()]),M.util.js_complete(i)})})},h});