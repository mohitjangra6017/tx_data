define(["core/templates","core/notification","core/ajax","totara_core/modal_list","totara_core/loader_manager"],function(a,b,c,d,e){function f(){return this instanceof f?(this.widget="",this.loader=null,this.criterion={type:"othercompetency",aggregation:{}},this.criterionKey="",this.endpoints={detail:"criteria_othercompetency_get_detail"},this.domClasses={hidden:"crit_hidden"},void(this.filename="othercompetency.js")):new f}f.prototype={setParent:function(a){this.widget=a},getDetail:function(){var a,d=this,e=this.widget.closest("[data-tw-criterion-key]"),f=0,g=0,h=null;return new Promise(function(i){e&&(f=e.hasAttribute("data-tw-criterion-key")?e.getAttribute("data-tw-criterion-key"):0,g=e.hasAttribute("data-tw-criterion-id")?e.getAttribute("data-tw-criterion-id"):0),0==g?h=new Promise(function(a){a(d.createEmptyCriterion())}):(a={args:{id:g},methodname:d.endpoints.detail},h=c.getData(a)),h.then(function(a){var b=a.results;d.criterion.id=g,d.criterionKey=f,d.setAggregationMethod(b.aggregation.method),d.setAggregationCount(b.aggregation.reqitems),Promise.all([]).then(function(){d.triggerEvent("update",{criterion:d.criterion}),i()})})["catch"](function(a){a.fileName=d.filename,a.name="Error retrieving detail",b.exception(a)})})},setAggregationMethod:function(a){var b=this.widget.querySelector('[data-tw-criterionOtherCompetency-aggregationMethod="'+a+'"]'),c=b.querySelector("[data-tw-criterionOtherCompetency-aggregationMethod-changed]"),d=this.widget.querySelector("[data-tw-criterionOtherCompetency-aggregationCount-changed]"),e=b.querySelector("[data-tw-criterionOtherCompetency-aggregationCount-changed]");this.criterion.aggregation.method=a,c&&(c.checked=!0),d&&(d.disabled=!e)},setAggregationCount:function(a){var b=this.widget.querySelector("[data-tw-criterionOtherCompetency-aggregationCount-changed]");this.criterion.aggregation.reqitems=a,b&&(b.value=a)},createEmptyCriterion:function(){return new Promise(function(a){a({results:{id:0,items:[],aggregation:{method:1,reqitems:1}}})})},triggerEvent:function(a,b){b.key=this.criterionKey;var c=new CustomEvent("totara_criteria/criterion:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var g=function(a){return new Promise(function(b){var c=new f;c.setParent(a),c.loader=e.init(a),c.loader.show(),b(c),M.util.js_pending("criterionOtherCompetency"),c.getDetail().then(function(){c.loader.hide(),M.util.js_complete("criterionOtherCompetency")})})};return{init:g}});