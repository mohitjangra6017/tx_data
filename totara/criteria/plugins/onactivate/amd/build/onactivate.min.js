define(["totara_core/loader_manager"],function(a){function b(){return this instanceof b?(this.widget="",this.loader=null,this.criterion={type:"onactivate",id:0},void(this.criterionKey="")):new b}b.prototype={setParent:function(a){this.widget=a},getDetail:function(){var a=this,b=this.widget.closest("[data-tw-criterion-key]");return new Promise(function(c){b&&(a.criterionKey=b.hasAttribute("data-tw-criterion-key")?b.getAttribute("data-tw-criterion-key"):0,a.criterion.id=b.hasAttribute("data-tw-criterion-id")?b.getAttribute("data-tw-criterion-id"):0),a.triggerEvent("update",{criterion:a.criterion}),c()})},triggerEvent:function(a,b){b.key=this.criterionKey;var c=new CustomEvent("totara_criteria/criterion:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var c=function(c){return new Promise(function(d){var e=new b;e.setParent(c),e.loader=a.init(c),e.loader.show(),d(e),M.util.js_pending("criterionCourseCompletion"),e.getDetail().then(function(){e.loader.hide(),M.util.js_complete("criterionCourseCompletion")})})};return{init:c}});