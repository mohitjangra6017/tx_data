define(["jquery","core/ajax","jqueryui"],function(a,b){return a.widget("custom.sortableGrid",a.ui.sortable,{_onRightSide:function(a,b){return this._isOverAxis(b.pageX,a.left+a.width/2,a.width/2)},_mouseDrag:function(b){var c,d,e,f=this.options,g=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<f.scrollSensitivity?this.scrollParent[0].scrollTop=g=this.scrollParent[0].scrollTop+f.scrollSpeed:b.pageY-this.overflowOffset.top<f.scrollSensitivity&&(this.scrollParent[0].scrollTop=g=this.scrollParent[0].scrollTop-f.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<f.scrollSensitivity?this.scrollParent[0].scrollLeft=g=this.scrollParent[0].scrollLeft+f.scrollSpeed:b.pageX-this.overflowOffset.left<f.scrollSensitivity&&(this.scrollParent[0].scrollLeft=g=this.scrollParent[0].scrollLeft-f.scrollSpeed)):(b.pageY-this.document.scrollTop()<f.scrollSensitivity?g=this.document.scrollTop(this.document.scrollTop()-f.scrollSpeed):this.window.height()-(b.pageY-this.document.scrollTop())<f.scrollSensitivity&&(g=this.document.scrollTop(this.document.scrollTop()+f.scrollSpeed)),b.pageX-this.document.scrollLeft()<f.scrollSensitivity?g=this.document.scrollLeft(this.document.scrollLeft()-f.scrollSpeed):this.window.width()-(b.pageX-this.document.scrollLeft())<f.scrollSensitivity&&(g=this.document.scrollLeft(this.document.scrollLeft()+f.scrollSpeed))),g!==!1&&a.ui.ddmanager&&!f.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=this._intersectsWithPointer(d)){if(this.direction=this._onRightSide(d,b)===!0?"right":"left",this._rearrange(b,d),!this._intersectsWithSides(d))break;this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"left"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})}}),{init:function(){a(".block-totara-featured-links-layout").sortableGrid({cursor:"move",helper:"clone",placeholder:"block-totara-featured-links-placeholder",tolerance:"intersect",items:" > [id^=block-totara-featured-links-tile-]",opacity:.5,update:function(c){var d=a(c.target).sortableGrid("toArray");b.call([{methodname:"block_totara_featured_links_external_reorder_tiles",args:{tiles:d}}])},start:function(b,c){c.item.show(),a(".block-totara-featured-links-layout").sortableGrid("option","cursorAt",{left:c.item.width()/2,top:c.item.height()/2})}}).disableSelection()}}});