define(["jquery","core/ajax","block_totara_featured_links/visibility_form","core/str","core/config","core/templates","core/flex_icon"],function(a,b,c,d,e,f,g){var h={},i={ok:"",cancel:"",title:""},j=function(){var b=function(){this.baseurl=""};b.prototype=new totaraDialog_handler_treeview_multiselect,b.prototype.every_load=function(){a("#audience_visible_table").find("[cohortid]").each(function(){var b=a(this).attr("cohortid");j._toggle_items("item_"+b,!1)}),this._make_selectable(a(".treeview",this._container)),this._make_deletable(a(".selected",this._container))};var j=new b,k={};k[i.ok]=function(){j._update()},k[i.cancel]=function(){j._cancel()};var l=e.wwwroot+"/totara/cohort/dialog/";new totaraDialog("course-cohorts-visible-dialogue","add_audience_id",{buttons:k,title:i.title},l+"cohort.php?selected="+h.visibleselected+"&instancetype="+h.instancetype+"&instanceid="+h.instanceid+"&sesskey="+h.sesskey,j),b.prototype._update=function(){var b=a(".selected [id^=item]",this._container);b.each(function(){var b=a(this).attr("id").split("_"),e=a(this).find("a").text();b=b[b.length-1],b=parseInt(b),c.audience_list_contains(b)||d.get_string("delete_audience_rule","block_totara_featured_links",e).then(function(a){return g.getIconData("delete","core",{alt:a})}).then(function(a){var c={cohortid:b,name:e,deleteicon:a};return f.render("block_totara_featured_links/element_audience_list_item",c)}).then(function(a){c.add_to_audience_list(a),c.add_to_audience_id(b),c.add_audience_table_listeners()})}),j._dialog.hide()}};return{init:function(b,c,e){h.instancetype=b,h.instanceid=c,h.sesskey=e;var f=[];f.push({key:"ok",component:"moodle"}),f.push({key:"cancel",component:"moodle"}),f.push({key:"audience_add",component:"block_totara_featured_links"}),d.get_strings(f).done(function(b){i={ok:b[0],cancel:b[1],title:b[2]},window.dialogsInited?j():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(j))})}}});