M.totara_reportbuilder_savedsearches=M.totara_reportbuilder_savedsearches||{Y:null,init:function(Y,args){this.Y=Y;if(typeof $==='undefined'){throw new Error('M.totara_reportbuilder_savevedsearch.init()-> jQuery dependency required for this module to function.')}
var totaraDialog_saved_search_handler=function(){};totaraDialog_saved_search_handler.prototype=new totaraDialog_handler();totaraDialog_saved_search_handler.prototype.every_load=function(){$('input[value="Continue"]',this._container).click(function(){var idsearch=$(this).siblings(":hidden[name=sid]").val();var action=$(this).siblings(":hidden[name=action]").val();if(action=='delete'){$('select[name=sid] option[value='+idsearch+']').remove();if($('select[name=sid] option').length==1){$('#totara_reportbuilder_viewsavedsearch').remove()}}});$('form').submit(function(){var form=this;var action=$(":hidden[name=action]",form).val();if(action=='edit'){var idsearch=$(":hidden[name=sid]",form).val();var searchname=$("#id_name",form).val();$('select[name=sid] option[value='+idsearch+']').text(searchname)}})}
$('#totara_reportbuilder_manageseacheslink').on("click",function(e){var path=M.cfg.wwwroot+'/totara/reportbuilder/';var handler=new totaraDialog_saved_search_handler();var name='searchlist';var id=e.target.getAttribute('data-id');var buttons={};buttons[M.util.get_string('close','form')]=function(){handler._cancel()};totaraDialogs[name]=new totaraDialog(name,'totara_reportbuilder_manageseacheslink',{buttons:buttons,title:'<h2>'+M.util.get_string('managesavedsearches','totara_reportbuilder')+'</h2>'},path+'savedsearches.php?id='+id.toString(),handler)});$('#id_sid').on("change",function(){if(this.value){var url=$('#totara_reportbuilder_viewsavedsearch').attr("action");var breakchar=(url.match(/\?/))?'&':'?';window.location.href=url+breakchar+'sid='+this.value}});var savedsearchdefault=$('#id_sdefault');savedsearchdefault.on("change",function(){require(['core/ajax','core/notification'],function(ajax,notification){var request={methodname:'totara_reportbuilder_set_default_search',args:{reportid:args.rb_reportid,sid:document.getElementById('id_sid').value,setdefault:savedsearchdefault.is(':checked')}};ajax.call([request])[0].done(function(result){if(result.warnings.length!=0){notification.exception(result.warnings[0])}else{var savedsearches=result.savedsearches;for(var search in savedsearches){$('select[name=sid] option[value='+savedsearches[search].sid+']').text(savedsearches[search].name)}}}).fail(notification.exception)})})}}