M.totara_message=M.totara_message||{Y:null,config:{},init:function(Y,args){this.Y=Y;if(args){var jargs=Y.JSON.parse(args);for(var a in jargs){if(Y.Object.owns(jargs,a)){this.config[a]=jargs[a]}}}},create_dialog:function(Y,id,selector,clean_fullme,sesskey,extrabuttonjson,processor_type){(function(){var url=M.cfg.wwwroot+'/totara/message/';var handler=new totaraDialog_handler_confirm();var name=selector+id;var buttonsObj={};buttonsObj[M.util.get_string('dismiss','totara_message')]=function(){handler._confirm(M.cfg.wwwroot+'/totara/message/dismiss.php?id='+id+'&sesskey='+sesskey,clean_fullme)};buttonsObj[M.util.get_string('cancel','moodle')]=function(){handler._cancel()};if(extrabuttonjson&&extrabuttonjson!==''){var jargs=Y.JSON.parse(extrabuttonjson);for(var a in jargs){if(Y.Object.owns(jargs,a)){buttonsObj[a]=(function(action,redirect){return function(){handler._confirm(action,redirect,!0)}})(jargs[a].action,jargs[a].clean_redirect)}}}
var dialogueWidth=Y.one('body').get("winWidth")-50;dialogueWidth=Math.min(dialogueWidth,600);totaraDialogs[name]=new totaraDialog(name,name+'-dialog',{buttons:buttonsObj,title:'<h2>'+M.util.get_string('reviewitems','block_totara_alerts')+'</h2>',width:dialogueWidth,height:400},url+'dismissmsg.php?id='+id+'&sesskey='+sesskey+'&processor_type='+processor_type,handler);$('#'+name).dialog('option','dialogClass',$('#'+name).dialog('option','dialogClass')+' dialog-nobind')})()},create_action_dialog:function(Y,action,action_str,clean_fullme,sesskey,processor_type){(function(){var url=M.cfg.wwwroot+'/totara/message/';var handler=new totaraDialog_handler_confirm();var name=action+'msg';var buttonsObj={};buttonsObj[action_str]=function(){handler._confirm(M.cfg.wwwroot+'/totara/message/action.php?'+action+'='+action+'&sesskey='+sesskey+'&processor_type='+processor_type,clean_fullme)};buttonsObj[M.util.get_string('cancel','moodle')]=function(){handler._cancel()};totaraDialogs[name]=new totaraDialog(name,'totara-'+action,{buttons:buttonsObj,title:'<h2>'+action_str+'</h2>',width:600,height:400},url+'actionmsg.php?'+action+'='+action+'&sesskey='+sesskey+'&processor_type='+processor_type,handler);totaraDialogs[name].load=function(url,method,onsuccess){this.dialog.html('');this.showLoading();msgids=[];$('form#totara_messages input[type="checkbox"]:checked').each(function(){msgids.push($(this).attr('value'))});this.url=url+'&msgids='+msgids.join(',');this._request(this.url)}})()},create_accept_reject_dialog:function(Y,id,type,type_str,dialog_title,returnto,sesskey){(function(){$('#'+type+'msg'+id+'-dialog').css('display','block');var url=M.cfg.wwwroot+'/totara/message/';var handler=new totaraDialog_handler_confirm();var name=type+'msg'+id;var buttonsObj={};buttonsObj[type_str]=function(){handler._confirm(M.cfg.wwwroot+'/totara/message/'+type+'.php?id='+id+'&sesskey='+sesskey,returnto)};buttonsObj[M.util.get_string('cancel','moodle')]=function(){handler._cancel()};totaraDialogs[name]=new totaraDialog(name,name+'-dialog',{buttons:buttonsObj,title:'<h2>'+dialog_title+'</h2>',width:600,height:400},url+'acceptrejectmsg.php?id='+id+'&event=on'+type,handler)})()},dismiss_input_toggle:function(){$('#totara_messages input[type=checkbox]').on('click',function(){if($('form#totara_messages input[type=checkbox]:checked').length){$('#totara-dismiss').attr('disabled',!1)}else{$('#totara-dismiss').attr('disabled',!0)}})},select_all_none_checkbox:function(){$('th.message_values_dismiss_link').html('<div id="totara_message_selects"><a id="all" href="#">'+M.util.get_string('all','moodle')+'</a>/<a id="none" href="#">'+M.util.get_string('none','moodle')+'</a></div>');function jqCheckAll(flag){if(flag===!1){$("form#totara_messages [type='checkbox']").prop('checked',!1);if($('form#totara_messages input[type=checkbox]:checked').length){$('#totara-dismiss').attr('disabled',!1)}else{$('#totara-dismiss').attr('disabled',!0)}}else{$("form#totara_messages [type='checkbox']").prop('checked',!0);if($('form#totara_messages input[type=checkbox]:checked').length){$('#totara-dismiss').attr('disabled',!1)}else{$('#totara-dismiss').attr('disabled',!0)}}}
$('#totara_message_selects #all').click(function(){jqCheckAll(!0);return!1});$('#totara_message_selects #none').click(function(){jqCheckAll(!1);return!1})}};totaraDialog_handler_confirm=function(){};totaraDialog_handler_confirm.prototype=new totaraDialog_handler();totaraDialog_handler_confirm.prototype._confirm=function(url,returnto,extrabutton){var addreasonparam=!1;this.setReturnTo(returnto);var reasonfordecision=$('#reasonfordecision',this._container);if(extrabutton&&reasonfordecision.length>0&&reasonfordecision.val().trim().length>0&&(url.indexOf("reject")>=0||(url.indexOf("accept")>=0))){addreasonparam=!0}
msgids=[];$('form#totara_messages input[type="checkbox"]:checked').each(function(){msgids.push($(this).attr('value'))});url=url+'&msgids='+msgids.join(',');if(addreasonparam){url=url+"&reasonfordecision="+encodeURIComponent(reasonfordecision.val())}
this._dialog._request(url,{object:this,method:'_redirect'})};totaraDialog_handler_confirm.prototype.setReturnTo=function(url){this._returnTo=url;return};totaraDialog_handler_confirm.prototype._redirect=function(){this._dialog.hide();if(this._returnTo==null){this._returnTo=M.cfg.wwwroot}
window.location=this._returnTo;return}