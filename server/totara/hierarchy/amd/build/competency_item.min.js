define(["jquery","core/config","core/str"],function(a,b,c){var d=function(){},e=function(){},f=function(f,g){if(c.get_string("assignrelatedcompetencies","totara_hierarchy").done(function(a){var c=b.wwwroot+"/totara/hierarchy/prefix/competency/related/";totaraMultiSelectDialog("related",a,c+"find.php?sesskey="+b.sesskey+"&id="+f,c+"save.php?sesskey="+b.sesskey+"&id="+f+"&deleteexisting=1&add=")}),"undefined"!=typeof g&&g)d.prototype=new totaraDialog_handler_treeview,d.prototype._handle_update_hierarchy=function(b){var c=this;a("span",b).click(function(){var b=a(this).parent(),d=b.attr("id").substr(10);"cat"!=d.substr(0,3)&&c._handle_course_click(d)})},d.prototype._handle_course_click=function(a){var b=this.baseurl+"course.php?id="+a+"&competency="+f;this._dialog.showLoading(),this._dialog._request(b,{object:this,method:"_display_evidence"})},d.prototype._display_evidence=function(c){this._dialog.hideLoading(),a(".selected",this._dialog.dialog).html(c);var d=this;a("#available-evidence",this._dialog.dialog).find(".addbutton").click(function(c){c.preventDefault();var e=a(this).parent().attr("type"),g=a(this).parent().attr("id"),h=d.baseurl+"add.php?sesskey="+b.sesskey+"&competency="+f+"&type="+e+"&instance="+g;d._dialog._request(h,{object:d,method:"_update"})})};else{e.prototype=new totaraDialog_handler_treeview_multiselect,e.prototype._update=function(b){this._dialog.hide(),a(".noitems-"+this._title).remove();var c=a(b).find("#list-evidence"),d=a("#list-evidence");d.length?d.replaceWith(c):a("div#evidence-list-container").append(c)};var h=b.wwwroot+"/totara/hierarchy/prefix/competency/evidenceitem/",i=h+"add.php?sesskey="+b.sesskey+"&competency="+f+"&type=coursecompletion&instance=0&deleteexisting=1&update=",j={},k=new e;k.baseurl=h;var l=[];l.push({key:"save",component:"totara_core"}),l.push({key:"cancel",component:"moodle"}),l.push({key:"assigncoursecompletions",component:"totara_hierarchy"}),c.get_strings(l).done(function(a){for(var b=[],c=0;c<l.length;c++)b[l[c].key]=a[c];j[b.save]=function(){k._save(i)},j[b.cancel]=function(){k._cancel()},totaraDialogs.evidence=new totaraDialog("evidence","show-evidence-dialog",{buttons:j,title:"<h2>"+b.assigncoursecompletions+"</h2>"},h+"edit.php?id="+f,k)})}if("undefined"!=typeof g&&g){var l=[];l.push({key:"cancel",component:"moodle"}),l.push({key:"assignnewevidenceitem",component:"totara_hierarchy"}),c.get_strings(l).done(function(a){for(var c=[],e=0;e<l.length;e++)c[l[e].key]=a[e];var g=b.wwwroot+"/totara/hierarchy/prefix/competency/evidenceitem/",h={},i=new d;i.baseurl=g,h[c.cancel]=function(){i._cancel()},totaraDialogs.evidence=new totaraDialog("evidence","show-evidence-dialog",{buttons:h,title:"<h2>"+c.assignnewevidenceitem+"</h2>"},g+"edit.php?id="+f,i)})}};return{item:function(b,c){var d=a.Deferred();d.done(function(){f(b,c)}),window.dialogsInited?d.resolve():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(d.resolve))},template:function(d){var e=a.Deferred();e.done(function(){var a=b.wwwroot+"/totara/hierarchy/prefix/competency/template/";c.get_string("assignnewcompetency","competency").done(function(b){totaraMultiSelectDialog("assignment","<h2>"+b+"</h2>",a+"find_competency.php?templateid="+d,a+"save_competency.php?templateid="+d+"&deleteexisting=1&add=")})}),window.dialogsInited?e.resolve():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(e.resolve))}}});