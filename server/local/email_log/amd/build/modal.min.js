define(["jquery"],function(a){return a.init_dialog_link=function(b){var c=a("body");c.data("dialog_init")||(c.data("dialog_init",!0),c.on("click",".modal-dialogbox-link",function(c){var d=a(this);c.preventDefault();var e=d.data("content"),f=d.data("size"),g=d.data("header"),h={header:g,size:f?f:"medium"};d.data("header")&&(h.header=d.data("header")),e?h.content=e:h.url=d.data("url"),a.showDialog(h,b)}))},a.showDialog=function(b,c,d){function e(a,b){b?(a.find(".modal-header").show(),a.find(".modal-header").children(":not(.close)").remove(),a.find(".modal-header").append('<h4 class="modal-title" id="myModalLabel">'+b+"</h4>")):a.find(".modal-header").hide()}var f=a("#modal_dialog"),g="",h="";c||(c={}),g=c["class"]?c["class"]:"",h=c.outerclass?c.outerclass:"",0===f.length&&(f=a('<div id="modal_dialog" class="kineomodal modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div id="innermodal" class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">Modal title</h4></div><div class="modal-body"></div></div></div><div class="modal-backdrop fade in"></div></div>'),f.on("click",function(b){(a(b.target).is("#innermodal",".modal-backdrop")||a(b.target.parentNode).is(":button",".close"))&&(f.hide(),a("body").removeClass("modal-open"))}),a("body").append(f),f=a("#modal_dialog")),d||(d="center"),"center"===d?(f.css("display","table"),f.removeClass("topmode")):"top"===d&&(f.css("display","block"),f.addClass("topmode")),f.addClass("modal fade "+h),f.find("#innermodal").attr("class","modal-dialog "+g),e(f,!!b.header&&b.header);var i={large:"modal-lg",medium:"modal-md",small:"modal-sm"};b.size&&i[b.size]||(b.size="medium"),f.addClass(i[b.size]),f.find("#innermodal").removeClass("modal-lg modal-md modal-sm").addClass(i[b.size]);var j=.85*a(window).height()-f.find(".modal-header").outerHeight();c.maxheightpercentage&&(j*=c.maxheightpercentage),c.nomaxheight||"center"!==d?f.find(".modal-body").css("max-height",""):f.find(".modal-body").css("max-height",""+j+"px"),c.allowoverflow&&f.find(".modal-body").addClass("allowoverflow");var k={backdrop:!0,keyboard:!0,show:!0};for(var l in k)b[l]&&(k[l]=b[l]);f.addClass("fade in"),a("body").addClass("modal-open"),f.show();var m=f.find(".modal-body");if(b.url){var n='<img src="'+M.util.image_url("i/loading")+'" />';m.addClass("loadingcenter").html(n),a.get(b.url,function(a){m.html(a.content),m.removeClass("loadingcenter"),a.header&&e(f,a.header),b.callback&&b.callback(a,m)})}else b.content?m.html(b.content):b.element&&m.empty().append(b.element)},{init_dialog_link:a.init_dialog_link}});